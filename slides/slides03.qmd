---
session: "`r session <- 3; session`"
last_updated: "`r last_updated <- Sys.Date(); 
                  last_updated |> format('%Y-%m-%d')`"
class_date:
  "`r library(tidyverse);
    class_date <- read_csv('key_dates.csv', name_repair='universal') |>
    filter(Course.Element == 'Class Session',
           Item.Number == session) |>
    pull(Date); class_date |> format('%A %Y-%m-%d')`"
format: revealjs
---

{{< include _setup.qmd >}}

## Course Project

Course project description is now [online](../project.qmd) 

Detailed discussion of:

- Project structure
- Key deadlines
- Grading rubrics

Please send me questions!

Team rosters due at **midnight tonight**. If you don't have a team, stick around
after class and meet others without a team. 

## Course Project

::: {.small}

- Teams: 4-6 classmates
- Stages: 
  - Proposal (in class presentation)
  - Mid-semester check-in (in class presentation)
  - Final: in class presentation, individual report, summary report
- Structure:
  - Shared "Overarching Question" (OQ)
  - Individual "Specific Question" (SQ, one per teammate)
  
:::
  
Full description [online](../project.qmd)

## Course Project 

Conceit:

::: {.incremental .smaller}

- Consultants hired by client interested in _qualitative_ OQ
- You break OQ into several _quantitative_ SQs
- Combine results from SQs to answer OQ

::: 

. . . 

Process: 

::: {.incremental .smaller}

- Proposal: Sales pitch for consultants - here's the OQ we will answer
- Mid-Semester: Scope of work - here's the SQs and data we will use
- End-of-Semester: Presentation of Results
  - Group Report: "Executive Summary"
  - Individual Reports: "Technical Appendices"

:::


## Course Project

Next week: [project proposal
presentations](../project.qmd#project-proposal-presentations)

. . . 

Major goal: 

- What is the overarching / motivating question for your project? 

See instructions for more

. . . 

Post slides and team contract to Brightspace before class - you will present
from your computer

## Overarching Question

Example Topic: NYC Apartment Prices

::: {.incremental .smaller}

- Very Bad: Is there a relationship between rent and location? 

  - Problems: Binary, Obvious, Limited room for exploration

- Bad: What is the correlation between rent and location? 

  - Problems: Simple (one numeric answer), Linear, Limited room for exploration
  
- Good: What is the relationship between rent and location?

  - Strengths: Allows more interesting analysis, subgroups / differential impact
  
  - Weaknesses: Very broad (lots has been said about this), not clear how to
    split up

- Great: What are the key drivers of NYC rents and do they suggest multiple 
  market segments with different relative priorities?

  - Strengths: Allows project to be split up (different factors), clear intent
    to integrate findings, working hypothesis (multiple segments)
  
:::


## Finding Data

Advice:

::: {.incremental .smaller}

- Start early!
- [NYC Open Data](https://opendata.cityofnewyork.us/) is great
  - See also: [FRED](https://fred.stlouisfed.org/), 
    [Federal Open Data](https://data.gov), 
    [Nasa EarthData](https://search.earthdata.nasa.gov)
  - [Kaggle](https://www.kaggle.com/datasets) is not really a primary source
  - Ask on Piazza for pointers
  - Lots of data hidden in Wikipedia
- Nothing paid or private without express instructor submission
- Everyone loves _spatial_ data!
- Avoid overdone topics (NYC rents, NYC schools) - new topics => low-hanging fruit

:::

## Presentation Hints

- Longest time $\neq$ most important
- Story, story, story! _Why_ are you making these choices? 
- Hourglass Structure
  - Start big
  - Motivate _your_ overarching question
  - Specific questions
  - Tie specific to overarching
  - From overarching back to big motivation
- No less than one figure every other slide

## Special Presentation

Data Science Resources at the Baruch Libraries

. . . 

Presenter: Jason Amey (Baruch Business Librarian and Former STA 9750 Student)

## Mini-Project #00 

[Mini-Project #00](../mini/mini00.qmd) is due `r get_mp_deadline(00)`

- Automatic grace period until Sunday at midnight

```{r}
#| echo: false
MP_SUBMISSIONS <- get_mp_submitted(0)
ROSTER_FILE <- read_yaml("_teaching.yml") |> 
    pluck("gradedir") |>
    file.path("roster.json")

if(file.exists(ROSTER_FILE)){
    N_STUDENTS <- ROSTER_FILE |> read_json() |> length()
} else {
    N_STUDENTS <- NA
}
```

::: {.smaller}

As of `r Sys.Date()`: 

- `r N_STUDENTS` Users registered via Piazza
- `r MP_SUBMISSIONS$n_submitted` Posts on GitHub
  - `r MP_SUBMISSIONS$n_completed` pass automated tests
  - `r MP_SUBMISSIONS$n_need_work` need more work (see comments)
  
:::
  
. . . 

Recall that you need to submit *via* GitHub, Brightspace, and Piazza for this 
assignment - sending GitHub ID is **most important**

## MP #00 Goals

Mini-Project #00 is ungraded to: 

::: {.incremental}

i)   Sort out tech trouble
ii)  Show danger of waiting to the last minute

:::

. . . 

Lessons learned will be helpful in future assignments

. . . 

Some sites look really great - excited to see headshots, resumes, *etc.* and to
learn more about you

## MP #00 Peer Feedback

On `r get_mp_pf_assigned(0)`, I will assign _peer-feedback_:

- For MP #00, no real scores (give all 10s!): practice with process
- I will provide an `R` function to solicit your peer feedback
  - You provide your GitHub ID and your secret phrase
  - Answer questions
  - Upload result file to Brightspace
- Full details to follow via Brightspace announcement

## MP #00 Peer Feedback

Aims: 

- Learn to _read_ and _evaluate_ code
- In analysis, rarely _right_ and _wrong_; definitely _better_ and _worse_
- Learn tricks to improve your own site

> "Good artists copy; great artists steal." -- Steve Jobs

More discussion in advance of MP #01 feedback cycle

## CISSOID

New this semester: `cissoid`

- `CIS Scripts for Organizing Instructional Delivery`

. . . 

Course robot to help guarantee submissions are complete and to provide automated
help where possible

. . . 

Feature requests welcome 

## Course Support

```{r}
#| echo: false
TOTAL_STUDENTS <- 97 
PIAZZA_ENROLLS <- 21
```

Asynchronous Support: Piazza

- `r PIAZZA_ENROLLS` students registered in Piazza

. . . 

Synchronous Support: Office Hours

- Wednesday at 5pm (In-Person)
- Thursdays at 5pm (Zoom)

## Pre-Assignments

Pre-assignment quizzes

  - 30 point quiz
    - My intent is for everyone to get 30/30
    - Take as many times as needed
    - Settings tweaked to only re-show incorrect questions
  - I sometimes give feedback through Brightspace, so 
    check 'feedback' if you are alerted to any

. . . 

No pre-assignment next week - presentations instead

## Mini-Project #01

[Mini-Project #01](../mini/mini01.qmd) officially released today

::: {.incremental}

- Due `r get_mp_deadline(01)` (`r get_mp_deadline(01, as_date_obj=TRUE) - class_date` Days)
- Topic: `r get_mp_title(01)`
- Analysis of IPEDS Data
- Graded out of 80
  - 30 points for completed submissions

:::


## Mini-Project #01

7 'Tasks' covering: 

- data import (#1), 
- data preparation / feature engineering (#2-3)
- Exploratory Data Analysis (#4-6), and 
- writing up your analysis (#7)

. . . 

For this MP, you are a college president describing changes (or lack of changes)
to the demographics of your student body post-*SFFA*. 

# Today

## Today

- Brief Review of Quarto Render + Git Commit Cycle
- Introduction to `R` Programming
- Key Ideas in `R`: Data Frames, Functions, Packages and Control Flow
- Wrap Up

# Git Review

## Render + Commit Cycle

In Mini-Project #00, your goal is to _get rendered HTML to GitHub_

- 'Kick-the-tires' on Set-Up
- Things will go wrong - better now than later

Once you do this once, cycle becomes easier

## Git Workflow

Three key commands: 

- `git add`: add some changes to a 'box'
- `git commit`: seal the 'box'
- `git push`: send the 'box' to GitHub

`Git` pane in `RStudio` shows _uncommited changes_, not files. 

If a file 'vanishes' after a commit, that's good!

## Render + Commit

For ongoing changes / updates: 

::: {.incremental}

1) `Render` button in `RStudio` - generate new / change HTML
2) Check boxes next to all changed files - _Stage_ updates
3) Hit `Commit` and use modal to make a `Commit` - _Commit_ a new version in `Git`
4) `Push` - Send new version to GitHub. Website will update automatically

:::

## Render + Commit

Tips: 

::: {.incremental}

1) Go to your GitHub.com - see if expected files are present
2) When in doubt, better to include _everything_ in `docs`
3) Cycle rapidly - find problems ASAP

:::

. . . 

Storage is cheap - your time isn't

# Getting Started with `R`

## Programming in R

It's now time for us to start _writing code in `R`_

No more copy and trust

. . . 

Goals: 

1. Modify existing code to new applications
2. Write code to use existing libraries
3. Read and debug code

## Execution Model

Three models of executing code: 

::: {.incremental .small}

1. Line-by-line at `Console`
   - REPL: *R*ead *E*valuate *P*rint *L*oop
   - Best for transient, one-off actions; trying new things
2. Script writing in a separate file
   - Write in a separate (`.R`) file
   - Executes in same _session_; persistent state
   - Best for longer analyses with complex commands, developing code
3. Code in a Quarto document
   - Write code in chunks inside a `qmd` file
   - Executes in a _fresh_ session
   - Best for documenting and conveying analysis, archiving results
   
:::

## Arithmetic in R

Basic arithmetic in `R` runs as expected

```{r}
#| echo: true
1 + 2 + 3 + 4 + 5
```

. . . 

PEMDAS Ordering: Parentheses, Exponents, Multiplication/Division, 
Addition/Subtraction

## Arithmetic in R

$$3^{2 * 5 - 1} / 24^5$$

```{r}
#| echo: true
3^(2 * 5 - 1) / 24^5
```

. . . 

$$\frac{1^1 + 2^2 + 3^3}{3^1 + 2^2 + 1^3}$$

```{r}
#| echo: true
(1^1 + 2^2 + 3^3) / (3^1 + 2^2 + 1^3)
```

. . . 


When in doubt, extra parentheses don't hurt

## Function Calls

To go beyond arithmetic, need to invoke **functions**

$$ \cos(\pi) + \tan\left(\frac{\pi}{4}\right) + \sqrt{\sin(\pi/2)} - e^1$$

```{r}
#| echo: true
cos(pi) + tan(pi / 4) + sqrt(sin(pi/2)) - exp(1)
```

## Function Calls

All function calls have a fundamental syntax: 

> [name]{color="red"}()

*e.g.*, 

```{r}
#| echo: true
#| eval: false
R.Version()
```

. . . 

To get help with any function in `R`, type `?name`

## Function Calls

Most interesting functions require _input_: 

> [name]{color="red"}([argument]{color="blue"})

Here, the _argument_ is **input** to the function: 

```{r}
#| echo: true
#| eval: false
cos(pi)
```

. . . 

Multiple arguments are separated by commas

```{r}
#| echo: true
#| eval: false
atan2(-1, 1)
```

## Function Calls

Type a name without `()` to see its implementation

```{r}
#| echo: true
#| eval: true
cos
```

and 

```{r}
#| echo: true
#| eval: false
lm
```

```{r}
#| echo: false
head(lm, 5) |> cat(sep="\n"); cat("...")
```

. . . 

Conceptually `sqrt` vs `sqrt(4)` is "concept of square rooting" vs 
"the actual square root of 4, *i.e.*, 2"

## Function Calls

Most important for users are the first few lines (`args`)

- Define optional and required inputs

```{r}
#| echo: true
#| eval: false
args(log)
```

```{r}
#| echo: false
args(log) |> head(n=1) |> cat()
```

. . . 

Two arguments: 

- `x`: the input
- `base`: _optional_ 2nd argument with default $e$ (natural log)

## Function Calls

Every argument has a _name_, but not always required 

`R` is usually smart about knowing what you meant

. . . 

These are equivalent: 

```{r}
#| echo: true
#| eval: false
log(10)
log(10, exp(1))
log(x = 10)
log(x = 10, exp(1))
log(x = 10, base = exp(1))
log(base = exp(1), x = 10)
log(base = exp(1), 10)
```

## Vector Semantics

Often when dealing with data, we want to transform related data similarly: 

- *E.g.*, change _all_ temperatures in data set from F to C

Dangerous to only do part

. . . 

`R` has _vectorized_ semantics - whenever possible, do same operation to all
numbers together

```{r}
#| echo: true
1:10 # A vector
```


```{r}
#| echo: true
sqrt(1:10) # Keeps same vector structure
```

## Vector Semantics

Most functions in `R` try to vectorize, but not always possible

```{r}
#| echo: true
sqrt(1:10)
cospi((1:8) / 4)
```

. . . 

But

```{r}
#| echo: true
sum(1:10)
```

and 

```{r}
#| echo: true
rev(1:10)
```
## Vectorized Semantics

The `[1]` you sometimes see is `R` just letting you know 
where in a vector you are

```{r}
#| echo: true
sqrt(1:25)
```

. . . 

When we do 2D data (later), we get column and row indices

```{r}
#| echo: false
matrix(1:25, 5)
```

## Variables

Often, we want to save a several values as a single 'thing'

```{r}
#| echo: true
x <- 1:5
```

. . . 

This is an _assignment_ operator. _Vector_ formed by `1:5` is labeled `x`

Naming `x` later gives us this vector

```{r}
#| echo: true
x
```

Can be used in functions

```{r}
#| echo: true
sqrt(x)
```

## Vectors and Variables

If you need to write a vector 'by hand', use the `c` function: 

```{r}
#| echo: true
x <- c(1, 4, 9, 16, 25)
x
```

then 

```{r}
#| echo: true
sqrt(x)
```

. . . 

We won't usually hand-write vectors like this: 

- Data comes in vectors (*e.g.*, spreadsheet columns)

## Vector Access

Use `[]` operator to get individual elements of a vector: 

```{r}
#| echo: true
x <- sqrt(1:10)
x[4]
```

. . . 

Can do more complex indexing, but we won't use it much: 

```{r}
#| echo: true
x[1:5]
x[6:10]
x[-1]
```

# In-Class Activity

## Weekly Lab

[Lab #03](../labs/lab03.qmd)

New topics to cover: 

1) _classes_ of objects
2) Using Packages
3) Comments
4) Writing functions
5) Control Flow

## Object classes

Everything in `R` has a _type_ or _class_: 

- Integer, Double (*i.e.* 64 bit number allowing decimals), Character, ...

. . . 

All vectors elements must have the same class - this is the vector's class

```{r}
#| echo: true
x <- 1:5
y <- sqrt(x)

class(x)
```

```{r}
#| echo: true
class(y)
```

```{r}
#| echo: true
class(letters)
```

## Using Packages

A _package_ is a set of code (and data) packaged up for distribution and use

. . . 

`R` has _many_ helpful packages - these are distributed via `CRAN` 
(currently over 20,000)

. . . 

Using packages is a two-step process: 

1) Get package from CRAN to your computer (one time)
2) Loading into `R` (every time)

Think of regular software: you download MS Office once but 
need to start it whenever you want to use it

## Using Packages

The `install.packages` function will download and install a package: 

```{r}
#| echo: true
#| eval: false
install.packages("ggplot2")
```

If that package uses other packages, `R` will sort that out automatically

. . . 

When ready to use a package, use the `library()` command to 'start' it: 

```{r}
#| echo: true
library(ggplot2)
```

Now I have access to everything in that package 

## Comments

Comments are text inside the code that `R` ignores

- Everything following a # gets ignored 

. . . 

Compare 

```{r}
#| echo: true
#| error: true
tan(45 * pi / 180) Compute the tangent of 45 degrees
```

with 

```{r}
#| echo: true
#| error: false
tan(45 * pi / 180) # Compute the tangent of 45 degrees
```

## Comments

The best comments don't just say _what_ you are doing. They say _why_ you
are doing something in the way it is being done

. . . 

More discussion of comments later as we write more complex code

# FAQs from PA #03


## Vector Index Printing

Default vector printing: 
```{r}
#| echo: true
1:10
```

Each line gets a new index:
```{r}
#| echo: true
sqrt(1:10)
```

More complex objects have alternate print styles:
```{r}
#| echo: true
matrix(1:9, nrow=3, ncol=3)
```

Print width is controlled by `getOption("width")`.

## Recycling Rules

::: {.small}

Alignment by default: 
```{r}
#| echo: true
x <- 1:3
y <- 4:6
x + y
```

Recycling by default: 
```{r}
#| echo: true
x <- 1
y <- 4:6
x + y
```

Recycle warning when vectors don't fit together cleanly: 
```{r}
#| echo: true
#| warning: true
x <- 1:2
y <- 4:6
x + y
```

:::

## Recycling Warning

```{r}
#| echo: true
#| warning: true
x <- 1:2
y <- 4:6
x + y
```

Not a problem _per se_, but often a sign that something has gone wrong.

- scalar + vector is usually safe
- 2 vectors of same size is usually safe
- vectors of different size is usually a programming mistake

## Warnings vs Errors

- _Warnings_: heuristics pointing at typical problem
  - Code still executed without a problem
  - Try to fix these unless you're **certain** it's not a problem
- _Errors_: code failed to execute
  - You have to fix these to run your code

## Changing Functions

Most built-in functions can't / shouldn't be changed. 

Some allow alternate behavior via additional arguments:

```{r}
#| echo: true
log(10) # Default is natural (base e) logarithm
log(10, base=10)
```

If you want different behavior, write your own function: 

```{r}
#| echo: true
cosd <- function(x){
    ## Cosine in degrees
    cos(x * pi / 180)
}
cosd(90)
```

Always try `?name` to see documentation.

# Wrap-Up

## Orientation

::: {.smaller}

- Communicating Results (`quarto`)  ✅
- `R` Basics  ⬅️
- Data Manipulation in `R`
- Data Visualization in `R`
- Getting Data into `R` 
- Statistical Modeling in `R`

:::

## Review

Introduction to `R`: 

- Arithmetic
- Variables and Vectors
- Functions: Calls, Arguments, Defining
- Packages
- Help System

## Next Time

**Data Frames**: 

- Organizing several 'connected' vectors into a table
- table operations with `dplyr`

{{< include ../advice/taxes.qmd >}}

## Musical Treat

</br></br>

{{< video https://www.youtube.com/watch?v=gj940Pr_uMs width="80%" height="400px">}}

