<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>STA/OPR 9750 Mini-Project #03: Do Proportional Electoral College Allocations Yield a More Representative Presidency? – STA 9750</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./../index.html">
    <span class="navbar-title">STA 9750</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="./.././syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././preassignments.html"> 
<span class="menu-text">Pre-Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././labs.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././miniprojects.html"> 
<span class="menu-text">Mini Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././project.html"> 
<span class="menu-text">Course Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././resources.html"> 
<span class="menu-text">Additional Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./.././objectives.html"> 
<span class="menu-text">Learning Objectives</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<div id="quarto-announcement" data-announcement-id="6a42bbecdcf2d6ce6b61d47c55fab2f9" class="alert alert-danger">
  <i class="bi bi-info-circle quarto-announcement-icon"></i>
  <div class="quarto-announcement-content">
    <strong>Warning</strong> - This page is for a prior offering of STA 9750. For the latest offering, click <a id="exit-archive-link" href="../../../miniprojects/mini03.html">here</a>.
  </div>
  <i class="bi bi-x-lg quarto-announcement-action"></i>
</div>
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#due-dates" id="toc-due-dates" class="nav-link active" data-scroll-target="#due-dates">Due Dates</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#mini-project-objectives" id="toc-mini-project-objectives" class="nav-link" data-scroll-target="#mini-project-objectives">Mini-Project Objectives</a></li>
  <li>
<a href="#student-responsbilities" id="toc-student-responsbilities" class="nav-link" data-scroll-target="#student-responsbilities">Student Responsbilities</a>
  <ul class="collapse">
<li><a href="#rubric" id="toc-rubric" class="nav-link" data-scroll-target="#rubric">Rubric</a></li>
  <li><a href="#submission-instructions" id="toc-submission-instructions" class="nav-link" data-scroll-target="#submission-instructions">Submission Instructions</a></li>
  </ul>
</li>
  <li>
<a href="#set-up-and-initial-exploration" id="toc-set-up-and-initial-exploration" class="nav-link" data-scroll-target="#set-up-and-initial-exploration">Set-Up and Initial Exploration</a>
  <ul class="collapse">
<li><a href="#data-i-us-house-election-votes-from-1976-to-2022" id="toc-data-i-us-house-election-votes-from-1976-to-2022" class="nav-link" data-scroll-target="#data-i-us-house-election-votes-from-1976-to-2022">Data I: US House Election Votes from 1976 to 2022</a></li>
  <li><a href="#data-ii-congressional-boundary-files-1976-to-2012" id="toc-data-ii-congressional-boundary-files-1976-to-2012" class="nav-link" data-scroll-target="#data-ii-congressional-boundary-files-1976-to-2012">Data II: Congressional Boundary Files 1976 to 2012</a></li>
  <li><a href="#data-iii-congressional-boundary-files-2014-to-present" id="toc-data-iii-congressional-boundary-files-2014-to-present" class="nav-link" data-scroll-target="#data-iii-congressional-boundary-files-2014-to-present">Data III: Congressional Boundary Files 2014 to Present</a></li>
  <li><a href="#initial-exploration-of-vote-count-data" id="toc-initial-exploration-of-vote-count-data" class="nav-link" data-scroll-target="#initial-exploration-of-vote-count-data">Initial Exploration of Vote Count Data</a></li>
  <li><a href="#importing-and-plotting-shape-file-data" id="toc-importing-and-plotting-shape-file-data" class="nav-link" data-scroll-target="#importing-and-plotting-shape-file-data">Importing and Plotting Shape File Data</a></li>
  </ul>
</li>
  <li><a href="#comparing-the-effects-of-ecv-allocation-rules" id="toc-comparing-the-effects-of-ecv-allocation-rules" class="nav-link" data-scroll-target="#comparing-the-effects-of-ecv-allocation-rules">Comparing the Effects of ECV Allocation Rules</a></li>
  <li><a href="#extra-credit-opportunities" id="toc-extra-credit-opportunities" class="nav-link" data-scroll-target="#extra-credit-opportunities">Extra Credit Opportunities</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/archive/AY-2024-FALL/miniprojects/mini03.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/archive/AY-2024-FALL/miniprojects/mini03.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">STA/OPR 9750 Mini-Project #03: Do Proportional Electoral College Allocations Yield a More Representative Presidency?</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="due-dates" class="level3"><h3 class="anchored" data-anchor-id="due-dates">Due Dates</h3>
<ul>
<li>Released to Students: 2024-10-24</li>
<li><strong>Initial Submission: 2024-11-13 11:45pm ET on GitHub and Brightspace</strong></li>
<li>
<strong>Peer Feedback:</strong>
<ul>
<li>Peer Feedback Assigned: 2024-11-14 on GitHub</li>
<li><strong>Peer Feedback Due: 2024-11-20 11:45pm ET on GitHub</strong></li>
</ul>
</li>
</ul>
<hr></section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to Mini-Project #03! In this project, you will write a <em>political fact-check</em>, that most iconic form of our current journalistic era. Specifically, you will investigate the claim that the <a href="https://en.wikipedia.org/wiki/United_States_Electoral_College">US Electoral College</a> systematically biases election results away from the <em>vox populi</em>. As you dive in to the world of political data, we’ll also learn a bit more about the mechanics of US federal elections.</p>
<p>In this Mini-Project, you will:</p>
<ul>
<li>Integrate data from disparate governmental and academic sources</li>
<li>Learn to work with spatial data formats</li>
<li>Create <em>many</em> plots</li>
<li>Use spatial and animated visualizations to make your argument</li>
</ul>
<p>Note that - as with all these mini-projects - there isn’t a single “<em>right</em>” answer to the questions posed herein. You may have different views about the relative importance of federalism, direct democratic structures, adherence to the formal structures of the US Constitution, <em>etc.</em> than your classmates. Please make sure to make your argument respectfully and, when we reach the peer-evaluation stage, read and comment respectfully. All grading will be done solely on the quality of the code, the writing, the visualizations, and the argument - not on the political implications of what you may or may not find.</p>
<p>Also note that this mini-project is intended to be markedly less demanding than <a href="./mini02.html">Mini-Project #02</a>. At this point in the course, you should be diving into your <a href="../project.html">Course Project</a>, which should consume the majority of your out-of-class time dedicated to this course for the remainder of the semester.</p>
</section><section id="background" class="level2"><h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The <a href="https://constitution.congress.gov/constitution/">US Constitution</a> sets the basic rules of electing the President in <a href="https://constitution.congress.gov/constitution/article-2/#article-2-section-1-clause-2">Section 1 of Article II</a>, which we quote here in part:</p>
<blockquote class="blockquote">
<p>Each State shall appoint, in such Manner as the Legislature thereof may direct, a Number of Electors, equal to the whole Number of Senators and Representatives to which the State may be entitled in the Congress: but no Senator or Representative, or Person holding an Office of Trust or Profit under the United States, shall be appointed an Elector.</p>
<p>The Electors shall meet in their respective States, and vote by Ballot for two Persons, of whom one at least shall not be an Inhabitant of the same State with themselves. And they shall make a List of all the Persons voted for, and of the Number of Votes for each; which List they shall sign and certify, and transmit sealed to the Seat of the Government of the United States, directed to the President of the Senate. The President of the Senate shall, in the Presence of the Senate and House of Representatives, open all the Certificates, and the Votes shall then be counted. The Person having the greatest Number of Votes shall be the President, if such Number be a Majority of the whole Number of Electors appointed; and if there be more than one who have such Majority, and have an equal Number of Votes, then the House of Representatives shall immediately chuse by Ballot one of them for President; and if no Person have a Majority, then from the five highest on the List the said House shall in like Manner chuse the President. But in chusing the President, the Votes shall be taken by States, the Representation from each State having one Vote; A quorum for this Purpose shall consist of a Member or Members from two thirds of the States, and a Majority of all the States shall be necessary to a Choice. In every Case, after the Choice of the President, the Person having the greatest Number of Votes of the Electors shall be the Vice President. But if there should remain two or more who have equal Votes, the Senate shall chuse from them by Ballot the Vice President.</p>
</blockquote>
<p>Though the details have varied over time due to amendment, statue, and technology, this basic outline of this allocation scheme remains unchanged:</p>
<ul>
<li>Each state gets <span class="math inline">\(R + 2\)</span> electoral college votes, where <span class="math inline">\(R\)</span> is the number of Representatives that state has in the US House of Representatives. In this mini-project, you can use the number of districts in a state to determine the number of congressional representatives (one per district).</li>
<li>States can allocate those votes however they wish</li>
<li>The president is the candidate who receives a majority of electoral college votes</li>
</ul>
<p>Notably, the Constitution sets essentially no rules on how the <span class="math inline">\(R + 2\)</span> electoral college votes (ECVs) for a particular state are allocated. At different points in history, different states have elected to use each of the following:</p>
<ul>
<li>Direct allocation of ECVs by state legislature (no vote)</li>
<li>Allocation of all ECVs to winner of state-wide popular vote</li>
<li>Allocation of all ECVs to winner of <a href="https://en.wikipedia.org/wiki/National_Popular_Vote_Interstate_Compact">nation-wide popular vote</a>
</li>
<li>Allocation of <span class="math inline">\(R\)</span> ECVs to popular vote winner by congressional district + allocation of remaining <span class="math inline">\(2\)</span> ECVs to the state-wide popular vote winner</li>
</ul>
<p>Currently, only Maine and Nebraska use the final option; the other 48 states and the District of Columbia award all <span class="math inline">\(R+2\)</span> ECVs to the winner of their state-wide popular vote. We emphasize here that “statewide winner-take-all” is a <em>choice</em> made by the individual states, not dictated by the US constitution, and that states have the power to change it should they wish.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>To my knowledge, no US state uses true <em>proportionate</em> state-wide representation, though I believe such a ECV-allocation scheme would be consistent with the US Constitution. For example, if a state with 5 ECVs had 60,000 votes for Candidate A and 40,000 cast for Candidate B, it could award 3 ECVs to A and 2 to B, regardless of the spatial distribution of those votes within the state.</p>
</section><section id="mini-project-objectives" class="level2"><h2 class="anchored" data-anchor-id="mini-project-objectives">Mini-Project Objectives</h2>
<p>In this project, you will use historical congressional election data to see how the outcome of US presidential elections would have changed under different allocation rules. Like any <em>retrodiction</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> task, this analysis has limitations. Notably, if the “rules” had been different, politicians may have run different campaigns and received different vote counts. Still, it is my hope that this is an interesting and informative exercise.</p>
<p>As noted above, your final submission should take the form of a “Fact Check”:</p>
<ul>
<li>Take a statement from a well-known politician or political commentator describing (claimed) bias of the electoral college system</li>
<li>Analyze presidential election results under different allocations for presence or abscence of bias (however you define it - see below)</li>
<li>Summarize your <em>retrodictive</em> findings</li>
<li>Award a “truthfulness” score to the claim you evaluated. (You may use the scale of an existing political fact-check operation or create your own.)</li>
</ul></section><section id="student-responsbilities" class="level2"><h2 class="anchored" data-anchor-id="student-responsbilities">Student Responsbilities</h2>
<p>Recall our basic analytic workflow and table of student responsibilities:</p>
<ul>
<li>Data Ingest and Cleaning: Given a single data source, read it into <code>R</code> and transform it to a reasonably useful standardized format.</li>
<li>Data Combination and Alignment: Combine multiple data sources to enable insights not possible from a single source.</li>
<li>Descriptive Statistical Analysis: Take a data table and compute informative summary statistics from both the entire population and relevant subgroups</li>
<li>Data Visualization: Generate insightful data visualizations to spur insights not attainable from point statistics</li>
<li>Inferential Statistical Analysis and Modeling: Develop relevant predictive models and statistical analyses to generate insights about the <em>underlying population</em> and not simply the data at hand.</li>
</ul>
<table class="table-hover caption-top table">
<caption>Students’ Responsibilities in Mini-Project Analyses</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 27%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Ingest and Cleaning</th>
<th style="text-align: center;">Combination and Alignment</th>
<th style="text-align: center;">Descriptive Statistical Analysis</th>
<th style="text-align: center;">Visualization</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #01</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #02</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #03</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #04</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
</tbody>
</table>
<p>In this mini-project, you will be working with relatively “clean” electoral data and your main focus should be on the analysis and visualization supporting your fact check. As an analysis of political data, I expect your final submission to have quite a few “red state/blue state” maps.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Data cleaning and import will play a larger role in Mini-Project #04.</p>
<p>In this project, I am no longer providing code to download and read the necessary data files. The data files I have selected for this mini-project are relatively easy to work with and should not provide a significant challenge, particularly after our in-class discussion of Data Import. See the modified rubric below which now includes a grade for data import.</p>
<section id="rubric" class="level3"><h3 class="anchored" data-anchor-id="rubric">Rubric</h3>
<p>STA/OPR 9750 Mini-Projects are evaluated using <em>peer grading</em> with <em>meta-review</em> by the course GTAs. Specifically, variants of the following rubric will be used for the mini-projects:</p>
<table class="caption-top table">
<caption>Mini-Project Grading Rubric</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th>Course Element</th>
<th>Excellent (9-10)</th>
<th>Great (7-8)</th>
<th>Good (5-6)</th>
<th>Adequate (3-4)</th>
<th>Needs Improvement (1-2)</th>
<th>Extra Credit</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Written Communication</td>
<td>Report is well-written and flows naturally. Motivation for key steps is clearly explained to reader without excessive detail. Key findings are highlighted and appropriately given context.</td>
<td>Report has no grammatical or writing issues. Writing is accessible and flows naturally. Key findings are highlighted, but lack suitable motivation and context.</td>
<td>Report has no grammatical or writing issues. Key findings are present but insufficiently highlighted.</td>
<td>Writing is intelligible, but has some grammatical errors. Key findings are obscured.</td>
<td>Report exhibits significant weakness in written communication. Key points are difficult to discern.</td>
<td>Report includes extra context beyond instructor provided information.</td>
</tr>
<tr class="even">
<td>Project Skeleton</td>
<td>Code completes all instructor-provided tasks correctly. Responses to open-ended tasks are particularly insightful and creative.</td>
<td>Code completes all instructor-provided tasks satisfactorially.</td>
<td>Response to one instructor provided task is skipped, incorrect, or otherwise incomplete.</td>
<td>Responses to two instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
<td>Response to three or ore instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
<td>Report exhibits particularly creative insights drawn from thorough student-initiated analyses.</td>
</tr>
<tr class="odd">
<td>Formatting &amp; Display</td>
<td>
<p>Tables and figures are full ‘publication-quality’.</p>
<p>Report includes at least one animated visualization designed to effectively communicate findings.</p>
</td>
<td>
<p>Tables have well-formatted column names, suitable numbers of digits, and attractive presentation.</p>
<p>Figures are ‘publication-quality’, with suitable axis labels, well-chosen structure, attractive color schemes, titles, subtitles, and captions, <em>etc.</em></p>
</td>
<td>
<p>Tables are well-formatted, but still have room for improvement.</p>
<p>Figures are above ‘exploratory-quality’, but do not reach full ‘publication-quality’.</p>
</td>
<td>
<p>Tables lack significant ‘polish’ and need improvement in substance (filtering and down-selecting of presented data) or style.</p>
<p>Figures are suitable to support claims made, but are ‘exploratory-quality’, reflecting minimal effort to customize and ‘polish’ beyond <code>ggplot2</code> defaults.</p>
</td>
<td>
<p>Unfiltered ‘data dump’ instead of curated table.</p>
<p>Baseline figures that do not fully support claims made.</p>
</td>
<td>Report includes interactive (not just animated) visual elements.</td>
</tr>
<tr class="even">
<td>Code Quality</td>
<td>
<p>Code is (near) flawless.</p>
<p>Code passes all <code>styler</code> and <code>lintr</code> type analyses without issue.</p>
</td>
<td>Comments give context of the analysis, not simply defining functions used in a particular line.</td>
<td>Code has well-chosen variable names and basic comments.</td>
<td>Code executes properly, but is difficult to read.</td>
<td>Code fails to execute properly.</td>
<td>Code takes advantage of advanced <code>Quarto</code> features to improve presentation of results.</td>
</tr>
<tr class="odd">
<td>Data Preparation</td>
<td>Data import is fully-automated and efficient, taking care to only download from web-sources if not available locally.</td>
<td>Data is imported and prepared effectively, in an automated fashion with minimal hard-coding of URLs and file paths.</td>
<td>Data is imported and prepared effectively, though source and destination file names are hard-coded.</td>
<td>Data is imported in a manner likely to have errors.</td>
<td>Data is hard-coded and not imported from an external source.</td>
<td>Report uses additional data sources in a way that creates novel insights.</td>
</tr>
</tbody>
</table>
<p>Note that this rubric is designed with copious opportunities for extra credit if students go <em>above and beyond</em> the instructor-provided scaffolding. Students pursuing careers in data analytics are strongly encouraged to go beyond the strict ambit of the mini-projects to i) further refine their skills; ii) learn additional techniques that can be used in the final course project; and iii) develop a more impressive professional portfolio.</p>
<p>Because students are encouraged to use STA/OPR 9750 mini-projects as the basis for a professional portfolio, the basic skeleton of each project will be released under a fairly permissive usage license. Take advantage of it!</p>
</section><section id="submission-instructions" class="level3"><h3 class="anchored" data-anchor-id="submission-instructions">Submission Instructions</h3>
<p>After completing the analysis, write up your findings, <em>showing all of your code</em>, using a dynamic <code>quarto</code> document and post it to your course repository. The <code>qmd</code> file should be named <code>mp03.qmd</code> so the rendered document can be found at <code>docs/mp03.html</code> in the student’s repository and served at the URL:</p>
<blockquote class="blockquote">
<p><code>https://&lt;GITHUB_ID&gt;.github.io/STA9750-2024-FALL/mp03.html</code></p>
</blockquote>
<p>Once you confirm this website works (substituting <code>&lt;GITHUB_ID&gt;</code> for the actual GitHub username provided to the professor in <a href="./mini00.html">MP#00</a> of course), open a new issue at</p>
<blockquote class="blockquote">
<p><code>https://github.com/&lt;GITHUB_USERNAME&gt;/STA9750-2024-FALL/issues/new</code> .</p>
</blockquote>
<p>Title the issue <code>STA/OPR 9750 &lt;GITHUB_USERNAME&gt; MiniProject #03</code> and fill in the following text for the issue:</p>
<pre><code>Hi @michaelweylandt!


https://&lt;GITHUB_USERNAME&gt;.github.io/STA9750-2024-FALL/mp03.html</code></pre>
<p>Once the submission deadline passes, the instructor will tag classmates for peer feedback in this issue thread.</p>
<p><em>Additionally</em>, a PDF export of this report should be submitted on Brightspace. To create a PDF from the uploaded report, simply use your browser’s ‘Print to PDF’ functionality.</p>
<p><strong>NB</strong>: The analysis outline below specifies key <em>tasks</em> you need to perform within your write up. Your peer evaluators will check that you complete these. You are encouraged to do extra analysis, but the bolded <strong>Tasks</strong> are <em>mandatory</em>.</p>
<p><strong>NB</strong>: Your final submission should look like a <em>report</em>, not simply a list of facts answering questions. Add introductions, conclusions, and your own commentary. You should be practicing both raw <em>coding</em> skills and written <em>communication</em> in all mini-projects. There is little value in data points stated without context or motivation.</p>
</section></section><section id="set-up-and-initial-exploration" class="level2"><h2 class="anchored" data-anchor-id="set-up-and-initial-exploration">Set-Up and Initial Exploration</h2>
<section id="data-i-us-house-election-votes-from-1976-to-2022" class="level3"><h3 class="anchored" data-anchor-id="data-i-us-house-election-votes-from-1976-to-2022">Data I: US House Election Votes from 1976 to 2022</h3>
<p>The <a href="https://electionlab.mit.edu/">MIT Election Data Science Lab</a> collects votes from all biennial congressional races in all 50 states <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/IG0UN2">here</a>. Download this data as a CSV file using your web browser. Note that you will need to provide your contact info and agree to cite this data set in your final report.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Make sure to include this citation!</p>
<p>Additionally, download statewide presidential vote counts from 1976 to 2022 <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/42MVDX">here</a>. As before, it will likely be easiest to download this data by hand using your web browser.</p>
</section><section id="data-ii-congressional-boundary-files-1976-to-2012" class="level3"><h3 class="anchored" data-anchor-id="data-ii-congressional-boundary-files-1976-to-2012">Data II: Congressional Boundary Files 1976 to 2012</h3>
<p>Jeffrey B. Lewis, Brandon DeVine, Lincoln Pritcher, and Kenneth C. Martis have created <em>shapefiles</em> for all US congressional districts from 1789 to 2012; they generously make these available <a href="https://cdmaps.polisci.ucla.edu/">here</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 1: Download Congressional Shapefiles 1976-2012">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 1: Download Congressional Shapefiles 1976-2012
</div>
</div>
<div class="callout-body-container callout-body">
<p>Download congressional shapefiles from Lewis <em>et al.</em> for all US Congresses<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> from 1976 to 2012.</p>
<p>Your download code should:</p>
<ol type="1">
<li>Be fully automated (no “hand-downloading”);</li>
<li>Download files with a systematic and interpretable naming convention</li>
<li>Only download files as needed out of courtesy for the data provider’s web sever. That is, if you already have a copy of the file, do not re-download it repeatedly.</li>
</ol>
<p><strong>As with the other Mini-Projects, make sure you do not store these data files in <code>git</code>. It will be sufficient to include the <code>qmd</code> file with the download code.</strong></p>
</div>
</div>
<p>Note that the shape files are distributed as <code>zip</code> folders, containing several files in a directory structure. We will be interested in the <code>shp</code> files within each <code>zip</code>.</p>
</section><section id="data-iii-congressional-boundary-files-2014-to-present" class="level3"><h3 class="anchored" data-anchor-id="data-iii-congressional-boundary-files-2014-to-present">Data III: Congressional Boundary Files 2014 to Present</h3>
<p>To get district boundaries for more recent congressional elections, we can turn to the US Census Bureau. Unfortunately, these data - while authoritative and highly detailed - are not in quite the same format as our previous congressional boundary files. We can review the US Census Bureau shapefiles <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">online</a>. To download them automatically, I recommend exploring the <code>FTP Archive</code> link near the bottom of the page. In Census-jargon, the <code>CD</code> directory will have shapefiles for <strong>C</strong>ongressional <strong>D</strong>istricts for each year.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 2: Download Congressional Shapefiles 2014-2022">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 2: Download Congressional Shapefiles 2014-2022
</div>
</div>
<div class="callout-body-container callout-body">
<p>Download congressional shapefiles from the US Census Bureau for all US Congresses from 2014 to 2022.</p>
<p>Your download code should:</p>
<ol type="1">
<li>Be fully automated (no “hand-downloading”);</li>
<li>Download files with a systematic and interpretable naming convention</li>
<li>Only download files as needed out of courtesy for the data provider’s web sever. That is, if you already have a copy of the file, do not re-download it repeatedly.</li>
</ol>
<p><strong>As with the other Mini-Projects, make sure you do not store these data files in <code>git</code>. It will be sufficient to include the <code>qmd</code> file with the download code.</strong></p>
</div>
</div>
</section><section id="initial-exploration-of-vote-count-data" class="level3"><h3 class="anchored" data-anchor-id="initial-exploration-of-vote-count-data">Initial Exploration of Vote Count Data</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 3: Exploration of Vote Count Data">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 3: Exploration of Vote Count Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer the following using the vote count data files from the MIT Election Data Science Lab. You may answer each with a table or plot as you feel is appropriate.</p>
<ol type="1">
<li><p>Which states have gained and lost the most seats in the US House of Representatives between 1976 and 2022?</p></li>
<li>
<p>New York State has a unique “fusion” voting system where one candidate can appear on multiple “lines” on the ballot and their vote counts are totaled. For instance, in 2022, Jerrold Nadler appeared on both the Democrat and Working Families party lines for NYS’ 12th Congressional District. He received 200,890 votes total (184,872 as a Democrat and 16,018 as WFP), easily defeating Michael Zumbluskas, who received 44,173 votes across three party lines (Republican, Conservative, and Parent).</p>
<p>Are there any elections in our data where the election would have had a different outcome if the “fusion” system was not used and candidates only received the votes their received from their “major party line” (Democrat or Republican) and not their total number of votes across all lines?</p>
</li>
<li>
<p>Do presidential candidates tend to run ahead of or run behind congressional candidates in the same state? That is, does a Democratic candidate for president tend to get more votes in a given state than all Democratic congressional candidates in the same state?</p>
<p>Does this trend differ over time? Does it differ across states or across parties? Are any presidents particularly more or less popular than their co-partisans?</p>
</li>
</ol>
</div>
</div>
</section><section id="importing-and-plotting-shape-file-data" class="level3"><h3 class="anchored" data-anchor-id="importing-and-plotting-shape-file-data">Importing and Plotting Shape File Data</h3>
<p>As mentioned above, the shape files you downloaded above are distributed in <code>zip</code> archives, with several files. We only need the <code>shp</code> file within each archive. In this section, we’ll practice extracting the <code>shp</code> file, reading it, and using it to create a plot. The key library we need is the <code>sf</code> (“simple features”) library. It provides the <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> function which we can use to read it into <code>R</code>. I download how this works below:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"nyc_borough_boundaries.zip"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="st">"https://data.cityofnewyork.us/api/geospatial/tqmj-j8zm?method=export&amp;format=Shapefile"</span>, </span>
<span>              destfile<span class="op">=</span><span class="st">"nyc_borough_boundaries.zip"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##-</span></span>
<span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>; </span>
<span><span class="va">zip_contents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span><span class="st">"nyc_borough_boundaries.zip"</span>, </span>
<span>                      exdir <span class="op">=</span> <span class="va">td</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">fname_shp</span> <span class="op">&lt;-</span> <span class="va">zip_contents</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"shp$"</span>, <span class="va">zip_contents</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">nyc_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">fname_shp</span><span class="op">)</span></span>
<span><span class="va">nyc_sf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -74.25559 ymin: 40.49613 xmax: -73.70001 ymax: 40.91553
Geodetic CRS:  WGS84(DD)
# A tibble: 5 × 5
  boro_code boro_name      shape_area shape_leng                        geometry
      &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;              &lt;MULTIPOLYGON [°]&gt;
1         3 Brooklyn      1934142776.    728147. (((-73.86327 40.58388, -73.863…
2         5 Staten Island 1623618684.    325910. (((-74.05051 40.56642, -74.050…
3         1 Manhattan      636646082.    360038. (((-74.01093 40.68449, -74.011…
4         2 Bronx         1187174772.    463181. (((-73.89681 40.79581, -73.896…
5         4 Queens        3041418004.    888197. (((-73.82645 40.59053, -73.826…</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Zipfile Download Corruption">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zipfile Download Corruption
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>At least one student reported difficulty running the above code on a Windows machine. The default download method (<code>method="internal"</code>) uses Windows’ built-in download code, which seems to randomly corrupt certain <code>zip</code> files. Adding <code>method="curl"</code> to the <code>download.file</code> call seems to have helped.</p>
<p>Similarly, using <code>http</code> instead of <code>https</code> in the URL sometimes avoids issues, particularly on Windows machines with aggressive anti-virus settings.</p>
<p>These tweaks may not work for all of you, since the root cause of these errors are a subtle interplay between the opearting system, specific security software (and settings within the security software) and <code>R</code>’s download functionality, but these tweaks may help to resolve mysterious errors.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 4: Automate Zip File Extraction">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 4: Automate Zip File Extraction
</div>
</div>
<div class="callout-body-container callout-body">
<p>Adapt the code after the <code>##-</code> symbol above into a <em>function</em> <code>read_shp_from_zip()</code> which takes in a file name, pulls out the <code>.shp</code> file contained there in, and reads it into <code>R</code> using <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code>.</p>
<p><em>Note: If your platform supports it, you can also use a combination of <code>unzip(..., list=TRUE)</code> and <code>unzip(..., file=...)</code> to extract only one file out of the <code>zip</code> directory instead of unpacking the whole file. This is a bit more efficient, but not necessary here as all files involved are pretty small.</em></p>
</div>
</div>
<p>The result of this is a particular sort of data frame. The most important column for us is the <code>geometry</code> column which is of type <code>MULTIPOLYGON</code>. This is, essentially, a list of GPS coordinates which outline a spatial region. Here, each row corresponds to a Borough of NYC. We can pass the <code>geometry</code> column to <code>ggplot2</code> to make a map:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nyc_sf</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="mini03_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, we use the <code>sf</code> <code>geom</code> to get the shape outlines. The <code>sf</code> <code>geom</code> plays well with the <code>fill</code> aesthetic.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nyc_sf</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">shape_area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="mini03_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This type of plot is called a <a href="https://en.wikipedia.org/wiki/Choropleth_map">Chloropleth Map</a> and it is commonly used to depict election results.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 5: Chloropleth Visualization of the 2000 Presidential Election Electoral College Results">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 5: Chloropleth Visualization of the 2000 Presidential Election Electoral College Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the data you downloaded earlier, create a <em>chloropleth</em> visualization of the electoral college results for the 2000 presidential election (Bush <em>vs.</em> Gore), coloring each state by the party that won the most votes in that state. Your result should look something like this:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/1/19/ElectoralCollege2000.svg" class="img-fluid"></p>
<p><strong>Taken from <a href="https://en.wikipedia.org/wiki/2000_United_States_presidential_election">Wikipedia</a></strong></p>
<p>It is not required, but to make the very best plot, you may want to look up:</p>
<ol type="1">
<li>How to “inset” Alaska and Hawaii instead of plotting their true map locations.</li>
<li>How to add labels to a chloropleth in <code>ggplot2</code>
</li>
<li>How to label the small states in the North-East</li>
</ol>
<p>but these steps are not required as they are a bit advanced.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 6: Advanced Chloropleth Visualization of Electoral College Results">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 6: Advanced Chloropleth Visualization of Electoral College Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>Modify your previous code to make either an <del><em>animated</em></del> <em>faceted</em> version showing election results over time.</p>
<p>You may want to set <code>facet_wrap</code> or <code>facet_grid</code> to use a single column and <a href="https://quarto.org/docs/authoring/figures.html#computations">adjust the figure size</a> for the best reading experience.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Some Subtleties of Working with Complex Shapefiles">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Some Subtleties of Working with Complex Shapefiles
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are some subtle issues you might need to be aware of when working with multiple complex shapefiles:</p>
<ol type="1">
<li><p><code>bind_rows</code> will struggle to combine shape files if they are not using the same <a href="https://pygis.io/docs/d_understand_crs_codes.html">Coordinate Reference System (CRS)</a>. You might want to use <code>st_transform</code> to set all CRS to be the same. CRS 4326, <em>a.k.a.</em> <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS 84</a> is a good choice.</p></li>
<li>
<p>Plotting complex shapefiles may be slow due to the intricate coastlines and lots of fiddly line segments on state borders. You may want to use <code>st_simplify</code> to make smoother (and more quickly plotted) edge sets. I found <code>st_simplify(dTolerance=0.01)</code> to work decently well, but you may find different values work better.</p>
<p>For technical reasons, you may need to set <code>sf_use_s2(FALSE)</code> before using <code>st_simplify</code>.</p>
</li>
<li><p>Joining two <code>sf</code> objects is tricky. If you don’t need <code>geometry</code> from both tables, it is easier to remove the <code>geometry</code> column from one and then apply the <code>as_data_frame</code> function to simplify its structure. This will allow regular (non-spatial) joins to be used.</p></li>
</ol>
</div>
</div>
</div>
<p>The following example may be useful for you:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Animated Chloropleth using gganimate</span></span>
<span></span>
<span><span class="co">## Add some time "structure" to our data for </span></span>
<span><span class="co">## demonstration purposes only</span></span>
<span><span class="va">nyc_sf_repeats</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span></span>
<span>    <span class="va">nyc_sf</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                     frame <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>    <span class="va">nyc_sf</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                     frame <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>    <span class="va">nyc_sf</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                     frame <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>    <span class="va">nyc_sf</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                     frame <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, </span>
<span>    <span class="va">nyc_sf</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, </span>
<span>                     frame <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nyc_sf_repeats</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>geometry<span class="op">=</span><span class="va">geometry</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span><span class="op">(</span><span class="va">frame</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="mini03_files/figure-html/chloropleth_animated_example-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now that we have finished exploring our data and building some tools for plots, we are ready to dig into our main question.</p>
</section></section><section id="comparing-the-effects-of-ecv-allocation-rules" class="level2"><h2 class="anchored" data-anchor-id="comparing-the-effects-of-ecv-allocation-rules">Comparing the Effects of ECV Allocation Rules</h2>
<p>Go through the historical voting data and assign each state’s ECVs according to various strategies:</p>
<ol type="1">
<li>State-Wide Winner-Take-All</li>
<li>District-Wide Winner-Take-All + State-Wide “At Large” Votes</li>
<li>State-Wide Proportional</li>
<li>National Proportional</li>
</ol>
<p>Based on these allocation strategies, compare the winning presidential candidate with the actual historical winner.</p>
<p>What patterns do you see? Are the results generally consistent or are one or more methods systematically more favorable to one party?</p>
<p>For the district-level winner-take-all, you may assume that the presidential candidate of the same party as the congressional representative wins that election.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 7: Evaluating Fairness of ECV Allocation Schemes">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 7: Evaluating Fairness of ECV Allocation Schemes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a fact check evaluating the fairness of the different ECV electoral allocation schemes.</p>
<p>To do so, you should first determine which allocation scheme you consider “fairest”. You should then see which schemes give different results, if they ever do. To make your fact check more compelling, select one election where the ECV scheme had the largest impact–if one exists–and explain how the results would have been different under a different ECV scheme.</p>
<p>As you perform your analysis, you may assume that the District of Columbia has three ECVs, which are allocated to the Democratic candidate under all schemes except possibly national popular vote.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</div>
</div>
<p>Throughout all of this, note that we are not varying the <span class="math inline">\(R+2\)</span> ECV allocation scheme specified by the constitution. Our concern here is only what individual states can do to address “fairness” in presidential elections. If we allow the possibility of constitutional amendment, the possibilities are endless. The <span class="math inline">\(R+2\)</span> rule has several interesting effects; some are well-known, such as the Senate’s equal treatment of small and large states, while others are less well-known, including the fact that congressional representation is based on population, not counts of voters.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
</section><section id="extra-credit-opportunities" class="level2"><h2 class="anchored" data-anchor-id="extra-credit-opportunities">Extra Credit Opportunities</h2>
<div class="callout callout-style-default callout-note callout-titled" title="Extra Credit Opportunity (Up to 5 points)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extra Credit Opportunity (Up to 5 points)
</div>
</div>
<div class="callout-body-container callout-body">
<p>For extra credit, extend your analysis to 2024 electoral results. You will have to find a reliable source of 2024 state- or district-wide vote counts. If the 2024 election is close, this may not be easy to do between the election and the date this mini-project is due.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Extra Credit Opportunity (Up to 8 points)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extra Credit Opportunity (Up to 8 points)
</div>
</div>
<div class="callout-body-container callout-body">
<p>For extra credit, create an <em>animated</em> plot instead of a <em>facet</em> plot in Task 6.</p>
<p>This is hard, due to what might be a bug a in <code>gganimate</code>’s treatment of changing numbers of <code>sf</code> geometries. If you want to pursue this path, I recommend downloading the <em>state</em> shapefiles from TIGER (the Census page)<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a> and using it instead of the congressional district shape files. Unlike the congressional district files, the state boundaries should be unchanging over time.</p>
</div>
</div>
<hr>
<p>This work ©2024 by <a href="https://michael-weylandt.com">Michael Weylandt</a> is licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Creative Commons BY-NC-SA 4.0</a> license. <img src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" class="img-fluid" style="width:10.0%"></p>


</section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>I am not aware of “official” reasons from any state on why they select “winner-take-all” allocation. States clearly compete for attention in presidential elections and it seems reasonable to assume that competitive states select “winner-take-all” allocation to attract presidential candidates who will make promises to that state’s voters. By contrast, states whose legislature is dominated by a single party, <em>e.g.</em>, New York, may be motivated to award all their votes to the more popular party in that state, denying any ECVs to the other candidate, even if a sizeable minority votes for them. If you find a history of how states select their ECV allocation strategies, I would be interested in reading it.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Making predictions about a counter-factual past.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Historically, the “Republicans Red / Democrats Blue” convention was not particularly strong in American journalism. It become standardized during coverage of the <a href="https://en.wikipedia.org/wiki/2000_United_States_presidential_election_recount_in_Florida">2000 Presidential Election and subsequent Florida recount battles</a> and has not materially changed since. For purposes of this mini-project, we will apply “Republican Red / Democrat Blue” consistently.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>While it may be possible to automate the browser to automatically fill in this pop-up as part of the download process, that’s beyond the scope of this assignment.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>It may be useful to recall that each two year cycle is called “a congress” for district mapping purposes. The 2022 US Election, selecting Representatives to serve 2023-2025, corresponds to the 118th Congress. The upcoming (November 2024) election will select members for the 119th Congress.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The other shapefiles in this FTP archive may be useful for your final projects.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>The District of Columbia is <em>very</em> Democratic.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>This latter effect is admittedly quite small if we assume political affiliation is unrelated to probability of voting. The relationship between voting likelihood and political leanings is an important one for campaign strategists and actively debated by academics.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p><em>E.g.</em>, <a href="https://www2.census.gov/geo/tiger/TIGER2018/STATE/">https://www2.census.gov/geo/tiger/TIGER2018/STATE/</a><a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/michael-weylandt\.com\/STA9750\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/archive/AY-2024-FALL/miniprojects/mini03.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/archive/AY-2024-FALL/miniprojects/mini03.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
