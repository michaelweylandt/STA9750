<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STA 9750 Mini-Project #03: Creating the Ultimate Playlist – STA 9750</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-7a426326b279d3ba9cc0818763c3c226.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">STA 9750</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../.././syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././preassignments.html"> 
<span class="menu-text">Pre-Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././labs.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././miniprojects.html"> 
<span class="menu-text">Mini Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././project.html"> 
<span class="menu-text">Course Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././resources.html"> 
<span class="menu-text">Additional Resources and Course Policies</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../.././objectives.html"> 
<span class="menu-text">Learning Objectives</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-prior-offerings" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Prior Offerings</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-prior-offerings">    
        <li>
    <a class="dropdown-item" href="../../.././archive/AY-2024-SPRING/">
 <span class="dropdown-text">Spring 2024</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../.././archive/AY-2024-FALL/">
 <span class="dropdown-text">Fall 2024</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<div id="quarto-announcement" data-announcement-id="6a42bbecdcf2d6ce6b61d47c55fab2f9" class="alert alert-danger">
  <i class="bi bi-info-circle quarto-announcement-icon"></i>
  <div class="quarto-announcement-content">
    <strong>Warning</strong> - This page is for a prior offering of STA 9750. For the latest offering, click <a id="exit-archive-link" href="../../../miniprojects/mini03.html">here</a>.
  </div>
  <i class="bi bi-x-lg quarto-announcement-action"></i>
</div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#due-dates" id="toc-due-dates" class="nav-link active" data-scroll-target="#due-dates">Due Dates</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#student-responsbilities" id="toc-student-responsbilities" class="nav-link" data-scroll-target="#student-responsbilities">Student Responsbilities</a></li>
  <li><a href="#rubric" id="toc-rubric" class="nav-link" data-scroll-target="#rubric">Rubric</a></li>
  <li><a href="#submission-instructions" id="toc-submission-instructions" class="nav-link" data-scroll-target="#submission-instructions">Submission Instructions</a></li>
  </ul></li>
  <li><a href="#mini-project" id="toc-mini-project" class="nav-link" data-scroll-target="#mini-project">Mini-Project #03: Creating the Ultimate Playlist</a>
  <ul class="collapse">
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">Data Acquisition</a></li>
  <li><a href="#song-characteristics" id="toc-song-characteristics" class="nav-link" data-scroll-target="#song-characteristics">Song Characteristics</a></li>
  <li><a href="#playlists" id="toc-playlists" class="nav-link" data-scroll-target="#playlists">Playlists</a></li>
  <li><a href="#initial-exploration" id="toc-initial-exploration" class="nav-link" data-scroll-target="#initial-exploration">Initial Exploration</a></li>
  <li><a href="#identifying-characteristics-of-popular-songs" id="toc-identifying-characteristics-of-popular-songs" class="nav-link" data-scroll-target="#identifying-characteristics-of-popular-songs">Identifying Characteristics of Popular Songs</a></li>
  <li><a href="#building-a-playlist-from-anchor-songs" id="toc-building-a-playlist-from-anchor-songs" class="nav-link" data-scroll-target="#building-a-playlist-from-anchor-songs">Building a Playlist from Anchor Songs</a></li>
  <li><a href="#create-your-playlist" id="toc-create-your-playlist" class="nav-link" data-scroll-target="#create-your-playlist">Create Your Playlist</a></li>
  </ul></li>
  <li><a href="#deliverable-the-ultimate-playlist" id="toc-deliverable-the-ultimate-playlist" class="nav-link" data-scroll-target="#deliverable-the-ultimate-playlist">Deliverable: The Ultimate Playlist</a></li>
  <li><a href="#extra-credit" id="toc-extra-credit" class="nav-link" data-scroll-target="#extra-credit">Extra Credit</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/archive/AY-2024-SPRING/miniprojects/mini03.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/archive/AY-2024-SPRING/miniprojects/mini03.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STA 9750 Mini-Project #03: Creating the Ultimate Playlist</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="due-dates" class="level3">
<h3 class="anchored" data-anchor-id="due-dates">Due Dates</h3>
<ul>
<li>Released to Students: 2025-03-20</li>
<li><strong>Initial Submission: 2025-04-23 11:45pm ET on GitHub and Brightspace</strong></li>
<li><strong>Peer Feedback:</strong>
<ul>
<li>Peer Feedback Assigned: 2025-04-24 on GitHub</li>
<li><strong>Peer Feedback Due: 2025-04-30 11:45pm ET on GitHub</strong></li>
</ul></li>
</ul>
<p><em>Estimated Time to Complete: 5 Hours</em></p>
<p><em>Estimated Time for Peer Feedback: 1 Hour</em></p>
<hr>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Welcome to Mini-Project #03! In this project, you will dive into the world of music analytics in an attempt to create <strong>The Ultimate Playlist.</strong> Specifically, we will explore two data exports made available by Spotify to identify i) the most popular songs on the platform and ii) the characteristics of those songs. From this data, you will create the ultimate playlist. Note that, while this project is inspired by the work of the <a href="https://www.youtube.com/watch?v=f1gjcVD3D1s">Great Sage, Mr Barney Stinson</a>, pioneer of the “All Rise” playlist, you can create whatever type of playlist you want, as long as it is <strong>Ultimate</strong>.</p>
<p>Also note that this mini-project is intended to be a bit less demanding than <a href="./mini02.html">Mini-Project #02</a>. At this point in the course, you should be diving into your <a href="../project.html">Course Project</a>, which should consume the majority of your out-of-class time dedicated to this course for the remainder of the semester.</p>
<section id="student-responsbilities" class="level3">
<h3 class="anchored" data-anchor-id="student-responsbilities">Student Responsbilities</h3>
<p>Recall our basic analytic workflow and table of student responsibilities:</p>
<ul>
<li>Data Ingest and Cleaning: Given a single data source, read it into <code>R</code> and transform it to a reasonably useful standardized format.</li>
<li>Data Combination and Alignment: Combine multiple data sources to enable insights not possible from a single source.</li>
<li>Descriptive Statistical Analysis: Take a data table and compute informative summary statistics from both the entire population and relevant subgroups</li>
<li>Data Visualization: Generate insightful data visualizations to spur insights not attainable from point statistics</li>
<li>Inferential Statistical Analysis and Modeling: Develop relevant predictive models and statistical analyses to generate insights about the <em>underlying population</em> and not simply the data at hand.</li>
</ul>
<table class="table-hover caption-top table">
<caption>Students’ Responsibilities in Mini-Project Analyses</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 27%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Ingest and Cleaning</th>
<th style="text-align: center;">Combination and Alignment</th>
<th style="text-align: center;">Descriptive Statistical Analysis</th>
<th style="text-align: center;">Visualization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #01</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #02</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #03</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #04</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
</tbody>
</table>
<p>In this project, I am no longer providing code to download and read the necessary data files. The data files I have selected for this mini-project are relatively easy to work with and should not provide a significant challenge, particularly after our in-class discussion of Data Import. See the modified rubric below which now includes a grade for data import.</p>
</section>
<section id="rubric" class="level3">
<h3 class="anchored" data-anchor-id="rubric">Rubric</h3>
<p>STA 9750 Mini-Projects are evaluated using <em>peer grading</em> with <em>meta-review</em> by the course GTAs. Specifically, variants of the following rubric will be used for the mini-projects:</p>
<table class="caption-top table">
<caption>Mini-Project Grading Rubric</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 12%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Course Element</th>
<th>Excellent (9-10)</th>
<th>Great (7-8)</th>
<th>Good (5-6)</th>
<th>Adequate (3-4)</th>
<th>Needs Improvement (1-2)</th>
<th>Extra Credit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Written Communication</td>
<td>Report is well-written and flows naturally. Motivation for key steps is clearly explained to reader without excessive detail. Key findings are highlighted and appropriately given context.</td>
<td>Report has no grammatical or writing issues. Writing is accessible and flows naturally. Key findings are highlighted, but lack suitable motivation and context.</td>
<td>Report has no grammatical or writing issues. Key findings are present but insufficiently highlighted.</td>
<td>Writing is intelligible, but has some grammatical errors. Key findings are obscured.</td>
<td>Report exhibits significant weakness in written communication. Key points are difficult to discern.</td>
<td>Report includes extra context beyond instructor provided information.</td>
</tr>
<tr class="even">
<td>Project Skeleton</td>
<td>Code completes all instructor-provided tasks correctly. Responses to open-ended tasks are particularly insightful and creative.</td>
<td>Code completes all instructor-provided tasks satisfactorially.</td>
<td>Response to one instructor provided task is skipped, incorrect, or otherwise incomplete.</td>
<td>Responses to two instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
<td>Response to three or ore instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
<td>Report exhibits particularly creative insights drawn from thorough student-initiated analyses.</td>
</tr>
<tr class="odd">
<td>Formatting &amp; Display</td>
<td><p>Tables and figures are full ‘publication-quality’.</p>
<p>Report includes at least one animated visualization designed to effectively communicate findings.</p></td>
<td><p>Tables have well-formatted column names, suitable numbers of digits, and attractive presentation.</p>
<p>Figures are ‘publication-quality’, with suitable axis labels, well-chosen structure, attractive color schemes, titles, subtitles, and captions, <em>etc.</em></p></td>
<td><p>Tables are well-formatted, but still have room for improvement.</p>
<p>Figures are above ‘exploratory-quality’, but do not reach full ‘publication-quality’.</p></td>
<td><p>Tables lack significant ‘polish’ and need improvement in substance (filtering and down-selecting of presented data) or style.</p>
<p>Figures are suitable to support claims made, but are ‘exploratory-quality’, reflecting minimal effort to customize and ‘polish’ beyond <code>ggplot2</code> defaults.</p></td>
<td><p>Unfiltered ‘data dump’ instead of curated table.</p>
<p>Baseline figures that do not fully support claims made.</p></td>
<td>Report includes interactive (not just animated) visual elements.</td>
</tr>
<tr class="even">
<td>Code Quality</td>
<td><p>Code is (near) flawless.</p>
<p>Code passes all <code>styler</code> and <code>lintr</code> type analyses without issue.</p></td>
<td>Comments give context of the analysis, not simply defining functions used in a particular line.</td>
<td>Code has well-chosen variable names and basic comments.</td>
<td>Code executes properly, but is difficult to read.</td>
<td>Code fails to execute properly.</td>
<td>Code takes advantage of advanced <code>Quarto</code> features to improve presentation of results.</td>
</tr>
<tr class="odd">
<td>Data Preparation</td>
<td>Data import is fully-automated and efficient, taking care to only download from web-sources if not available locally.</td>
<td>Data is imported and prepared effectively, in an automated fashion with minimal hard-coding of URLs and file paths.</td>
<td>Data is imported and prepared effectively, though source and destination file names are hard-coded.</td>
<td>Data is imported in a manner likely to have errors.</td>
<td>Data is hard-coded and not imported from an external source.</td>
<td>Report uses additional data sources in a way that creates novel insights.</td>
</tr>
</tbody>
</table>
<p>Note that this rubric is designed with copious opportunities for extra credit if students go <em>above and beyond</em> the instructor-provided scaffolding. Students pursuing careers in data analytics are strongly encouraged to go beyond the strict ambit of the mini-projects to i) further refine their skills; ii) learn additional techniques that can be used in the final course project; and iii) develop a more impressive professional portfolio.</p>
<p>Because students are encouraged to use STA 9750 mini-projects as the basis for a professional portfolio, the basic skeleton of each project will be released under a fairly permissive usage license. Take advantage of it!</p>
</section>
<section id="submission-instructions" class="level3">
<h3 class="anchored" data-anchor-id="submission-instructions">Submission Instructions</h3>
<p>After completing the analysis, write up your findings, <em>showing all of your code</em>, using a dynamic <code>quarto</code> document and post it to your course repository. The <code>qmd</code> file should be named <code>mp03.qmd</code> so the rendered document can be found at <code>docs/mp03.html</code> in the student’s repository and served at the URL:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<blockquote class="blockquote">
<p><code>https://&lt;GITHUB_ID&gt;.github.io/STA9750-2025-FALL/mp03.html</code></p>
</blockquote>
<p>Once you confirm this website works (substituting <code>&lt;GITHUB_ID&gt;</code> for the actual GitHub username provided to the professor in <a href="./mini00.html">MP#00</a> of course), open a new issue at</p>
<blockquote class="blockquote">
<p><code>https://github.com/michaelweylandt/STA9750-2025-FALL/issues/new</code> .</p>
</blockquote>
<p>Title the issue <code>STA 9750 &lt;GITHUB_ID&gt; MiniProject #03</code> and fill in the following text for the issue:</p>
<div id="submission-text">
<pre><code>Hi @michaelweylandt!

I've uploaded my work for MiniProject #**03** - check it out!

https://&lt;GITHUB_ID&gt;.github.io/STA9750-2025-FALL/mp03.html</code></pre>
</div>
<p>Once the submission deadline passes, the instructor will tag classmates for peer feedback in this issue thread.</p>
<p><em>Additionally</em>, a PDF export of this report should be submitted on Brightspace. To create a PDF from the uploaded report, simply use your browser’s ‘Print to PDF’ functionality.</p>
<p><strong>NB</strong>: The analysis outline below specifies key <em>tasks</em> you need to perform within your write up. Your peer evaluators will check that you complete these. You are encouraged to do extra analysis, but the bolded <strong>Tasks</strong> are <em>mandatory</em>.</p>
<p><strong>NB</strong>: Your final submission should look like a <em>report</em>, not simply a list of facts answering questions. Add introductions, conclusions, and your own commentary. You should be practicing both raw <em>coding</em> skills and written <em>communication</em> in all mini-projects. There is little value in data points stated without context or motivation.</p>
</section>
</section>
<section id="mini-project" class="level2">
<h2 class="anchored" data-anchor-id="mini-project">Mini-Project #03: Creating the Ultimate Playlist</h2>
<section id="data-acquisition" class="level3">
<h3 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h3>
<p>We will use two Spotify data exports:</p>
<ol type="1">
<li>A data set of songs and their characteristics</li>
<li>An export of user-created playlists</li>
</ol>
<p>Interestingly, Spotify no longer makes these datasets available directly, but nothing ever leaves the internet and we can use mirrors of the original data posted by other data scientists.</p>
</section>
<section id="song-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="song-characteristics">Song Characteristics</h3>
<p>First, we can download the song properties data from the mirror posted by GitHub user <strong>gabminamendez</strong>. Download the data and import it into <code>R</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 1: Song Characteristics Dataset">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 1: Song Characteristics Dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a function called <code>load_songs</code> to</p>
<ol type="i">
<li>download the Spotify song analytics dataset (if needed) from <a href="https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv">https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv</a></li>
<li>read it into <code>R</code>.</li>
</ol>
<p>Your function should return a well-formatted data frame.</p>
<p>To be responsible, your download code should:</p>
<ol type="1">
<li>Only download the file if it is not already present</li>
<li>Create a directory titled <code>data/mp03</code> if one is not already present</li>
<li>Save the file in <code>data/mp03</code> and, if necessary, decompress it.</li>
<li>Use built-in <code>R</code> functions like <code>download.file</code></li>
</ol>
<p>See prior mini-projects for examples of responsible downloading code.</p>
</div>
</div>
<p>The <code>artists</code> column of this data set is a bit oddly formatted: it contains multiple artists in a “list-type” format: <em>e.g.</em>, the song “Blinding Lights” has <code>artists</code> as <code>['The Weeknd']</code> and the song “Uptown Funk (feat. Bruno Mars)” has <code>artists</code> as <code>['Mark Ronson', 'Bruno Mars']</code>. The following code will split the <code>artists</code> across multiple rows, yielding <em>e.g.</em>, two rows for Uptown Funk, one each for Mark Ronson and Bruno Mars.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clean_artist_string <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">['"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"'</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[ ]?'"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"[ ]*,[ ]*"</span>, <span class="st">","</span>) </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>SONGS <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(artists, <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">artist =</span> <span class="fu">clean_artist_string</span>(artists)) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>artists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adapt it as needed for your analysis.</p>
</section>
<section id="playlists" class="level3">
<h3 class="anchored" data-anchor-id="playlists">Playlists</h3>
<p>Next, we’ll download the Spotify Million Playlist dataset from GitHub user <strong>DevinOgrady</strong>. Because this dataset is large, <strong>DevinOgrady</strong> has uploaded it as a series of JSON files in his <a href="https://github.com/DevinOgrady/spotify_million_playlist_dataset/tree/main"><code>spotify_million_playlist_dataset</code></a> repository. Write a function to download all files from this repository (<code>data1</code> directory), store them locally, and read them into <code>R</code>. As above, your download function should be responsible (only downloading the data once as needed).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 2: Playlist Dataset">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 2: Playlist Dataset
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write a function called <code>load_playlists</code> to</p>
<ol type="i">
<li>download the Spotify million playlist dataset (if needed);</li>
<li>read all files into <code>R</code>; and</li>
<li>concatenate them into a list object.</li>
</ol>
<p>As before, your download code should be “responsible” and avoid unnecessary duplicate downloads. (If your code is not ‘responsible’, GitHub may put a short-term block up to stop you from making too many requests. Be careful!)</p>
<p>You <strong>may not</strong> hard-code invidual file names. You need to use a loop-type construct and create individual file names programmatically.</p>
</div>
</div>
<p>Unlike the song characteristics data, this is <em>hierarchical</em> data, not trivially represented as a tidy data frame. To proceed we will need to process the playlists data into a more standard format. In particular, we want a table of the following columns:</p>
<ul>
<li>Playlist Name (<code>playlist_name</code>)</li>
<li>Playlist ID (<code>playlist_id</code>)</li>
<li>Playlist Position (<code>playlist_position</code>)</li>
<li>Playlist Followers (<code>playlist_followers</code>)</li>
<li>Artist Name (<code>artist_name</code>)</li>
<li>Artist ID (<code>artist_id</code>)</li>
<li>Track Name (<code>track_name</code>)</li>
<li>Track ID (<code>track_id</code>)</li>
<li>Album Name (<code>album_name</code>)</li>
<li>Album ID (<code>album_id</code>)</li>
<li>Duration (<code>duration</code>)</li>
</ul>
<p>where each row is one “track” from a playlist. (Certain songs will be repeated because they appear on multiple playlists.)</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 3: 'Rectangle' the Playlist Data">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 3: ‘Rectangle’ the Playlist Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using functions from the <code>tidyr</code>, <code>purrr</code>, and <code>dplyr</code> packages, convert the playlist data from Task 2 into the rectangular format described above.</p>
<p>To clean up the ID columns, you can use the following function to strip the <code>spotify:type:</code> prefix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>strip_spotify_prefix <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(stringr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_extract</span>(x, <span class="st">".*:.*:(.*)"</span>, <span class="at">group=</span><span class="dv">1</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="initial-exploration" class="level3">
<h3 class="anchored" data-anchor-id="initial-exploration">Initial Exploration</h3>
<p>Now that your data is imported and cleaned, it is time to begin exploring it and seeing how comprehensive it is. (Note that these exports were created at different times, so they will not have fully overlapping coverage.)</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 4: Initial Exploration">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 4: Initial Exploration
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>How many distinct tracks and artists are represented in the playlist data?</li>
<li>What are the 5 most popular tracks in the playlist data?</li>
<li>What is the most popular track in the playlist data that <em>does not have a corresponding entry in the song characteristics</em> data?</li>
<li>According to the song characteristics data, what is the most “danceable” track? How often does it appear in a playlist?</li>
<li>Which playlist has the longest average track length?</li>
<li>What is the most popular playlist on Spotify?</li>
</ol>
</div>
</div>
</section>
<section id="identifying-characteristics-of-popular-songs" class="level3">
<h3 class="anchored" data-anchor-id="identifying-characteristics-of-popular-songs">Identifying Characteristics of Popular Songs</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Inner Join to Combine Data Sets">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Inner Join to Combine Data Sets
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the remainder of this assignment, I recommend using an <code>inner_join</code> to combine the playlist and song characteristic data sets. This will throw out a (potentially large) fraction the playlist data, but given the timing and construction of these data exports, it is the best we can do.</p>
</div>
</div>
<p>Next, we will <em>visually</em> explore this data, with an eye towards finding characteristics of the most popular songs on Spotify.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 5: Visually Identifying Characteristics of Popular Songs">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 5: Visually Identifying Characteristics of Popular Songs
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer the following questions using one or more visualizations. Make sure your plots are “publication-quality”, with well-formatted axes, color schemes, <em>etc.</em></p>
<ol type="1">
<li><p>Is the <code>popularity</code> column correlated with the number of playlist appearances? If so, to what degree?</p>
<p>For the following questions, select a threshold that defines a “popular” song. There’s no ‘right’ answer here, but I would recommend finding a song that is right “at the line” of being popular <em>per</em> your threshold and seeing if you consider it “almost popular.” If it’s a very popular song, adjust your threshold lower; if it’s obscure, adjust your threshold higher.</p></li>
<li><p>In what year were the most popular songs released?</p></li>
<li><p>In what year did danceability peak?</p></li>
<li><p>Which decade is most represented on user playlists? (The integer division (<code>%/%</code>) operator may be useful for computing decades from years.)</p></li>
<li><p>Create a plot of key frequency among songs. Because musical keys exist in a ‘cycle’, your plot should use polar (circular) coordinates.</p></li>
<li><p>What are the most popular track lengths? (Are short tracks, long tracks, or something in between most commonly included in user playlists?)</p></li>
<li><p>Pose and visually answer at least two more other exploratory questions.</p></li>
</ol>
</div>
</div>
<p>Note that you can answer many of these using <code>dplyr</code> functions only, but a learning objective of this mini-project is to practice creating informative visualizations, so you are required to include at least one plot for each of these questions. If helpful, you can validate your visual findings with a descriptive statistic: <em>e.g.</em>, if your plot shows a positive correlation between track length and popularity, you can also compute this correlation numerically and include it in your text.</p>
</section>
<section id="building-a-playlist-from-anchor-songs" class="level3">
<h3 class="anchored" data-anchor-id="building-a-playlist-from-anchor-songs">Building a Playlist from Anchor Songs</h3>
<p>To begin building your playlist, pick one or two “anchor” songs that you like. (You can adjust these if you don’t like how your playlist comes out.)</p>
<p>You can find songs that work well in a playlist with these songs using various heuristics:</p>
<ol type="1">
<li><p>What other songs commonly appear on playlists along side this song?</p></li>
<li><p>What other songs are in the same key<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and have a similar tempo? (This makes it easy for a skilled DJ to transition from one song to the next.)</p></li>
<li><p>What other songs were released by the same artist?</p></li>
<li><p>What other songs were released in the same year and have similar levels of <code>acousticness</code>, <code>danceability</code>, <em>etc.</em>?</p></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 6: Finding Related Songs">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 6: Finding Related Songs
</div>
</div>
<div class="callout-body-container callout-body">
<p>Implement the four heuristics above plus one of your own to find potential songs that belong on a playlist with your anchor songs. You should identify at least 20 candidates, at least 8 of which are not “popular” based on the threshold you set above.</p>
</div>
</div>
</section>
<section id="create-your-playlist" class="level3">
<h3 class="anchored" data-anchor-id="create-your-playlist">Create Your Playlist</h3>
<p>Given your anchor songs and playlist candidates, it is now time to filter down to a playlist of around 12 songs, suitably ordered. Using all the data available to you, determine an optimal playlist. Your playlist should include at least 2 songs you were not previously familiar with and at least 3 which are not “popular.”</p>
<p>Once you have created your playlist, visualize its evolution on the various quantitative metrics Spotify provides. Does it, <em>per Stinson</em>, ‘rise and fall’ or is it ‘all rise’?</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 7: Curate and Analyze Your Ultimate Playlist">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 7: Curate and Analyze Your Ultimate Playlist
</div>
</div>
<div class="callout-body-container callout-body">
<p>Curate and Analyze the Ultimate Playlist per instructions above. In addition to its musical structure, make sure to consider thematic unity, <em>e.g.</em>, songs about cars, and to give your playlist a creative name.</p>
</div>
</div>
</section>
</section>
<section id="deliverable-the-ultimate-playlist" class="level2">
<h2 class="anchored" data-anchor-id="deliverable-the-ultimate-playlist">Deliverable: The Ultimate Playlist</h2>
<p>Now that you have created the Ultimate Playlist, it is time to nominate it for the Internet’s Best Playlist award. Write a title, description, and “design principles” for your playlist. Make sure to include at least one visualization that argues why your playlist is Ultimate. Describe how you used statistical and visual analysis to create this playlist, taking pride to showcase lesser known pieces that are integral to your playlist structure.</p>
</section>
<section id="extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit">Extra Credit</h2>
<p>In addition to the rubric-specified extra credit, extra credit may be given for the following:</p>
<ul>
<li>Up to 2 points: use of Quarto’s <a href="https://quarto.org/docs/authoring/videos.html">video support</a> to embed recordings of tracks from the playlist.</li>
</ul>
<hr>
<p>This work ©2025 by <a href="https://michael-weylandt.com">Michael Weylandt</a> is licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Creative Commons BY-NC-SA 4.0</a> license. <img src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" class="img-fluid" style="width:10.0%"></p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Throughout this section, replace <code>&lt;GITHUB_ID&gt;</code> with your GitHub ID from <a href="./mini00.html">Mini-Project #00</a>, making sure to remove the angle brackets. Note that the automated course infrastructure will be looking for precise formatting, so follow these instructions closely.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>As coded by the <code>key</code> column, 0 is C, 1 is C#, 2 is D, <em>etc.</em> For non-musicians, this just means that the two songs share some harmonic structure that makes it easy to tie them together.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/michael-weylandt\.com\/STA9750\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/archive/AY-2024-SPRING/miniprojects/mini03.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/archive/AY-2024-SPRING/miniprojects/mini03.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
