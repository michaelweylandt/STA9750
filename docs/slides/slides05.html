<!DOCTYPE html>
<html lang="en"><head>
<link href="../_houndfavicon.png" rel="icon" type="image/png">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.33">

  <title>STA 9750 – Software Tools for Data AnalysisSTA 9750Michael WeylandtWeek 5</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-15b32ad5b709753aad51696ffff15817.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="../images/baruch_title.png" data-background-size="100% 100%" class="quarto-title-block center">
  <h1 class="title"><br><br><br><br><br>Software Tools for Data Analysis<br>STA 9750<br>Michael Weylandt<br>Week 5</h1>

<div class="quarto-title-authors">
</div>

</section>
<section id="week" class="slide level2">
<h2>STA 9750 Week 5</h2>
<p>Today:</p>
<ul>
<li>Tuesday Section: 2025-09-30</li>
<li>Thursday Section: 2025-09-25</li>
</ul>
<p>Lecture #05: Multi-Table dplyr Verbs</p>
</section>
<section>
<section id="today" class="title-slide slide level1 center">
<h1>Today</h1>

</section>
<section id="today-1" class="slide level2">
<h2>Today</h2>
<ul>
<li>Special Presentation</li>
<li>Course Administration</li>
<li>Review</li>
<li>Diving Deeper into Multi-Table Verbs</li>
<li>PA#05 FAQs</li>
<li>Wrap-Up
<ul>
<li>Life Tip of the Day</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="special-presentation" class="title-slide slide level1 center">
<h1>Special Presentation</h1>

</section>
<section id="baruch-data-resources" class="slide level2">
<h2>Baruch Data Resources</h2>
<p><a href="https://www.baruch.cuny.edu/profiles/faculty/Jason-Amey">Jason Amey</a></p>
<p><a href="https://library.baruch.cuny.edu/">Newman Library, Baruch College CUNY</a></p>
<ul>
<li><a href="https://guides.newman.baruch.cuny.edu/opendata">Research Guide: Open Data</a></li>
</ul>
</section></section>
<section>
<section id="course-administration" class="title-slide slide level1 center">
<h1>Course Administration</h1>

</section>
<section id="mp00-peer-feedback" class="slide level2">
<h2>MP#00 Peer Feedback</h2>
<p>Mini-Project #00 Peer Feedback deadline:</p>
<div class="smaller">
<ul>
<li>Hopefully you benefitted from interaction with peers (giving and receiving comments)</li>
<li>As of 10:30am Wednesday:
<ul>
<li>37 completed properly</li>
<li>46 completed <em>with formatting issues</em></li>
<li>13 not yet started</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<p>Remember you can use <code>mp_feedback_verify</code> to confirm proper formatting:</p>
<ul>
<li>Need to get structure (<code>##</code>), not just arrangement</li>
<li>Mixing of scores and text</li>
</ul>
</div>
</section>
<section id="mp-01" class="slide level2">
<h2>STA 9750 MP #01</h2>
<p>Due on 2025-10-03 at 11:59pm ET (+ grace period)</p>
<div class="fragment">
<ul>
<li><strong>Submit early and submit often</strong>
<ul>
<li>Less “last minute” tech support going forward</li>
</ul></li>
<li>Use Piazza and use your peers</li>
</ul>
<p>You don’t need fancy graphics yet, but I of course love to see <em>above and beyond</em></p>
</div>
</section>
<section id="mp-01-1" class="slide level2">
<h2>STA 9750 MP #01</h2>
<p>Make sure your code is included in your submission</p>
<ul>
<li><a href="https://quarto.org/docs/output-formats/html-code.html#folding-code">Code-Folding</a> is very useful</li>
</ul>
<div class="fragment">
<p>Follow submission instructions</p>
<ul>
<li><p>You need to have <code>mp01.qmd</code> and <code>docs/mp01.html</code> in your <code>STA9750-2025-FALL</code> repository</p></li>
<li><p>Helper function can verify submission is properly formatted</p></li>
</ul>
</div>
</section>
<section id="pre-assignments" class="slide level2">
<h2>Pre-Assignments</h2>
<p>Brightspace - day before class at 11:45</p>
<ul>
<li>Reading, typically on course website</li>
<li>Brightspace auto-grades
<ul>
<li>I have to manually change to completion grading</li>
</ul></li>
<li>Two “drops” + otherwise free points</li>
</ul>
<div class="fragment">
<p><strong>No pre-assignment next week!</strong></p>
</div>
</section>
<section id="course-support" class="slide level2">
<h2>Course Support</h2>
<ul>
<li>Synchronous
<ul>
<li>Office Hours 2x / week</li>
</ul></li>
<li>Asynchronous
<ul>
<li>Piazza (<span class="math inline">\(\approx\)</span> 20 minute average response time)</li>
</ul></li>
</ul>
<div class="fragment">
<p>Ask questions! This course is demanding but rewarding.</p>
<p>Social contract: I push you hard, but I also provide lots of support.</p>
</div>
</section>
<section id="course-project" class="slide level2">
<h2>Course Project</h2>
<p>Roster formation deadline: 2025-09-30</p>
<div class="fragment">
<ul>
<li>7 teams already formed (38 students)</li>
<li>59 students still need a team</li>
</ul>
</div>
<div class="fragment">
<p>I’ve started setting teams up. If you don’t have a team and want to be randomly assigned, let me know.</p>
</div>
</section>
<section id="proposal-presentations" class="slide level2">
<h2>Proposal Presentations</h2>
<p>Next Week - Project Proposal Presentations (Tuesday Oct 07 and Thursday Oct 09)</p>
<p><a href="https://michael-weylandt.com/STA9750/project.html#project-proposal-presentations">Official Description</a></p>
<div class="smaller">
<ul>
<li class="fragment"><strong>6 minute presentation</strong></li>
<li class="fragment">Key topics:
<ul>
<li class="fragment"><em>Animating Question</em></li>
<li class="fragment"><em>Team Roster</em></li>
</ul></li>
<li class="fragment">Also discuss: Possible specific questions, data sources, analytical plan, anticipated challenges</li>
</ul>
</div>
<div class="fragment">
<p>Aims: make sure you’ve started thinking seriously, not locking you in to answers</p>
</div>
</section></section>
<section>
<section id="review-from-last-week" class="title-slide slide level1 center">
<h1>Review from Last Week</h1>

</section>
<section id="single-table-verbs" class="slide level2">
<h2>Single-Table Verbs</h2>
<p><code>dplyr</code> single-table verbs</p>
<ul>
<li class="fragment"><code>select</code>, <code>filter</code>: Selecting rows and columns</li>
<li class="fragment"><code>rename</code>, <code>mutate</code>: Changing rows and columns</li>
<li class="fragment"><code>summarize</code>, <code>group_by</code>: Combining multiple rows</li>
<li class="fragment"><code>arrange</code>, <code>slice_min/max</code>: Re-ordering</li>
</ul>
<div class="fragment">
<p><a href="../labs/lab05.html#review">Lab #05 Review Activity</a></p>
</div>
</section></section>
<section>
<section id="review-of-pa05" class="title-slide slide level1 center">
<h1>Review of <a href="../preassigns/pa05.html">PA#05</a></h1>

</section>
<section id="multi-table-analysis" class="slide level2">
<h2>Multi-Table Analysis</h2>
<p><em>Multiple Tables</em>:</p>
<ul>
<li>More insights than from a single table</li>
<li>Maintain ‘tidy’ structure throughout</li>
</ul>
<p>Will create new (compound) rows:</p>
<ul>
<li>Dangers: <em>drops</em> and <em>(over) duplication</em></li>
</ul>
</section>
<section id="primary-keys" class="slide level2">
<h2>Primary Keys</h2>
<div class="small">
<p><em>Keys</em> are unique identifiers for individual records</p>
<ul>
<li>Primary (one column) or compound (multiple columns together)</li>
</ul>
</div>
<div class="fragment">
<div class="small">
<p>The history of corporate IT is largely one of (failed) primary keys</p>
<ul>
<li>Finance: Tickers, Tickers + Exchange, Tickers + Share Class, CUSIP, ISIN, SEDOL, …</li>
</ul>
</div>
</div>
<div class="fragment">
<div class="small">
<p>Meaningful true keys are vanishingly rare - cherish them when you find them</p>
<p>Often ‘unique enough’ for an analysis</p>
<p><code>dplyr::group_by() + dplyr::count()</code> is helpful here</p>
</div>
</div>
</section>
<section id="joins" class="slide level2">
<h2>Joins</h2>
<p>Joins combine tables <em>by identity</em> - not simple ‘stacking’</p>
<p>Specify a <em>join key</em> - ideally this is an actual key, but doesn’t have to be</p>
<p>In <code>dplyr</code>, we use the <code>join_by</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>dplyr<span class="sc">::</span><span class="fu">join_by</span>(table_1_name <span class="sc">==</span> table_2_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here <code>table_1_name</code> and <code>table_2_name</code> are column names from two tables</p>
<div class="fragment">
<p>Join rows where these values are equal (advanced joins possible)</p>
</div>
</section>
<section id="inner-and-outer-joins" class="slide level2">
<h2>Inner and Outer Joins</h2>
<p>When tables are perfectly matched, not an issue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>cunys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  college campus_borough
  &lt;chr&gt;   &lt;chr&gt;         
1 CCNY    Manhattan     
2 Baruch  Manhattan     
3 CSI     Staten Island 
4 York    Queens        </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>routes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  borough_name  bus_code
  &lt;chr&gt;         &lt;chr&gt;   
1 Manhattan     M       
2 Staten Island S       
3 Queens        Q       </code></pre>
</div>
</div>
</section>
<section id="inner-and-outer-joins-1" class="slide level2">
<h2>Inner and Outer Joins</h2>
<p>When tables are perfectly matched, not an issue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">inner_join</span>(cunys, routes, <span class="fu">join_by</span>(campus_borough <span class="sc">==</span> borough_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  college campus_borough bus_code
  &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;   
1 CCNY    Manhattan      M       
2 Baruch  Manhattan      M       
3 CSI     Staten Island  S       
4 York    Queens         Q       </code></pre>
</div>
</div>
<p>Default to <code>inner</code> but irrelevant</p>
<p>Note automatic repetition of <code>"M"</code> row</p>
</section>
<section id="inner-and-outer-joins-2" class="slide level2">
<h2>Inner and Outer Joins</h2>
<p>How to handle ‘unaligned’ values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>cunys <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span>college, <span class="sc">~</span>campus_borough, </span>
<span id="cb8-2"><a></a>                 <span class="st">"CCNY"</span>, <span class="st">"Manhattan"</span>,</span>
<span id="cb8-3"><a></a>                 <span class="st">"Baruch"</span>, <span class="st">"Manhattan"</span>, </span>
<span id="cb8-4"><a></a>                 <span class="st">"CSI"</span>, <span class="st">"Staten Island"</span>,</span>
<span id="cb8-5"><a></a>                 <span class="st">"York"</span>, <span class="st">"Queens"</span>, </span>
<span id="cb8-6"><a></a>                 <span class="st">"Medgar Evers"</span>, <span class="st">"Brooklyn"</span>)</span>
<span id="cb8-7"><a></a></span>
<span id="cb8-8"><a></a><span class="fu">inner_join</span>(cunys, routes, <span class="fu">join_by</span>(campus_borough <span class="sc">==</span> borough_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  college campus_borough bus_code
  &lt;chr&gt;   &lt;chr&gt;          &lt;chr&gt;   
1 CCNY    Manhattan      M       
2 Baruch  Manhattan      M       
3 CSI     Staten Island  S       
4 York    Queens         Q       </code></pre>
</div>
</div>
<div class="fragment">
<p><span class="light-content" style="color: red;">MEC vanished!</span></p>
</div>
</section>
<section id="inner-and-outer-joins-3" class="slide level2">
<h2>Inner and Outer Joins</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">left_join</span>(cunys, routes, <span class="fu">join_by</span>(campus_borough <span class="sc">==</span> borough_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  college      campus_borough bus_code
  &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;   
1 CCNY         Manhattan      M       
2 Baruch       Manhattan      M       
3 CSI          Staten Island  S       
4 York         Queens         Q       
5 Medgar Evers Brooklyn       &lt;NA&gt;    </code></pre>
</div>
</div>
<p>MEC stays, but no bus code - <code>NA</code> value</p>
<div class="fragment">
<div class="smaller">
<ul>
<li><code>inner_join</code> - Keep only matches</li>
<li><code>left_join</code> - Keep all rows in left (first) table even w/o matches</li>
<li><code>right_join</code> - Keep all rows in right (second) table even w/o matches</li>
<li><code>full_join</code> - Keep all rows from both tables, even w/o matches</li>
</ul>
</div>
<p><code>left_</code> and <code>right_</code> are types of ‘outer’ joins</p>
</div>
</section>
<section id="pivoting" class="slide level2">
<h2>Pivoting</h2>
<p>The <code>pivot_*</code> functions change the <strong>shape</strong> of data</p>
<ul>
<li class="fragment">Values are not created or destroyed, just moved around</li>
<li class="fragment"><strong>wider</strong> data sets are formed by forming multiple rows into columns</li>
<li class="fragment"><strong>longer</strong> data sets are splitting columns from the same row into new rows</li>
</ul>
<div class="fragment">
<p>These functions come from the <code>tidyr</code> package - not <code>dplyr</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">library</span>(tidyr) <span class="co"># included in library(tidyverse)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="pivoting-1" class="slide level2">
<h2>Pivoting</h2>
<p>Untidy example from last week:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   Semester Course     Number Type      
   &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     
 1 Fall     Accounting    200 Enrollment
 2 Fall     Accounting    250 Cap       
 3 Fall     Law           100 Enrollment
 4 Fall     Law           125 Cap       
 5 Fall     Statistics    200 Enrollment
 6 Fall     Statistics    200 Cap       
 7 Spring   Accounting    300 Enrollment
 8 Spring   Accounting    350 Cap       
 9 Spring   Law            50 Enrollment
10 Spring   Law           100 Cap       
11 Spring   Statistics    400 Enrollment
12 Spring   Statistics    400 Cap       </code></pre>
</div>
</div>
</section>
<section id="pivoting-2" class="slide level2">
<h2>Pivoting</h2>
<p>This data was untidy because it split a single unit (course) across multiple rows</p>
<p><code>pivot_wider</code> to get to the right format</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">pivot_wider</span>(BARUCH_UNTIDY, <span class="at">names_from=</span>Type, <span class="at">values_from=</span>Number)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  Semester Course     Enrollment   Cap
  &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;
1 Fall     Accounting        200   250
2 Fall     Law               100   125
3 Fall     Statistics        200   200
4 Spring   Accounting        300   350
5 Spring   Law                50   100
6 Spring   Statistics        400   400</code></pre>
</div>
</div>
</div>
</section>
<section id="pivots" class="slide level2">
<h2>Pivots</h2>
<p><code>pivot_</code> changes the shape of a data set. Purposes:</p>
<ul>
<li>Get ready for presentation</li>
<li>Prep for a join</li>
<li>Combine rows before looking at ‘cross-row’ structure</li>
</ul>
</section>
<section id="pivots-1" class="slide level2">
<h2>Pivots</h2>
<p>Which penguin species has the largest between-sex mass difference?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="fu">library</span>(tidyr)</span>
<span id="cb16-2"><a></a>avg_mass_tbl <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a></a>    <span class="fu">group_by</span>(sex, species) <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a></a>    <span class="fu">summarize</span>(<span class="at">avg_mass =</span> <span class="fu">mean</span>(body_mass), <span class="at">.groups=</span><span class="st">"drop"</span>)</span>
<span id="cb16-5"><a></a>    <span class="co"># .groups="drop" is equivalent to |&gt; ungroup()</span></span>
<span id="cb16-6"><a></a>avg_mass_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  sex    species   avg_mass
  &lt;fct&gt;  &lt;fct&gt;        &lt;dbl&gt;
1 female Adelie       3369.
2 female Chinstrap    3527.
3 female Gentoo       4680.
4 male   Adelie       4043.
5 male   Chinstrap    3939.
6 male   Gentoo       5485.</code></pre>
</div>
</div>
</section>
<section id="pivots-2" class="slide level2">
<h2>Pivots</h2>
<p>We want data that is <em>wider</em> than our current data:</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>species</th>
<th>male_avg</th>
<th>female_avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adelie</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td>Chinstrap</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>Gentoo</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</section>
<section id="pivots-3" class="slide level2">
<h2>Pivots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">pivot_wider</span>(avg_mass_tbl, </span>
<span id="cb18-2"><a></a>            <span class="at">id_cols =</span> species, </span>
<span id="cb18-3"><a></a>            <span class="at">names_from=</span>sex, </span>
<span id="cb18-4"><a></a>            <span class="at">values_from=</span>avg_mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  species   female  male
  &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 Adelie     3369. 4043.
2 Chinstrap  3527. 3939.
3 Gentoo     4680. 5485.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a><span class="fu">pivot_wider</span>(avg_mass_tbl, </span>
<span id="cb20-2"><a></a>            <span class="at">id_cols =</span> species, </span>
<span id="cb20-3"><a></a>            <span class="at">names_from=</span>sex, </span>
<span id="cb20-4"><a></a>            <span class="at">values_from=</span>avg_mass) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a></a>    <span class="fu">mutate</span>(<span class="at">sex_diff =</span> male <span class="sc">-</span> female) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a></a>    <span class="fu">slice_max</span>(sex_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  species female  male sex_diff
  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 Gentoo   4680. 5485.     805.</code></pre>
</div>
</div>
</section>
<section id="pivots-4" class="slide level2">
<h2>Pivots</h2>
<p><code>pivot_wider</code> Arguments:</p>
<div class="small">
<ul>
<li><code>id_cols</code>: kept as ‘keys’ for new table</li>
<li><code>names_from</code>: existing column ‘spread’ to create new columns names</li>
<li><code>values_from</code>: values in new table</li>
</ul>
</div>
<div class="fragment">
<p><code>pivot_longer</code>:</p>
<div class="small">
<ul>
<li>‘Inverse’ operation</li>
<li>Spread one row + multiple columns =&gt; one col + multiple rows</li>
</ul>
</div>
</div>
<div class="fragment">
<div class="small">
<p><code>pivot_wider</code> and <code>pivot_longer</code> have many additional arguments for dealing with repeats / missing values. The help page (+ experimenting) is your friend</p>
</div>
</div>
</section>
<section id="legos-of-data-analysis" class="slide level2">
<h2>Legos of Data Analysis</h2>
<p>These functions are like Legos:</p>
<ul>
<li>Simple individually</li>
<li>Combine for complex structures</li>
</ul>
</section>
<section id="legos-of-data-analysis-1" class="slide level2">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-2"><a></a><span class="fu">library</span>(nycflights13)</span>
<span id="cb22-3"><a></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a></a>    <span class="fu">n_distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 336776</code></pre>
</div>
</div>
<div class="fragment">
<p>Not quite what we wanted…</p>
</div>
</section>
<section id="legos-of-data-analysis-2" class="slide level2">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<div class="fragment">
<p>How many unique combinations of <code>carrier</code> + <code>flight</code> (<em>e.g.</em>, United 101)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a></a>    <span class="fu">select</span>(carrier, flight) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a></a>    <span class="fu">n_distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5725</code></pre>
</div>
</div>
</div>
</section>
<section id="legos-of-data-analysis-3" class="slide level2">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<div class="small">
<p>💡 Did airlines re-use flight numbers for different destinations?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a></a>    <span class="co"># Find reuse of number across different destinations</span></span>
<span id="cb26-4"><a></a>    <span class="co"># Shorthand for group_by + summarize(n = n())</span></span>
<span id="cb26-5"><a></a>    <span class="fu">count</span>(carrier, flight) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,725 × 3
   carrier flight     n
   &lt;chr&gt;    &lt;int&gt; &lt;int&gt;
 1 9E        2900     1
 2 9E        2901     1
 3 9E        2902     1
 4 9E        2903     2
 5 9E        2904     2
 6 9E        2905     1
 7 9E        2906     1
 8 9E        2907     1
 9 9E        2908     1
10 9E        2909     2
# ℹ 5,715 more rows</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>Seems so!</p>
</div>
</section>
<section id="legos-of-data-analysis-4" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Find examples of re-use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a></a>    <span class="fu">slice_max</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  carrier flight     n
  &lt;chr&gt;    &lt;int&gt; &lt;int&gt;
1 UA        1162    16</code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-5" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Finding most re-used flight number:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a></a>    <span class="fu">slice_max</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a></a>    <span class="fu">left_join</span>(flights, <span class="fu">join_by</span>(carrier <span class="sc">==</span> carrier, flight <span class="sc">==</span> flight)) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a></a>    <span class="fu">pull</span>(dest) <span class="sc">|&gt;</span> <span class="co"># pull out column as vector</span></span>
<span id="cb30-7"><a></a>    <span class="fu">table</span>() <span class="co"># frequency table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
BOS CLE DEN DFW IAH JAC LAS MIA MSY ORD SAN SAT SEA SFO SNA TPA 
 13   1  19   5   8   2   1   2   8  55   4   1  18   2  27   4 </code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-6" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Finding most re-used flight number:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a></a>    <span class="fu">slice_max</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  carrier flight     n
  &lt;chr&gt;    &lt;int&gt; &lt;int&gt;
1 UA        1162    16</code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-7" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Seeing where our most reused number went:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a></a>    <span class="fu">slice_max</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a></a>    <span class="fu">inner_join</span>(flights, <span class="fu">join_by</span>(carrier <span class="sc">==</span> carrier, flight <span class="sc">==</span> flight)) <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a></a>    <span class="fu">count</span>(flight, carrier, dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   flight carrier dest      n
    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt;
 1   1162 UA      BOS      13
 2   1162 UA      CLE       1
 3   1162 UA      DEN      19
 4   1162 UA      DFW       5
 5   1162 UA      IAH       8
 6   1162 UA      JAC       2
 7   1162 UA      LAS       1
 8   1162 UA      MIA       2
 9   1162 UA      MSY       8
10   1162 UA      ORD      55
11   1162 UA      SAN       4
12   1162 UA      SAT       1
13   1162 UA      SEA      18
14   1162 UA      SFO       2
15   1162 UA      SNA      27
16   1162 UA      TPA       4</code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-8" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Additional join to get airport information + formatting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a></a>    <span class="fu">slice_max</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a></a>    <span class="fu">inner_join</span>(flights, <span class="fu">join_by</span>(carrier <span class="sc">==</span> carrier, flight <span class="sc">==</span> flight)) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a></a>    <span class="fu">count</span>(flight, carrier, dest) <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a></a>    <span class="fu">inner_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa)) <span class="sc">|&gt;</span></span>
<span id="cb36-8"><a></a>    <span class="fu">select</span>(name, n, carrier, flight) <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">Destination Airport</span><span class="st">`</span> <span class="ot">=</span> name, </span>
<span id="cb36-11"><a></a>           <span class="st">`</span><span class="at">Number of Times Flown</span><span class="st">`</span> <span class="ot">=</span> n, </span>
<span id="cb36-12"><a></a>           <span class="st">`</span><span class="at">Carrier Code</span><span class="st">`</span> <span class="ot">=</span> carrier, </span>
<span id="cb36-13"><a></a>           <span class="st">`</span><span class="at">Flight Number</span><span class="st">`</span><span class="ot">=</span> flight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   `Destination Airport`   Number of Times Flow…¹ `Carrier Code` `Flight Number`
   &lt;chr&gt;                                    &lt;int&gt; &lt;chr&gt;                    &lt;int&gt;
 1 Chicago Ohare Intl                          55 UA                        1162
 2 John Wayne Arpt Orange…                     27 UA                        1162
 3 Denver Intl                                 19 UA                        1162
 4 Seattle Tacoma Intl                         18 UA                        1162
 5 General Edward Lawrenc…                     13 UA                        1162
 6 George Bush Interconti…                      8 UA                        1162
 7 Louis Armstrong New Or…                      8 UA                        1162
 8 Dallas Fort Worth Intl                       5 UA                        1162
 9 San Diego Intl                               4 UA                        1162
10 Tampa Intl                                   4 UA                        1162
11 Jackson Hole Airport                         2 UA                        1162
12 Miami Intl                                   2 UA                        1162
13 San Francisco Intl                           2 UA                        1162
14 Cleveland Hopkins Intl                       1 UA                        1162
15 Mc Carran Intl                               1 UA                        1162
16 San Antonio Intl                             1 UA                        1162
# ℹ abbreviated name: ¹​`Number of Times Flown`</code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-9" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<div class="small">
<p>Extra join to match to <code>airlines</code> as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a><span class="fu">head</span>(airlines, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  carrier name                  
  &lt;chr&gt;   &lt;chr&gt;                 
1 9E      Endeavor Air Inc.     
2 AA      American Airlines Inc.
3 AS      Alaska Airlines Inc.  </code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>Also has a column named <code>name</code> - need to disambiguate!</p>
</div>
</section>
<section id="legos-of-data-analysis-10" class="slide level2 scrollable">
<h2>Legos of Data Analysis</h2>
<p><strong>Q: How many distinct flights left NYC in 2013?</strong></p>
<p>Additional join to get airport information + formatting:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a></a>    <span class="fu">distinct</span>(carrier, flight, dest) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a></a>    <span class="fu">count</span>(carrier, flight) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a></a>    <span class="fu">slice_max</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb40-5"><a></a>    <span class="fu">inner_join</span>(flights, <span class="fu">join_by</span>(carrier <span class="sc">==</span> carrier, flight <span class="sc">==</span> flight)) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a></a>    <span class="fu">count</span>(flight, carrier, dest) <span class="sc">|&gt;</span>  </span>
<span id="cb40-7"><a></a>    <span class="fu">inner_join</span>(airports, <span class="fu">join_by</span>(dest <span class="sc">==</span> faa)) <span class="sc">|&gt;</span></span>
<span id="cb40-8"><a></a>    <span class="fu">select</span>(name, n, carrier, flight) <span class="sc">|&gt;</span></span>
<span id="cb40-9"><a></a>    <span class="fu">rename</span>(<span class="at">dest_name =</span> name) <span class="sc">|&gt;</span> </span>
<span id="cb40-10"><a></a>    <span class="fu">inner_join</span>(airlines, <span class="fu">join_by</span>(carrier <span class="sc">==</span> carrier)) <span class="sc">|&gt;</span> </span>
<span id="cb40-11"><a></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a></a>    <span class="fu">select</span>(<span class="sc">-</span>carrier) <span class="sc">|&gt;</span> </span>
<span id="cb40-13"><a></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">Destination Airport</span><span class="st">`</span> <span class="ot">=</span> dest_name, </span>
<span id="cb40-14"><a></a>           <span class="st">`</span><span class="at">Number of Times Flown</span><span class="st">`</span> <span class="ot">=</span> n, </span>
<span id="cb40-15"><a></a>           <span class="st">`</span><span class="at">Carrier</span><span class="st">`</span> <span class="ot">=</span> name, </span>
<span id="cb40-16"><a></a>           <span class="st">`</span><span class="at">Flight Number</span><span class="st">`</span><span class="ot">=</span> flight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   `Destination Airport`          Number of Times Flow…¹ `Flight Number` Carrier
   &lt;chr&gt;                                           &lt;int&gt;           &lt;int&gt; &lt;chr&gt;  
 1 Chicago Ohare Intl                                 55            1162 United…
 2 John Wayne Arpt Orange Co                          27            1162 United…
 3 Denver Intl                                        19            1162 United…
 4 Seattle Tacoma Intl                                18            1162 United…
 5 General Edward Lawrence Logan…                     13            1162 United…
 6 George Bush Intercontinental                        8            1162 United…
 7 Louis Armstrong New Orleans I…                      8            1162 United…
 8 Dallas Fort Worth Intl                              5            1162 United…
 9 San Diego Intl                                      4            1162 United…
10 Tampa Intl                                          4            1162 United…
11 Jackson Hole Airport                                2            1162 United…
12 Miami Intl                                          2            1162 United…
13 San Francisco Intl                                  2            1162 United…
14 Cleveland Hopkins Intl                              1            1162 United…
15 Mc Carran Intl                                      1            1162 United…
16 San Antonio Intl                                    1            1162 United…
# ℹ abbreviated name: ¹​`Number of Times Flown`</code></pre>
</div>
</div>
</section>
<section id="legos-of-data-analysis-11" class="slide level2">
<h2>Legos of Data Analysis</h2>
<p>Question: What does this do I can’t do in <code>Excel</code>?</p>
<div class="fragment">
<p><em>Technically</em>, nothing. All programming languages of sufficient complexity are equally powerful (Turing equivalence).</p>
<p><br></p>
</div>
<div class="fragment">
<p>In actuality, quite a lot:</p>
<ul>
<li><p><code>filter</code> allows more complex filtering than clicking on values</p></li>
<li><p><code>group_by</code> + <code>summarize</code> extend array formulas</p></li>
<li><p><code>*_join</code> provides more complex matching than <code>VLOOKUP</code></p></li>
<li><p><code>pivot_*</code> provide general formulation of pivot tables</p></li>
<li><p>everything else you can do in <code>R</code>.</p></li>
</ul>
<p>Ability to <em>script</em> minimizes “hard-coding” of names and values.</p>
</div>
</section>
<section id="but-truthfully" class="slide level2">
<h2>But truthfully</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a>fortunes<span class="sc">::</span><span class="fu">fortune</span>(<span class="dv">59</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Let's not kid ourselves: the most widely used piece of software for statistics
is Excel.
   -- Brian D. Ripley ('Statistical Methods Need Software: A View of
      Statistical Computing')
      Opening lecture RSS 2002, Plymouth (September 2002)</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a>fortunes<span class="sc">::</span><span class="fu">fortune</span>(<span class="dv">222</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Some people familiar with R describe it as a supercharged version of
Microsoft's Excel spreadsheet software.
   -- Ashlee Vance (in his article "Data Analysts Captivated by R's Power")
      The New York Times (January 2009)</code></pre>
</div>
</div>
</div>
</section></section>
<section>
<section id="diving-deeper-into-multi-table-verbs" class="title-slide slide level1 center">
<h1>Diving Deeper into Multi-Table Verbs</h1>

</section>
<section id="diving-deeper-into-joins" class="slide level2">
<h2>Diving deeper Into Joins</h2>
<p>Data Set: <a href="https://nycflights13.tidyverse.org/"><code>nycflights13</code></a></p>
<p>Exercises: <a href="../labs/lab05.html">Lab #05</a></p>
</section>
<section id="additional-dplyr-tricks" class="slide level2">
<h2>Additional dplyr Tricks</h2>
<ul>
<li class="fragment">Ranking functions
<ul>
<li class="fragment"><code>row_number</code>, <code>min_rank</code>, <code>dense_rank</code>: differ in ties</li>
<li class="fragment">Use with <code>desc()</code> to flip ordering</li>
<li class="fragment"><code>cum_dist</code>, <code>percent_rank</code>: compute quantiles</li>
</ul></li>
<li class="fragment">Cumulative Statistics
<ul>
<li class="fragment"><code>cummean</code>, <code>cummax</code>, <code>cummin</code>, …</li>
</ul></li>
<li class="fragment"><em>Conditional</em> mutation
<ul>
<li class="fragment"><code>if_else</code>, <code>case_when</code>, default <code>TRUE</code> trick</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="pre-assignment-05-faqs" class="title-slide slide level1 center">
<h1>Pre-Assignment #05 FAQs</h1>

</section>
<section id="subqueries" class="slide level2">
<h2>Subqueries</h2>
<blockquote>
<p>[W]ill we be learning how to perform joins within a subquery?</p>
</blockquote>
<p>You don’t need subqueries in <code>R</code> since it’s an imperative language. Just create a new variable to represent the result of the subquery and use that in the next command.</p>
<pre><code>SELECT first_name, last_name
FROM collectors
WHERE id IN (
    SELECT collector_id
    FROM sales
);</code></pre>
<pre><code>collector_ids &lt;- sales |&gt; pull(collector_id)
collectors |&gt; filter(id %in% collector_ids) |&gt; select(first_name, last_name)</code></pre>
</section>
<section id="data-integrity" class="slide level2">
<h2>Data Integrity</h2>
<blockquote>
<p>[H]ow can we ensure that the information [resulting from a join] is accurate and not repeated?</p>
</blockquote>
<ol type="1">
<li>If you have a true unique ID, you’re usually safe</li>
<li>Pay attention to all warnings</li>
<li>Manually examine the result of any joins</li>
</ol>
</section>
<section id="performance" class="slide level2">
<h2>Performance</h2>
<blockquote>
<p>Will joining large data sets […] affect performance?</p>
</blockquote>
<p>Somewhat - larger data sets are always slower.</p>
<p>Bigger danger is “bad joins” creating huge data automatically.</p>
<p>Note that <code>R</code> is less “smart” than <code>SQL</code>, so won’t optimize execution order for you automatically.</p>
</section>
<section id="dplyr-joins-vs-sql-joins" class="slide level2">
<h2>dplyr joins vs SQL joins</h2>
<blockquote>
<p>What is the difference between <code>dplyr</code> and <code>SQL</code> joins?</p>
</blockquote>
<p>Not too much - biggest difference is no <code>INDEX</code> or <code>FOREIGN KEY</code> in <code>R</code> so less guarantees of data integrity.</p>
</section>
<section id="when-to-use-anti_join" class="slide level2">
<h2>When to use anti_join()?</h2>
<p>Rare: looking for <em>unmatched</em> rows.</p>
<ul>
<li>Useful to find data integrity issues or ‘implicit’ missingness.</li>
<li>I use an <code>anti_join</code> to find students who haven’t submitted an assignment.</li>
</ul>
</section>
<section id="many-to-many-warning" class="slide level2">
<h2>many-to-many Warning</h2>
<p>Tricky to address, but fortunately pretty rare.</p>
<ul>
<li><code>SQL</code> explicitly forbids many-to-many</li>
<li>Usually a sign that a “key” isn’t really unique
<ul>
<li>Check for duplicates in <code>x</code> and <code>y</code> tables</li>
<li>Can occur with “fancy” joins (rolling, inequality)</li>
</ul></li>
<li>Add additional join variables to break “duplication”</li>
</ul>
</section>
<section id="how-to-check-efficiency" class="slide level2">
<h2>How to Check Efficiency?</h2>
<p>No automatic way. Some rules of thumb:</p>
<ul>
<li>Don’t create large tables just to filter down
<ul>
<li>filter before join when possible</li>
</ul></li>
<li><code>full_outer</code> join is a bit dangerous</li>
<li><code>cross_join</code> is <em>rarely</em> the right answer</li>
</ul>
</section>
<section id="tidyr-vs-dplyr" class="slide level2">
<h2>tidyr vs dplyr</h2>
<blockquote>
<p>Is <code>tidyr</code> more efficient than <code>dplyr</code>?</p>
</blockquote>
<p>Nope - different packages from the same developers.</p>
<p>Designed to work together elegantly.</p>
</section>
<section id="rare-joins" class="slide level2">
<h2>Rare Joins</h2>
<blockquote>
<p>What are <code>cross_join</code>, filter joins, and <code>nest_join</code>?</p>
</blockquote>
<ul>
<li><code>cross_join</code>: dangerous.
<ul>
<li>Creates “all pairs” of rows. Useful for ‘design’ problems</li>
</ul></li>
<li>filter joins (<code>anti_</code>, <code>semi_</code>):
<ul>
<li>Hunting down quietly missing data.</li>
<li>Filtering to sub-samples</li>
</ul></li>
<li><code>nest_join</code>: beyond this course.
<ul>
<li><code>left_join</code> with extra structure to output.</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="wrap-up" class="title-slide slide level1 center">
<h1>Wrap-Up</h1>

</section>
<section id="review" class="slide level2">
<h2>Review</h2>
<p>Multi-Table <code>dplyr</code>:</p>
<ul>
<li><code>inner_join</code> and <code>left_join</code></li>
<li><code>join_by</code> specifications</li>
<li><code>pivot_longer</code> and <code>pivot_wider</code> to get data into optimal formats (<code>tidyr</code>)</li>
</ul>
<div class="fragment">
<p>Additional <code>dplyr</code>:</p>
<ul>
<li>Ranking, cumulative, and shift functions</li>
<li><em>Conditional</em> mutation</li>
</ul>
</div>
</section>
<section id="upcoming-work" class="slide level2">
<h2>Upcoming Work</h2>
<p>Upcoming work from <a href="../index.html#calendar">course calendar</a></p>
<ul>
<li class="fragment"><a href="../preassigns/pa07.html">Pre-Assignment #07</a> due 2025-10-20 at 11:59pm ET</li>
<li class="fragment"><a href="../miniprojects/mini01.html">Mini-Project #01</a> due on 2025-10-03 at 11:59pm ET</li>
<li class="fragment">Project Teams by 2025-09-30</li>
<li class="fragment">Project Proposals on Tuesday Oct 07 and Thursday Oct 09</li>
</ul>
</section>
<section id="life-tip-of-the-week" class="slide level2">
<h2>Life Tip of the Week</h2>
<h3 id="easy-duplicate-emails-with-gmail">Easy Duplicate Emails with Gmail</h3>
<p>If you have a <code>gmail</code> account, you actually have <em>infinite</em> accounts:</p>
<p><code>email+tag@gmail.com</code> gets forwarded to <code>email@gmail.com</code></p>
<p>for <em>any</em> (reasonable) <code>tag</code></p>
</section>
<section id="duplicate-emails-with-gmail" class="slide level2">
<h2>Duplicate Emails with Gmail</h2>
<p>Use this to:</p>
<ul>
<li>Track <em>who</em> is reselling your email</li>
<li>Get access to ‘new account sales’ / ‘signup promotions’
<ul>
<li>Typically based on new email</li>
</ul></li>
<li>Quickly sort and organize emails</li>
</ul>
</section>
<section id="musical-treat" class="slide level2">
<h2>Musical Treat</h2>
<p><br></p>
<iframe data-external="1" src="https://www.youtube.com/embed/ohDqL6pjpjY" width="80%" height="400px" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: '80%',

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/michael-weylandt\.com\/STA9750\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>