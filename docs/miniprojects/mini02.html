<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>STA 9750 Mini-Project #02: Making Backyards Affordable for All – STA 9750</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../_houndfavicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1c47065645911eb62ace0da5c8a22cd9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STA 9750</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href=".././syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././preassignments.html"> 
<span class="menu-text">Pre-Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././labs.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././miniprojects.html"> 
<span class="menu-text">Mini Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././project.html"> 
<span class="menu-text">Course Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././resources.html"> 
<span class="menu-text">Additional Resources and Course Policies</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././objectives.html"> 
<span class="menu-text">Learning Objectives</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-prior-offerings" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Prior Offerings</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-prior-offerings">
<li>
    <a class="dropdown-item" href=".././archive/AY-2024-SPRING/">
 <span class="dropdown-text">Spring 2025</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././archive/AY-2024-FALL/">
 <span class="dropdown-text">Fall 2024</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#due-dates" id="toc-due-dates" class="nav-link active" data-scroll-target="#due-dates">Due Dates</a></li>
  <li>
<a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
<li><a href="#student-responsbilities" id="toc-student-responsbilities" class="nav-link" data-scroll-target="#student-responsbilities">Student Responsbilities</a></li>
  <li><a href="#rubric" id="toc-rubric" class="nav-link" data-scroll-target="#rubric">Rubric</a></li>
  <li><a href="#submission-instructions" id="toc-submission-instructions" class="nav-link" data-scroll-target="#submission-instructions">Submission Instructions</a></li>
  </ul>
</li>
  <li>
<a href="#mini-project" id="toc-mini-project" class="nav-link" data-scroll-target="#mini-project">Mini-Project #02: Making Backyards Affordable for All</a>
  <ul class="collapse">
<li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">Data Acquisition</a></li>
  <li><a href="#data-integration-and-initial-exploration" id="toc-data-integration-and-initial-exploration" class="nav-link" data-scroll-target="#data-integration-and-initial-exploration">Data Integration and Initial Exploration</a></li>
  <li><a href="#building-indices-of-housing-affordability-and-housing-stock-growth" id="toc-building-indices-of-housing-affordability-and-housing-stock-growth" class="nav-link" data-scroll-target="#building-indices-of-housing-affordability-and-housing-stock-growth">Building Indices of Housing Affordability and Housing Stock Growth</a></li>
  <li><a href="#policy-brief" id="toc-policy-brief" class="nav-link" data-scroll-target="#policy-brief">Policy Brief</a></li>
  </ul>
</li>
  <li>
<a href="#extra_credit" id="toc-extra_credit" class="nav-link" data-scroll-target="#extra_credit">Extra Credit Opportunities</a>
  <ul class="collapse">
<li><a href="#ec01" id="toc-ec01" class="nav-link" data-scroll-target="#ec01">Extra Credit Opportunity #01: Relationship Diagram</a></li>
  <li><a href="#ec02" id="toc-ec02" class="nav-link" data-scroll-target="#ec02">Extra Credit Opportunity #02: Highlighting Important Units in a Spaghetti Plot</a></li>
  <li><a href="#ec03" id="toc-ec03" class="nav-link" data-scroll-target="#ec03">Extra Credit Opportunity #03: Increasing Millenial Appeal</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/miniprojects/mini02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/miniprojects/mini02.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">STA 9750 Mini-Project #02: Making Backyards Affordable for All</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="due-dates" class="level3"><h3 class="anchored" data-anchor-id="due-dates">Due Dates</h3>
<ul>
<li>Released to Students: 2025-09-30</li>
<li><strong>Initial Submission: 2025-10-31 11:59pm ET on GitHub and Brightspace</strong></li>
<li>
<strong>Peer Feedback:</strong>
<ul>
<li>Peer Feedback Assigned: 2025-11-03 on GitHub</li>
<li><strong>Peer Feedback Due: 2025-11-14 11:59pm ET on GitHub</strong></li>
</ul>
</li>
</ul>
<p><em>Estimated Time to Complete: 9 Hours</em></p>
<p><em>Estimated Time for Peer Feedback: 1 Hour</em></p>
</section><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Housing affordability is one of the greatest challenges facing New York City today. Your instructor, a Houstonian by birth and affection, is a firm believer in the power of permissive zoning practices to reduce housing costs and to make cities more diverse, affordable, and dynamic. He proudly stands with the forces of YIMBYism, standing athwart local <a href="https://en.wikipedia.org/wiki/NIMBY">NIMBYs</a> and shouting “build!” In this mini-project, we will identify America’s most “YIMBY” cities using a variety of census data sources and real estate indices. This project is inspired by a similar project from the YouTuber Ray Delahanty, <em>a.k.a.</em> CityNerd, which you can view here:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/NJ4T_BHFgt0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Note that our project is similar to CityNerd’s but our analysis is somewhat simplified, uses different techniques and data sources, and you should not expect your results to match perfectly.</p>
<p>Below, you will use the results of your analysis to lobby politicians in support of a federal YIMBY-incentive program. In particular, you will prepare a short policy brief-a sort of written elevator pitch-that is designed to help you find congressional representatives whose districts would benefit from adopting YIMBY-type policies and whose reelection prospects would be improved by sponsoring this type of bill. The political analysis here is a bit superficial, but it should give you a taste of how you might use different data analytic techniques to <em>tailor</em> an argument to a specific audience.</p>
<p>In this mini-project, you will:</p>
<ol type="1">
<li>Practice use of <code>dplyr</code> for combining and manipulating data from distinct sources</li>
<li>Practice use of <code>ggplot2</code> to create compelling statistical visualizations. Note that this assignment only requires “basic” <code>ggplot2</code> visualizations like scatterplots or line graphs; <a href="mini03.html">Mini-Project #03</a> will require more complex visualization.</li>
<li>Practice summarizing complex analytical pipelines for non-technical audiences.</li>
</ol>
<p>As with <a href="mini01.html">Mini-Project #01</a>, a major portion of your grade is based on the <em>communication and writing</em> elements of this mini-project, so make sure to budget sufficient time for the writing process. Code without context has little practical value - you are always writing and conveying your analysis to a specific target audience.</p>
<section id="student-responsbilities" class="level3"><h3 class="anchored" data-anchor-id="student-responsbilities">Student Responsbilities</h3>
<p>Recall our basic analytic workflow and table of student responsibilities:</p>
<ul>
<li>Data Ingest and Cleaning: Given a single data source, read it into <code>R</code> and transform it to a reasonably useful standardized format.</li>
<li>Data Combination and Alignment: Combine multiple data sources to enable insights not possible from a single source.</li>
<li>Descriptive Statistical Analysis: Take a data table and compute informative summary statistics from both the entire population and relevant subgroups</li>
<li>Data Visualization: Generate insightful data visualizations to spur insights not attainable from point statistics</li>
<li>Inferential Statistical Analysis and Modeling: Develop relevant predictive models and statistical analyses to generate insights about the <em>underlying population</em> and not simply the data at hand.</li>
</ul>
<table class="table-hover caption-top table">
<caption>Students’ Responsibilities in Mini-Project Analyses</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 27%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;"></th>
<th style="text-align: center;">Ingest and Cleaning</th>
<th style="text-align: center;">Combination and Alignment</th>
<th style="text-align: center;">Descriptive Statistical Analysis</th>
<th style="text-align: center;">Visualization</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #01</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #02</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>Mini-Project #03</strong></td>
<td style="text-align: center;"><strong>½</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Mini-Project #04</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
<td style="text-align: center;"><strong>✓</strong></td>
</tr>
</tbody>
</table>
<p>In this mini-project, you are mainly responsible for data alignment and basic statistical analyses. While not the main focus of this mini-project, you are also expected to provide basic data visualizations to support your findings; the grading rubric, below, emphasizes the <code>dplyr</code> tools used in this project, but reports without any visualization will be penalized severely. Note that data visualization will play a larger role in Mini-Project #03.</p>
<p>As before, I will provide code to automatically download and read in the data used for this project. Also note that, as compared with Mini-Project #01, I am providing less ‘scaffolding’: students are more responsible for directing their own analyses.</p>
</section><section id="rubric" class="level3"><h3 class="anchored" data-anchor-id="rubric">Rubric</h3>
<p>STA 9750 Mini-Projects are evaluated using <em>peer grading</em> with <em>meta-review</em> by the course GTAs. The following rubric will be used for this mini-project:</p>
<table id="rubric_table" class="table-hover caption-top table" width="1,1,1,1,1,1">
<thead><tr class="header">
<th style="text-align: center;">Course Element</th>
<th style="text-align: left;">Excellent (9-10)</th>
<th style="text-align: left;">Great (7-8)</th>
<th style="text-align: left;">Good (5-6)</th>
<th style="text-align: left;">Adequate (3-4)</th>
<th style="text-align: left;">Needs Improvements (1-2)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Written Communication</td>
<td style="text-align: left;">Report is well-written and flows naturally. Motivation for key steps is clearly explained to reader without excessive detail. Key findings are highlighted and appropriately given context.</td>
<td style="text-align: left;">Report has no grammatical or writing issues. Writing is accessible and flows naturally. Key findings are highlighted, but lack suitable motivation and context.</td>
<td style="text-align: left;">Report has no grammatical or writing issues. Key findings are present but insufficiently highlighted.</td>
<td style="text-align: left;">Writing is intelligible, but has some grammatical errors. Key findings are obscured.</td>
<td style="text-align: left;">Report exhibits significant weakness in written communication. Key points are difficult to discern.</td>
</tr>
<tr class="even">
<td style="text-align: center;">Project Skeleton</td>
<td style="text-align: left;">Code completes all instructor-provided tasks correctly. Responses to open-ended tasks are particularly insightful and creative.</td>
<td style="text-align: left;">Code completes all instructor-provided tasks satisfactorily.</td>
<td style="text-align: left;">Response to one instructor provided task is skipped, incorrect, or otherwise incomplete.</td>
<td style="text-align: left;">Responses to two instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
<td style="text-align: left;">Response to three or more instructor provided tasks are skipped, incorrect, or otherwise incomplete.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><p>Formatting &amp; Display</p></td>
<td style="text-align: left;">
<p>Tables have well-formatted column names, suitable numbers of digits, and attractive presentation.</p>
<p>Figures are ‘publication-quality,’ with suitable axis labels, well-chosen structure, attractive color schemes, titles, subtitles, and captions, <em>etc.</em></p>
</td>
<td style="text-align: left;">
<p>Tables are well-formatted, but still have room for improvement.</p>
<p>Figures are above ‘exploratory-quality,’ but do not reach full ‘publication-quality.’</p>
</td>
<td style="text-align: left;">
<p>Tables lack significant ‘polish’ and need improvement in substance (filtering and down-selecting of presented data) or style.</p>
<p>Figures are suitable to support claims made, but are ‘exploratory-quality,’ reflecting minimal effort to customize and ‘polish’ beyond <code>ggplot2</code> defaults.</p>
</td>
<td style="text-align: left;">
<p>Unfiltered ‘data dump’ instead of curated table.</p>
<p>Baseline figures that do not fully support claims made.</p>
</td>
<td style="text-align: left;"><p>Report lacks basic tables; OR report lacks basic figures.</p></td>
</tr>
<tr class="even">
<td style="text-align: center;"><p>Code Quality</p></td>
<td style="text-align: left;">
<p>Code is (near) flawless.</p>
<p>Code passes all <code>styler</code> and <code>lintr</code> type analyses without issue.</p>
</td>
<td style="text-align: left;"><p>Comments give context of the analysis, not simply defining functions used in a particular line.</p></td>
<td style="text-align: left;"><p>Code has well-chosen variable names and basic comments.</p></td>
<td style="text-align: left;"><p>Code executes properly, but is difficult to read.</p></td>
<td style="text-align: left;"><p>Code fails to execute properly.</p></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><p>Data Preparation</p></td>
<td style="text-align: left;">
<p>Automatic (10/10) if mini-project submitted includes and runs instructor-provided code.</p>
<p>Out of scope for this mini-project.</p>
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>For this mini-project, no more than <strong>5</strong> total points of extra credit can be be awarded. Opportunities for extra credit exist for students who go <em>above and beyond</em> the instructor-provided scaffolding. Specific opportunities for extra credit can be <a href="#extra_credit">found below</a>.</p>
<p>Students pursuing careers in data analytics are strongly encouraged to go beyond the strict ambit of the mini-projects to</p>
<ol type="i">
<li>further refine their skills;</li>
<li>learn additional techniques that can be used in the final course project; and</li>
<li>develop a more impressive professional portfolio.</li>
</ol>
<p>Because students are encouraged to use STA 9750 mini-projects as the basis for a professional portfolio, the basic skeleton of each project will be released under a fairly permissive usage license. Take advantage of it!</p>
</section><section id="submission-instructions" class="level3"><h3 class="anchored" data-anchor-id="submission-instructions">Submission Instructions</h3>
<p>After completing the analysis, write up your findings, <em>showing all of your code</em>, using a dynamic <code>quarto</code> document and post it to your course repository. The <code>qmd</code> file should be named <code>mp02.qmd</code> (lower case!) so the rendered document can be found at <code>docs/mp02.html</code> in the student’s repository and will be served at the URL:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<blockquote class="blockquote">
<p><code>https://&lt;GITHUB_ID&gt;.github.io/STA9750-2025-FALL/mp02.html</code></p>
</blockquote>
<p>You can use the helper function <code>mp_start</code> available at in the <a href="../tips.html#mp_start">Course Helper Functions</a> to create a file with the appropriate name and some meta-data already included. Do so by running the following command at the <code>R</code> <code>Console</code>:</p>
<blockquote class="blockquote">
<p><code>source("https://michael-weylandt.com/STA9750/load_helpers.R"); mp_start(N=02)</code></p>
</blockquote>
<p>After completing this mini-project, upload your rendered output and necessary ancillary files to GitHub to make sure your site works. The <code>mp_submission_ready</code> function in the <a href="../tips.html#mp_submission_ready">Course Helper Functions</a> can perform some of these checks automatically. You can run this function by running the following commands at the <code>R</code> <code>Console</code>:</p>
<blockquote class="blockquote">
<p><code>source("https://michael-weylandt.com/STA9750/load_helpers.R"); mp_submission_ready(N=02)</code></p>
</blockquote>
<p>Once you confirm this website works (substituting <code>&lt;GITHUB_ID&gt;</code> for the actual GitHub username provided to the professor in <a href="./mini00.html">MP#00</a> of course), open a GitHub issue on the instructor’s repository to submit your completed work.</p>
<p>The easiest way to do so is by use of the <code>mp_submission_create</code> function in the <a href="../tips.html#mp_submission_create">Course Helper Functions</a>, which can be used by running the following command at the <code>R</code> <code>Console</code>:</p>
<blockquote class="blockquote">
<p><code>source("https://michael-weylandt.com/STA9750/load_helpers.R"); mp_submission_create(N=02)</code></p>
</blockquote>
<p>Alternatively, if you wish to submit manually, open a new issue at</p>
<blockquote class="blockquote">
<p><code>https://github.com/michaelweylandt/STA9750-2025-FALL/issues/new</code> .</p>
</blockquote>
<p>Title the issue <code>STA 9750 &lt;GITHUB_ID&gt; MiniProject #02</code> and fill in the following text for the issue:</p>
<div id="submission-text">
<pre><code>Hi @michaelweylandt!

I've uploaded my work for MiniProject #**02** - check it out!

&lt;https://&lt;GITHUB_ID&gt;.github.io/STA9750-2025-FALL/mp02.html&gt;</code></pre>
</div>
<p>Once the submission deadline passes, the instructor will tag classmates for peer feedback in this issue thread.</p>
<p><em>Additionally</em>, a PDF export of this report should be submitted on Brightspace. To create a PDF from the uploaded report, simply use your browser’s ‘Print to PDF’ functionality.</p>
<p><strong>NB</strong>: The analysis outline below specifies key <em>tasks</em> you need to perform within your write up. Your peer evaluators will check that you complete these. You are encouraged to do extra analysis, but the bolded <strong>Tasks</strong> are <em>mandatory</em>.</p>
<p><strong>NB</strong>: Your final submission should look like a <em>report</em>, not simply a list of facts answering questions. Add introductions, conclusions, and your own commentary. You should be practicing both raw <em>coding</em> skills and written <em>communication</em> in all mini-projects. There is little value in data points stated without context or motivation.</p>
</section></section><section id="mini-project" class="level2"><h2 class="anchored" data-anchor-id="mini-project">Mini-Project #02: Making Backyards Affordable for All</h2>
<section id="data-acquisition" class="level3"><h3 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h3>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 1: Data Import">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 1: Data Import
</div>
</div>
<div class="callout-body-container callout-body">
<p>Incorporate the instructor provided code below into your report. As you do so, make sure to look for possible “keys” on which you will be able to join datasets together.</p>
</div>
</div>
<p>We will focus on data from the <a href="https://www.census.gov/">US Census Bureau</a>. In addition to the Constitutionally-mandated decennial census, the Census Bureau performs a variety of ongoing surveys. The most famous of these is the American Community Survey (ACS) which monitors a variety of household demographic and economic indicators constantly. The census data is a bit complicated to wrangle so we will use the <code>tidycensus</code> package to download what we need.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span><span class="op">)</span>, showWarnings<span class="op">=</span><span class="cn">FALSE</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">library</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">## Mask base::library() to automatically install packages if needed</span></span>
<span>    <span class="co">## Masking is important here so downlit picks up packages and links</span></span>
<span>    <span class="co">## to documentation</span></span>
<span>    <span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>CRAN <span class="op">=</span> <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">pkg</span>, character.only<span class="op">=</span><span class="cn">TRUE</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">pkg</span>, character.only<span class="op">=</span><span class="cn">TRUE</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">get_acs_all_years</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">variable</span>, <span class="va">geography</span><span class="op">=</span><span class="st">"cbsa"</span>,</span>
<span>                              <span class="va">start_year</span><span class="op">=</span><span class="fl">2009</span>, <span class="va">end_year</span><span class="op">=</span><span class="fl">2023</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span><span class="op">)</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">YEARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="va">end_year</span><span class="op">)</span></span>
<span>        <span class="va">YEARS</span> <span class="op">&lt;-</span> <span class="va">YEARS</span><span class="op">[</span><span class="va">YEARS</span> <span class="op">!=</span> <span class="fl">2020</span><span class="op">]</span> <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span>        </span>
<span>        <span class="va">ALL_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">YEARS</span>, <span class="kw">function</span><span class="op">(</span><span class="va">yy</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span><span class="va">geography</span>, <span class="va">variable</span>, year<span class="op">=</span><span class="va">yy</span>, survey<span class="op">=</span><span class="st">"acs1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year<span class="op">=</span><span class="va">yy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">moe</span>, <span class="op">-</span><span class="va">variable</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">variable</span> <span class="op">:=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">ALL_DATA</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fname</span>, show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Household income (12 month)</span></span>
<span><span class="va">INCOME</span> <span class="op">&lt;-</span> <span class="fu">get_acs_all_years</span><span class="op">(</span><span class="st">"B19013_001"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>household_income <span class="op">=</span> <span class="va">B19013_001</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Monthly rent</span></span>
<span><span class="va">RENT</span> <span class="op">&lt;-</span> <span class="fu">get_acs_all_years</span><span class="op">(</span><span class="st">"B25064_001"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>monthly_rent <span class="op">=</span> <span class="va">B25064_001</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total population</span></span>
<span><span class="va">POPULATION</span> <span class="op">&lt;-</span> <span class="fu">get_acs_all_years</span><span class="op">(</span><span class="st">"B01003_001"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>population <span class="op">=</span> <span class="va">B01003_001</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total number of households</span></span>
<span><span class="va">HOUSEHOLDS</span> <span class="op">&lt;-</span> <span class="fu">get_acs_all_years</span><span class="op">(</span><span class="st">"B11001_001"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>households <span class="op">=</span> <span class="va">B11001_001</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also need the number of new housing units built each year. This data is not available using <code>tidycensus</code>, but we can download and prepare it ‘manually’:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">get_building_permits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_year</span> <span class="op">=</span> <span class="fl">2009</span>, <span class="va">end_year</span> <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"housing_units_{start_year}_{end_year}.csv"</span><span class="op">)</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">HISTORICAL_YEARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="fl">2018</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">HISTORICAL_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">HISTORICAL_YEARS</span>, <span class="kw">function</span><span class="op">(</span><span class="va">yy</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">historical_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span><span class="op">)</span></span>
<span>                </span>
<span>            <span class="va">LINES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">historical_url</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>            <span class="va">CBSA_LINES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">LINES</span>, <span class="st">"^[[:digit:]]"</span><span class="op">)</span></span>
<span>            <span class="va">CBSA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">LINES</span><span class="op">[</span><span class="va">CBSA_LINES</span><span class="op">]</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>            <span class="va">PERMIT_LINES</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">LINES</span>, <span class="fl">48</span>, <span class="fl">53</span><span class="op">)</span>, <span class="st">"[[:digit:]]"</span><span class="op">)</span></span>
<span>            <span class="va">PERMITS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">LINES</span><span class="op">[</span><span class="va">PERMIT_LINES</span><span class="op">]</span>, <span class="fl">48</span>, <span class="fl">53</span><span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>CBSA <span class="op">=</span> <span class="va">CBSA</span>,</span>
<span>                       new_housing_units_permitted <span class="op">=</span> <span class="va">PERMITS</span>, </span>
<span>                       year <span class="op">=</span> <span class="va">yy</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">CURRENT_YEARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="va">end_year</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">CURRENT_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">CURRENT_YEARS</span>, <span class="kw">function</span><span class="op">(</span><span class="va">yy</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">current_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">current_url</span>, destfile <span class="op">=</span> <span class="va">temp</span>, mode<span class="op">=</span><span class="st">"wb"</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">fallback</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.f1</span>, <span class="va">.f2</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>                    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="fu">.f1</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, </span>
<span>                             error<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="fu">.f2</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="va">reader</span> <span class="op">&lt;-</span> <span class="fu">fallback</span><span class="op">(</span><span class="va">read_xlsx</span>, <span class="va">read_xls</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="fu">reader</span><span class="op">(</span><span class="va">temp</span>, skip<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">CBSA</span>, <span class="va">Total</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>new_housing_units_permitted <span class="op">=</span> <span class="va">Total</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">ALL_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">HISTORICAL_DATA</span>, <span class="va">CURRENT_DATA</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">ALL_DATA</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>        </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fname</span>, show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">PERMITS</span> <span class="op">&lt;-</span> <span class="fu">get_building_permits</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For this project, we will work at the level of <a href="https://en.wikipedia.org/wiki/Core-based_statistical_area"><em>Core-Based Statistical Areas</em></a> or CBSAs. CBSAs are essentially the metropolitan (or micropolitan) area surrounding a central town. For example, many of you may live in the NYC CBSA, which corresponds to the “New York-Newark-Jersey City, NY-NJ Metropolitan Statistical Area”, but if you commute from north of the city like your instructor you may live in the Poughkeepsie CBSA, the full name of which is the “Poughkeepsie-Newburgh-Middletown, NY Metropolitan Statistical Area”. CBSAs are a unification of the older system of Metropolitan Statistical Areas (MSAs) and Micropolitan Statistical Areas (μSAs) but are finer-resolution than Combined Statistical Areas (CSAs).</p>
<p>Finally, we know that the best CBSA to live in may depend on your career, so it will be useful to acquire income estimates from the Bureau of Labor Statistics (BLS).</p>
<p>The BLS records data using the <a href="https://www.bls.gov/cew/classifications/industry/industry-titles.htm">North American Industry Classification System (NAICS) coding system</a>. The following code will download the latest NAICS data schema and manipulate it into a format suitable for analysis.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span><span class="va">get_bls_industry_codes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        </span>
<span>        <span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://www.bls.gov"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://httr2.r-lib.org/reference/req_url.html">req_url_path</a></span><span class="op">(</span><span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://httr2.r-lib.org/reference/req_headers.html">req_headers</a></span><span class="op">(</span>`User-Agent` <span class="op">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://httr2.r-lib.org/reference/req_error.html">req_error</a></span><span class="op">(</span>is_error <span class="op">=</span> \<span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_status.html">resp_check_status</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">naics_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_html</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_element</a></span><span class="op">(</span><span class="st">"#naics_titles"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">`Industry Title`</span>, <span class="va">Code</span><span class="op">)</span>, <span class="st">"NAICS"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">`Industry Title`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>depth <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">Code</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="co"># These were looked up manually on bls.gov after finding </span></span>
<span>        <span class="co"># they were presented as ranges. Since there are only three</span></span>
<span>        <span class="co"># it was easier to manually handle than to special-case everything else</span></span>
<span>        <span class="va">naics_missing</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>            <span class="op">~</span><span class="va">Code</span>, <span class="op">~</span><span class="va">title</span>, <span class="op">~</span><span class="va">depth</span>, </span>
<span>            <span class="st">"31"</span>, <span class="st">"Manufacturing"</span>, <span class="fl">1</span>,</span>
<span>            <span class="st">"32"</span>, <span class="st">"Manufacturing"</span>, <span class="fl">1</span>,</span>
<span>            <span class="st">"33"</span>, <span class="st">"Manufacturing"</span>, <span class="fl">1</span>,</span>
<span>            <span class="st">"44"</span>, <span class="st">"Retail"</span>, <span class="fl">1</span>, </span>
<span>            <span class="st">"45"</span>, <span class="st">"Retail"</span>, <span class="fl">1</span>,</span>
<span>            <span class="st">"48"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="fl">1</span>, </span>
<span>            <span class="st">"49"</span>, <span class="st">"Transportation and Warehousing"</span>, <span class="fl">1</span></span>
<span>        <span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">naics_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">naics_table</span>, <span class="va">naics_missing</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">naics_table</span> <span class="op">&lt;-</span> <span class="va">naics_table</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">depth</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>level4_title<span class="op">=</span><span class="va">title</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>level1_code <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">Code</span>, end<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                   level2_code <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">Code</span>, end<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>                   level3_code <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">Code</span>, end<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">naics_table</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">level1_code</span> <span class="op">==</span> <span class="va">Code</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>level1_title<span class="op">=</span><span class="va">title</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">naics_table</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">level2_code</span> <span class="op">==</span> <span class="va">Code</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>level2_title<span class="op">=</span><span class="va">title</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">naics_table</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html">join_by</a></span><span class="op">(</span><span class="va">level3_code</span> <span class="op">==</span> <span class="va">Code</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>level3_title<span class="op">=</span><span class="va">title</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"depth"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>level4_code <span class="op">=</span> <span class="va">Code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">level1_title</span>, <span class="va">level2_title</span>, <span class="va">level3_title</span>, <span class="va">level4_title</span>, </span>
<span>                   <span class="va">level1_code</span>,  <span class="va">level2_code</span>,  <span class="va">level3_code</span>,  <span class="va">level4_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"code"</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">naics_table</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fname</span>, show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">INDUSTRY_CODES</span> <span class="op">&lt;-</span> <span class="fu">get_bls_industry_codes</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, the BLS Quarterly Census of Employment and Wages</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span>
<span><span class="va">get_bls_qcew_annual_averages</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_year</span><span class="op">=</span><span class="fl">2009</span>, <span class="va">end_year</span><span class="op">=</span><span class="fl">2023</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span><span class="op">)</span></span>
<span>    <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">YEARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">start_year</span>, <span class="va">end_year</span><span class="op">)</span></span>
<span>    <span class="va">YEARS</span> <span class="op">&lt;-</span> <span class="va">YEARS</span><span class="op">[</span><span class="va">YEARS</span> <span class="op">!=</span> <span class="fl">2020</span><span class="op">]</span> <span class="co"># Drop Covid year to match ACS</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">ALL_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">YEARS</span>, .progress<span class="op">=</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://purrr.tidyverse.org/reference/possibly.html">possibly</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">yy</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="va">fname_inner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{yy}_qcew_annual_singlefile.zip"</span><span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">fname_inner</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="st">"https://www.bls.gov"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_url.html">req_url_path</a></span><span class="op">(</span><span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, <span class="va">yy</span>, <span class="st">"csv"</span>,</span>
<span>                                 <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{yy}_annual_singlefile.zip"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_headers.html">req_headers</a></span><span class="op">(</span>`User-Agent` <span class="op">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_retry.html">req_retry</a></span><span class="op">(</span>max_tries<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                    <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="va">fname_inner</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html">file.info</a></span><span class="op">(</span><span class="va">fname_inner</span><span class="op">)</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;</span> <span class="fl">755e5</span><span class="op">)</span><span class="op">{</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/warning.html">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sQuote.html">sQuote</a></span><span class="op">(</span><span class="va">fname_inner</span><span class="op">)</span>, <span class="st">"appears corrupted. Please delete and retry this step."</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fname_inner</span>, </span>
<span>                     show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>YEAR <span class="op">=</span> <span class="va">yy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">area_fips</span>, </span>
<span>                       <span class="va">industry_code</span>, </span>
<span>                       <span class="va">annual_avg_emplvl</span>, </span>
<span>                       <span class="va">total_annual_wages</span>, </span>
<span>                       <span class="va">YEAR</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">industry_code</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">5</span>, </span>
<span>                       <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">area_fips</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">industry_code</span>, <span class="st">"-"</span>, negate<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>FIPS <span class="op">=</span> <span class="va">area_fips</span>, </span>
<span>                       INDUSTRY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">industry_code</span><span class="op">)</span>, </span>
<span>                       EMPLOYMENT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">annual_avg_emplvl</span><span class="op">)</span>, </span>
<span>                       TOTAL_WAGES <span class="op">=</span> <span class="va">total_annual_wages</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">area_fips</span>, </span>
<span>                       <span class="op">-</span><span class="va">industry_code</span>, </span>
<span>                       <span class="op">-</span><span class="va">annual_avg_emplvl</span>, </span>
<span>                       <span class="op">-</span><span class="va">total_annual_wages</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">INDUSTRY</span> <span class="op">!=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>AVG_WAGE <span class="op">=</span> <span class="va">TOTAL_WAGES</span> <span class="op">/</span> <span class="va">EMPLOYMENT</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">ALL_DATA</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">ALL_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">fname</span>, show_col_types<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">ALL_DATA_YEARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ALL_DATA</span><span class="op">$</span><span class="va">YEAR</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">YEARS_DIFF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">YEARS</span>, <span class="va">ALL_DATA_YEARS</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">YEARS_DIFF</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Download failed for the following years: "</span>, <span class="va">YEARS_DIFF</span>, </span>
<span>             <span class="st">". Please delete intermediate files and try again."</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="va">ALL_DATA</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">WAGES</span> <span class="op">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>These data sources are rather messy - especially the building permit files - but the above code should work without manual intervention. Please contact the instructor on the course discussion platform if you have issues.</p>
<p>Some of these files are large, especially the QCEW data, and may take a bit of time to download and initially process. You are <em>strongly encouraged</em> to do this step as soon as possible so that you can seek help from the instructor if necessary.</p>
<p>If you receive an error message about a <code>zip</code> file being corrupted during download, please delete that file and try again. This error is usually transient.</p>
<p>The QCEW data is rather large and totals about 1.1G raw, before we down sample and compress into a single file. Once you have run this code once and created <code>data/mp02/bls_qcew_2009_2023.csv.gz</code> you can delete all of the annual <code>qcew_annual_singlefile.zip</code> files to save space.</p>
</div>
</div>
</section><section id="data-integration-and-initial-exploration" class="level3"><h3 class="anchored" data-anchor-id="data-integration-and-initial-exploration">Data Integration and Initial Exploration</h3>
<p>Before continuing, you may wish to complete <a href="#ec01">Extra Credit Opportunity #01</a> below.</p>
<p>Now that we have all of our data downloaded and cleaned up, let’s perform some initial analysis to familiarize ourselves with the data. These questions are not necessarily relevant to your final findings, though they may inspire some later thoughts. These are principally designed to help you build fluency with the tables and to make sure you know what data you have access to.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 2: Multi-Table Questions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 2: Multi-Table Questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the functions of the <code>dplyr</code> package, answer the following questions. For most of these questions, you will need to join (at least) two tables together.</p>
<ol type="1">
<li><p>Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</p></li>
<li>
<p>In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</p>
<p><em>Hint</em>: There is a Covid-19 data artifact here that may trip you up if you do not look at your answer closely.</p>
</li>
<li>
<p>Which <em>state</em> (not CBSA) had the highest average <em>individual</em> income in 2015? To answer this question, you will need to first compute the <em>total income</em> per CBSA by multiplying the average household income by the number of households, and then sum total income and total population across all CBSAs in a state. With these numbers, you can answer this question.</p>
<p><em>Hint:</em> The following function can be used to extract the principal state for a CBSA. Some CBSAs split across multiple states, <em>e.g.</em>, the NYC CBSA continuing into NJ and CT, so this picks the one that appears first in the name.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">...</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">NAME</span>, <span class="st">", (.{2})"</span>, group<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also construct a data frame that connects state abbreviations to full names as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">state_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>abb  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">state.abb</span>, <span class="st">"DC"</span>, <span class="st">"PR"</span><span class="op">)</span>,</span>
<span>                       name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">state.name</span>, <span class="st">"District of Columbia"</span>, <span class="st">"Puerto Rico"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Data scientists and business analysts are recorded under NAICS code <code>5182</code>. What is the last year in which the NYC CBSA had the most data scientists in the country? In recent, the San Francisco CBSA has had the most data scientists.</p>
<p>For this question, you may simply create a table of which CBSA had the most data scientists each year and then answer the question in the following text.</p>
<p>Note that the Census Bureau and the BLS use different conventions when recording CBSA identification numbers. To join these tables together, you will need to create a new column to join on. In particular, the BLS will record a code a “C1234” corresponding to a Census identifier of “12340” for the same region. To match these up, it is easiest to create a new column in the BLS tables which transforms values like “C1234” into “12340”-formatted values.</p>
<p>The following code may help:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>_BLS TABLE_ <span class="ot">&lt;-</span> _BLS TABLE_ <span class="sc">|&gt;</span> <span class="fu">mutate</span>(_NEW <span class="at">COLUMN_ =</span> <span class="fu">code_changing</span>(_BLS CBSA ID_))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(_CENSUS TABLE_, _BLS TABLE_, <span class="fu">join_by</span>(CBSA <span class="sc">==</span> _NEW COLUMN_))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will need to insert appropriate table and column names replacing the names surrounded by underscores to adapt this for your own use. You will also need to replace <code>code_changing</code> with an actual set of function calls.</p>
<p>There are several ways to do this, but the most straightforward is probably a combination of:</p>
<ul>
<li><code>as.double</code></li>
<li><code>str_remove</code></li>
<li><code>paste0</code></li>
</ul>
<p>To determine the right order to use these, define a variable <code>x &lt;- "C1234"</code> and figure out the sequence of function calls that satisfies:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">func1</span>(<span class="fu">func2</span>(<span class="fu">func3</span>(x, argument?), argument?), argument?) <span class="sc">==</span> <span class="dv">12340</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, substitute <code>func1</code>, <code>func2</code>, <code>func3</code>, with some combination of the commands noted above and supply additional arguments where needed.</p>
<p><em>Hint</em>: Putting <code>filter</code> statements before <code>join</code> statements (when possible) typically leads to faster code.</p>
</li>
<li><p>What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 3: Initial Visualizations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 3: Initial Visualizations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the functions of the <code>ggplot2</code> package, create suitable visualizations for each of the following relationships.</p>
<ol type="1">
<li><p>The relationship between monthly rent and average household income per CBSA in 2009.</p></li>
<li><p>The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</p></li>
<li>
<p>The evolution of average household size over time. Use different lines to represent different CBSAs.</p>
<p>See <a href="#ec02">Extra Credit Opportunity #02</a> below for ways to make this visualization particularly compelling.</p>
</li>
</ol>
<p>For each plot, make sure your final visualization is “publication-ready” and equipped with, at a minimum:</p>
<ol type="1">
<li>Proper <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-axis labels</li>
<li>A meaningful title</li>
<li>Proper units for axis ticks (if appropriate)</li>
<li>Proper legend titles (if appropriate)</li>
<li>Proper font sizes so that all text is legible.</li>
</ol>
</div>
</div>
</section><section id="building-indices-of-housing-affordability-and-housing-stock-growth" class="level3"><h3 class="anchored" data-anchor-id="building-indices-of-housing-affordability-and-housing-stock-growth">Building Indices of Housing Affordability and Housing Stock Growth</h3>
<p>Now that you hopefully have a sense of the structure of this data, it is time to begin our analysis in earnest. We will begin by constructing an initial metric of rent affordability by combining our <code>INCOME</code>, <code>RENT</code>, and <code>POPULATION</code> tables from above. Using a suitable <code>join</code>, merge these three into a single table which can be used to perform the following task.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 4: Rent Burden">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 4: Rent Burden
</div>
</div>
<div class="callout-body-container callout-body">
<p>Join together the <code>INCOME</code> and <code>RENT</code> tables. Using this data, construct a suitable measure of <em>rent burden</em>: that is, how much of income a typical resident spends on housing. You should take standard ratio like rent-to-income as a baseline, but modify this ratio to increase interpretability:</p>
<ol type="1">
<li>
<p>Standardization: Define a baseline value around which your metric is centered. Some possible baseline structures may include:</p>
<ol type="1">
<li>Setting 0, 50, or 100 to the long-term national average</li>
<li>Setting 0, 50, or 100 to the national average in the first year of your study</li>
<li>Setting 0 to the lowest value and 100 to the highest value in the study</li>
</ol>
</li>
<li>
<p>Scaling and transformation: Standardize your metric to increase interpretability. Some standardizations may include:</p>
<ol type="1">
<li>Setting 0 to the lowest value, 100 to the highest value, and linearly scaling in between</li>
<li>Dividing by the standard deviation so that values can be interpreted as “<span class="math inline">\(k\)</span> standard deviations above average”</li>
<li>Dividing by the baseline value so that values can be interpreted as “<span class="math inline">\(k\)</span> times baseline”</li>
</ol>
</li>
</ol>
<p>Once you have created your metric, create (at least) two tables to introduce it to your readers and visualize them using the <code>DT</code> package from <a href="mini01.html">Mini-Project #01</a>:</p>
<ol type="1">
<li>Pick a single Metropolitan Area and see how rent burden has changed over time</li>
<li>Highlight the Metro Areas highest and lowest with the highest and lowest rent burden</li>
</ol>
<p>Note that your choice of baselining and standardization do not need to be made independently: the best standardization may depend on the baseline used and <em>vice versa</em>. Note that your standardization may also include non-linear transformations (like a <code>log</code> transform) if you find this useful in creating an easily interpreted measure.</p>
</div>
</div>
<p>Now that we have decided on a way of computing rent pressure, we next want to the ‘building-friendliness’ of various metropolitan areas. In particular, we want to identify CBSAs that permit a large number of new housing units relative to their existing population. Even more than that, we want to identify CBSAs where the total number of housing units permitted is growing <em>faster</em> than the population, as these have the greatest chance of being highly affordable.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 5: Housing Growth">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 5: Housing Growth
</div>
</div>
<div class="callout-body-container callout-body">
<p>Join together the <code>POPULATION</code> and <code>PERMITS</code> tables. Using this data, construct a suitable measure of <em>housing growth</em>: that is, how many new housing units are permitted in a CBSA, relative to both the current number of residents and the overall population growth of that CBSA. Because this metric takes into account growth patterns, it should depend on a fixed lookback-window of 5 years used to estimate population growth.</p>
<p>Before constructing your metric, use <code>dplyr</code> functionality to calculate population growth within each CBSA over a rolling 5 year window. Since your data begins in 2009, your five-year estimates of population growth will start in 2014. The <code>lag</code> function may be useful here.</p>
<p>Construct your metric in two parts:</p>
<ol type="1">
<li>An ‘instantaneous’ measure of housing growth that depends on the absolute population of a CBSA and the number of new housing units permitted that year.</li>
<li>A ‘rate-based’ measure of housing growth that compares the number of housing permits to the population growth over a 5 year lookback window.</li>
</ol>
<p>For each of these, suitably standardize and baseline your metric. You may choose to use housing permits and population on their own, construct ratios, or other transformations necessary to construct suitable metrics.</p>
<p>Once you have developed the two individual metrics, construct two tables identifying the CBSAs that score particularly high or low on each metric.</p>
<p>Finally, develop a <em>composite</em> score that combines these two metrics. This may be a sum, weighted sum, maximum, minimum, or any other combination function you feel works best.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> As before, identify CBSAs that do particularly well and particularly poorly on your metric.</p>
<p>Because homebuilding is a slow process, it may be worth aggregating over years. You can use the <code>cummean</code>-family of functions from <code>dplyr</code> to compute <em>cumulative</em> statistics or the <code>roll_*</code> functions from the <a href="https://cran.r-project.org/web/packages/RcppRoll/refman/RcppRoll.html"><code>RcppRoll</code></a> package to get a <em>rolling</em> estimate, <em>e.g.</em>, a rolling 5-year average.</p>
</div>
</div>
<p>Note that both of these tasks, though especially Task 3 allow for significant subjectivity in constructing your metrics. There is no one true way to measure these type of complex dynamics: you might care more about providing housing for existing residents than new residents, or, as the leader of a town with dwindling population, it might be more important to you to have a rich housing stock to attract new residents. Examining which CBSAs score particularly well or particularly poorly on various metrics will help you check that your metrics are actually capturing what you intend for them to capture.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 6: Visualization">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 6: Visualization
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create (at least) two visualizations to investigate the relationships between your Rent Burden and Housing Growth metrics. Using these plots, identify the most “YIMBY” CBSAs as ones which:</p>
<ol type="i">
<li>had relatively high rent burden in the early part of the study period;</li>
<li>have had a decrease in rent burden over the study period;</li>
<li>have had population growth over the study period; and</li>
<li>have had above-average housing growth during the study period.</li>
</ol>
<p>A CBSA exhibiting all of these qualities is (arguably) an example of YIMBY success and is not a city in decline, as would be indicated by falling population resulting in lower rents.</p>
</div>
</div>
</section><section id="policy-brief" class="level3"><h3 class="anchored" data-anchor-id="policy-brief">Policy Brief</h3>
<p>You are a political lobbyist for a national YIMBY organization, trying to get Congress to establish a federal program to encourage local municipalities to adopt a more-YIMBY set of housing policies. In order to get your legislation passed, you first need to identify a pair of representatives to sponsor your bill. You want to find:</p>
<ol type="i">
<li>A primary sponsor who represents a city that has had YIMBY success; and</li>
<li>A co-sponsor who represents a more NIMBY city, that is one with high rent and low housing development.</li>
</ol>
<p>Once you have identified your target representatives, you also want to help them find support from labor unions or industry trade organizations who will help get your bill passed. To do so, identify two important occupations and argue how your bill will benefit voters in those occupations. In particular, you want to find occupations that:</p>
<ol type="i">
<li>Have a non-trivial number of employees in each city. (It does little good to lobby NYC on the basis that a policy will be good for cattle ranchers; it’s far more useful to argue that a given policy will benefit firefighters to get the support of FDNY lobbyists.)</li>
<li>Argue why your policies seem to be favorable for the interest groups, either by arguing that members of those interest groups may spend less on rent (comparing your ‘good’ and ‘bad’ cities) or that their income may rise (if folks in general spend less on rent, that’s good for musician income since folks will have more money to do to live concerts).</li>
</ol>
<p>Finally, your potential sponsors will want to understand what metrics the government can use to identify ‘good’ (high-YIMBY) cities and to target funding appropriately. Provide a brief non-technical description of your rent burden and housing growth metrics.</p>
<p>Put all of this information together into a “policy brief” (one page non-technical summary document) that can be shared with your most likely bill sponsors. Note that this document needs to be brief and easy to read, covering only the highlights and giving the sponsors the information they need to:</p>
<ol type="i">
<li>Explain why their hometown needs this bill to jump-start growth and/or would be likely to receive grants to fund continued growth if this bill passes;</li>
<li>Rally local supporters from politically powerful groups in support of your bill; and</li>
<li>Explain the metrics you recommend so that their legal staff can start translating from math into lawyer-speak.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Task 7: Policy Brief">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task 7: Policy Brief
</div>
</div>
<div class="callout-body-container callout-body">
<p>Write up a policy brief covering the key points above. You want your brief to be well-researched, so you can provide supporting evidence if requested, but short enough that you can use it as an “elevator pitch.” Be sure to note the hometowns of your proposed congressional sponsors. (You do not need to find the names of actual politicians: saying “a sponsor from Houston and from New York” will suffice.)</p>
<p>See <span id="ex03">Extra Credit Opportunity #03</span> for an additional way to make your lobbying efforts more likely to succeed.</p>
</div>
</div>
</section></section><section id="extra_credit" class="level2"><h2 class="anchored" data-anchor-id="extra_credit">Extra Credit Opportunities</h2>
<p>In addition to the extra credit possibilities listed in the rubric above, there are three <em>Extra Credit Opportunities</em> where extra points can be awarded for specific additional tasks. The amount of the extra credit is typically not proportional to the work required to complete these tasks, but I provide these for students who want to dive deeper into this project and develop additional data analysis skills not covered in the main part of this mini-project.</p>
<p>For this mini-project, no more than 5 total points of extra credit may be awarded.</p>
<section id="ec01" class="level3"><h3 class="anchored" data-anchor-id="ec01">Extra Credit Opportunity #01: Relationship Diagram</h3>
<p><strong>Possible Extra Credit: Up to 2 Points</strong></p>
<p>After completing Task 01, examine the structure of your data sets and create a suitable <em>data relationship diagram</em>. An <em>data relationship diagram</em> is a visual representation of:</p>
<ol type="1">
<li>The data tables available for an analysis</li>
<li>The columns (names and types) present in each table</li>
<li>The possible <code>join</code> structures that can be used to combine these tables.</li>
</ol>
<p>Generate a suitable visualization and include it in your final submission. Tools like <a href="https://dbdiagram.io" class="uri">https://dbdiagram.io</a> can be useful for creating this visualization, but you may ultimately use whatever tool is most convenient for you (even a photo of an on-paper sketch). In determining the amount of extra credit awarded, evaluators will look at both the aesthetics of the visualization and the accuracy of the depicted relationships.</p>
<p>Note that this data is not ‘fully normalized’ so there may be cross-table relationships between one or more columns, particularly when connecting a ‘wide’ and ‘long’ data set. Note also that some of the join keys are a bit more complex than typical of a standard database set up so you may wish to annotate when a relationship more complex than simple quality is required.</p>
</section><section id="ec02" class="level3"><h3 class="anchored" data-anchor-id="ec02">Extra Credit Opportunity #02: Highlighting Important Units in a Spaghetti Plot</h3>
<p><strong>Possible Extra Credit: Up to 1 Point</strong></p>
<p>When visualizing the evolution of many units over time, overlapping line plots often become quite difficult to read, resulting in <em>spaghetti plots</em>. <em>E.g.</em>,</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">storms</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>storm_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">" ("</span>, <span class="va">year</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">storm_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>observation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">observation</span>, y<span class="op">=</span><span class="va">pressure</span>, color<span class="op">=</span><span class="va">storm_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Number of 6 Hours Periods since Hurricane Designation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Barometric Pressure (mm HG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Evolution of Barometric Pressure following Initial Hurricane Designation"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="mini02_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Even after removing the legend, this plot is still quite dysfunctional. With this many lines, it is essentially impossible to design a color palette in a way that lets a reader distinguish all different lines. A useful strategy is to instead highlight a small number of <em>important</em> lines, ‘low-lighting’ the other lines so that they only serve as a background of ‘representative samples’. The <a href="https://r-graph-gallery.com/package/gghighlight.html"><code>gghighlight</code> package</a> provides tools for making this sort of plot.</p>
<p>For a point of extra credit, use the <code>gghighlight</code> package to highlight the NYC and Los Angeles CBSAs in your visualization of household size over time. Note that you may need to create a new variable indicating whether a certain row should be highlighted or not.</p>
</section><section id="ec03" class="level3"><h3 class="anchored" data-anchor-id="ec03">Extra Credit Opportunity #03: Increasing Millenial Appeal</h3>
<p><strong>Possible Extra Credit: Up to 2 Points</strong></p>
<p>Modify your analysis and policy brief to include at least one variable that can be reasonably be interpreted as “something appealing to young people.” Politicians and local leaders always want to attract younger citizens, so if your metric includes something that specifically factors in millenial appeal, you may have a better chance of getting it through congress. You might consider things like “number of folks working in the arts”, “number of persons in a certain age bracket”, “number of folks of a certain race (or mixed race)”, “number of families with young children”, or similar. Be creative here!</p>
<p>The ACS has <em>many</em> variables and it can often be somewhat difficult to find them. If you run the command</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span><span class="fl">2024</span>, <span class="st">"acs1"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>R</code> will bring up a list of all census tables by their ID and brief description. You can look through this list to find variables that might work for this extension. Commands like:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">coll</a></span><span class="op">(</span><span class="st">"THING TO LOOK FOR"</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span><span class="fl">2024</span>, <span class="st">"acs1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">label</span>, <span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">concept</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>will look for variables with a certain term in their description; <em>e.g.</em></p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">coll</a></span><span class="op">(</span><span class="st">"kitchen"</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span><span class="fl">2024</span>, <span class="st">"acs1"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">label</span>, <span class="va">x</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">concept</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 3
   name       label                                                      concept
   &lt;chr&gt;      &lt;chr&gt;                                                      &lt;chr&gt;  
 1 B25051_001 Estimate!!Total:                                           Kitche…
 2 B25051_002 Estimate!!Total:!!Complete kitchen facilities              Kitche…
 3 B25051_003 Estimate!!Total:!!Lacking complete kitchen facilities      Kitche…
 4 B25052_001 Estimate!!Total:                                           Kitche…
 5 B25052_002 Estimate!!Total:!!Complete kitchen facilities              Kitche…
 6 B25052_003 Estimate!!Total:!!Lacking complete kitchen facilities      Kitche…
 7 B25053_001 Estimate!!Total:                                           Tenure…
 8 B25053_002 Estimate!!Total:!!Owner occupied:                          Tenure…
 9 B25053_003 Estimate!!Total:!!Owner occupied:!!Complete kitchen facil… Tenure…
10 B25053_004 Estimate!!Total:!!Owner occupied:!!Lacking complete kitch… Tenure…
# ℹ 13 more rows</code></pre>
</div>
</div>
<p>Google is also helpful in finding relevant tables. Note that occupation information can be found in both Census tables and in the BLS data we already downloaded. In general, the BLS data is easier to use.</p>
<hr>
<p>This work ©2025 by <a href="https://michael-weylandt.com">Michael Weylandt</a> is licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Creative Commons BY-NC-SA 4.0</a> license. <img src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png" class="img-fluid" style="width:10.0%"></p>


</section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Throughout this section, replace <code>&lt;GITHUB_ID&gt;</code> with your GitHub ID from <a href="./mini00.html">Mini-Project #00</a>, making sure to remove the angle brackets. Note that the automated course infrastructure will be looking for precise formatting, so follow these instructions closely.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If you want to compute the maximum or minimum across two columns in <code>dplyr</code>, use the <code>pmax</code> or <code>pmin</code> (pairwise maximum/minimum) functions. The “collapsing” <code>min</code> and <code>max</code> functions will not work for this purpose.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/michael-weylandt\.com\/STA9750\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/michaelweylandt/STA9750/edit/main/miniprojects/mini02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/michaelweylandt/STA9750/blob/main/miniprojects/mini02.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/michaelweylandt/STA9750/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>