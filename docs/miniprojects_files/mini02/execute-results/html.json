{
  "hash": "a3f4f4c6e88910c662f550309d772d82",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"{{< var course.short >}} Mini-Project #{{< meta mp_num >}}: {{< meta mp_title >}}\"\nformat:\n  html:\n    code-link: true\nmp_num: \"02\"\nmp_title: \"Identifying Environmentally Responsible US Public Transit Systems\"\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Due Dates\n\n-   Released to Students: 2025\\-02\\-27\n-   **Initial Submission: 2025\\-03\\-26 11:45pm ET on GitHub and Brightspace**\n-   **Peer Feedback:**\n    -   Peer Feedback Assigned: 2025\\-03\\-27 on GitHub\n    -   **Peer Feedback Due: 2025\\-04\\-02 11:45pm ET on GitHub**\n\n\n*Estimated Time to Complete: 9 Hours*\n\n*Estimated Time for Peer Feedback: 1 Hour*\n\n## Introduction\n\nWelcome to Mini-Project #{{< meta mp_num >}}. In this project, you will take on\nthe role of Executive Director of the Green Transit Alliance for Investigation\nof Variance (GTA IV). GTA IV will be giving a series of awards for the\n\"greenest\" public transit agencies. Your final submission for this mini-project\nshould take the form of a press release, announcing the winners of the various\nGTA IV awards and giving the key statistics that lead to their selection.\n\nFor this project, you will use \"multi-table\" operations such as joins and pivots,\nto combine data from different sources to generate novel insights not attainable\nfrom any individual table. Our analysis will bring in data from two federal\nsources, the [National Transit Database](https://www.transit.dot.gov/ntd) and\nthe [Energy Information Administration](https://www.eia.gov/). \n \n### Student Responsbilities\n\nRecall our basic analytic workflow and table of student responsibilities:\n\n-   Data Ingest and Cleaning: Given a single data source, read it into `R` and transform it to a reasonably useful standardized format.\n-   Data Combination and Alignment: Combine multiple data sources to enable insights not possible from a single source.\n-   Descriptive Statistical Analysis: Take a data table and compute informative summary statistics from both the entire population and relevant subgroups\n-   Data Visualization: Generate insightful data visualizations to spur insights not attainable from point statistics\n-   Inferential Statistical Analysis and Modeling: Develop relevant predictive models and statistical analyses to generate insights about the *underlying population* and not simply the data at hand.\n\n+----------------------+---------------------+---------------------------+----------------------------------+---------------+\n|                      | Ingest and Cleaning | Combination and Alignment | Descriptive Statistical Analysis | Visualization |\n+:====================:+:===================:+:=========================:+:================================:+:=============:+\n| **Mini-Project #01** |                     |                           | **✓**                            |               |\n+----------------------+---------------------+---------------------------+----------------------------------+---------------+\n| **Mini-Project #02** |                     | **✓**                     | **✓**                            | **½**         |\n+----------------------+---------------------+---------------------------+----------------------------------+---------------+\n| **Mini-Project #03** | **½**               | **✓**                     | **✓**                            | **✓**         |\n+----------------------+---------------------+---------------------------+----------------------------------+---------------+\n| **Mini-Project #04** | **✓**               | **✓**                     | **✓**                            | **✓**         |\n+----------------------+---------------------+---------------------------+----------------------------------+---------------+\n\n: Students' Responsibilities in Mini-Project Analyses {.hover}\n\nIn this mini-project, you are mainly responsible for data alignment and basic statistical analyses. While not the main focus of this mini-project, you are also expected to provide basic data visualizations to support your findings; the grading rubric, below, emphasizes the `dplyr` tools used in this project, but reports without any visualization will be penalized severely. Note that data visualization will play a larger role in Mini-Project #03.\n\nAs before, I will provide code to automatically download and read in the data used for this project. Also note that, as compared with Mini-Project #01, I am providing significantly less 'scaffolding': students are more responsible for directing their own analyses.\n\n### Rubric\n\n{{< var course.short >}} Mini-Projects are evaluated using *peer grading* with\n*meta-review* by the course GTAs. Specifically, variants of the following rubric\nwill be used for the mini-projects:\n\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Course Element        | Excellent (9-10)                                                                                                                                                                            | Great (7-8)                                                                                                                                                     | Good (5-6)                                                                                                                                                 | Adequate (3-4)                                                                              | Needs Improvement (1-2)                                                                             | Extra Credit                                                                                                                                                                                                        |\n+=======================+=============================================================================================================================================================================================+=================================================================================================================================================================+============================================================================================================================================================+=============================================================================================+=====================================================================================================+=====================================================================================================================================================================================================================+\n| Written Communication | Report is well-written and flows naturally. Motivation for key steps is clearly explained to reader without excessive detail. Key findings are highlighted and appropriately given context. | Report has no grammatical or writing issues. Writing is accessible and flows naturally. Key findings are highlighted, but lack suitable motivation and context. | Report has no grammatical or writing issues. Key findings are present but insufficiently highlighted.                                                      | Writing is intelligible, but has some grammatical errors. Key findings are obscured.        | Report exhibits significant weakness in written communication. Key points are difficult to discern. | Report includes extra context beyond instructor provided information.                                                                                                                                               |\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Project Skeleton      | Code completes all instructor-provided tasks correctly. Responses to open-ended tasks are particularly insightful and creative.                                                             | Code completes all instructor-provided tasks satisfactorially.                                                                                                  | Response to one instructor provided task is skipped, incorrect, or otherwise incomplete.                                                                   | Responses to two instructor provided tasks are skipped, incorrect, or otherwise incomplete. | Response to three or ore instructor provided tasks are skipped, incorrect, or otherwise incomplete. | Report exhibits particularly creative insights drawn from thorough student-initiated analyses.                                                                                                                      |\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Formatting & Display  | Tables have well-formatted column names, suitable numbers of digits, and attractive presentation.                                                                                           | Tables are well-formatted, but still have room for improvement.                                                                                                 | Tables lack significant 'polish' and need improvement in substance (filtering and down-selecting of presented data) or style.                              | Unfiltered 'data dump' instead of curated table.                                            | Report lacks basic tables; OR report lacks basic figures.                                           | Report includes one or more high-quality graphics (created using `R`) using tools beyond static basic `ggplot2`. These can be created using extensions to`ggplot2` or speciality packages for interactive graphics. |\n|                       |                                                                                                                                                                                             |                                                                                                                                                                 |                                                                                                                                                            |                                                                                             |                                                                                                     |                                                                                                                                                                                                                     |\n|                       | Figures are 'publication-quality', with suitable axis labels, well-chosen structure, attractive color schemes, titles, subtitles, and captions, *etc.*                                      | Figures are above 'exploratory-quality', but do not reach full 'publication-quality'.                                                                           | Figures are suitable to support claims made, but are 'exploratory-quality', reflecting minimal effort to customize and 'polish' beyond `ggplot2` defaults. | Baseline figures that do not fully support claims made.                                     |                                                                                                     |                                                                                                                                                                                                                     |\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Code Quality          | Code is (near) flawless.                                                                                                                                                                    | Comments give context of the analysis, not simply defining functions used in a particular line.                                                                 | Code has well-chosen variable names and basic comments.                                                                                                    | Code executes properly, but is difficult to read.                                           | Code fails to execute properly.                                                                     | Code takes advantage of advanced `Quarto` features to improve presentation of results.                                                                                                                              |\n|                       |                                                                                                                                                                                             |                                                                                                                                                                 |                                                                                                                                                            |                                                                                             |                                                                                                     |                                                                                                                                                                                                                     |\n|                       | Code passes all `styler` and `lintr` type analyses without issue.                                                                                                                           |                                                                                                                                                                 |                                                                                                                                                            |                                                                                             |                                                                                                     |                                                                                                                                                                                                                     |\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Data Preparation      | Automatic (10/10). Out of scope for this mini-project                                                                                                                                       |                                                                                                                                                                 |                                                                                                                                                            |                                                                                             |                                                                                                     | Report modifies instructor-provided import code to use additional columns or data sources in a way that creates novel insights.                                                                                     |\n+-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n: Mini-Project Grading Rubric\n\nNote that this rubric is designed with copious opportunities for extra credit if students go *above and beyond* the instructor-provided scaffolding. Students pursuing careers in data analytics are strongly encouraged to go beyond the strict ambit of the mini-projects to i) further refine their skills; ii) learn additional techniques that can be used in the final course project; and iii) develop a more impressive professional portfolio.\n\nBecause students are encouraged to use {{< var course.short >}} mini-projects as\nthe basis for a professional portfolio, the basic skeleton of each project will be\nreleased under a fairly permissive usage license. Take advantage of it!\n\n### Submission Instructions\n\nAfter completing the analysis, write up your findings, *showing all of your\ncode*, using a dynamic `quarto` document and post it to your course repository.\nThe `qmd` file should be named `mp02.qmd` so the rendered document can\nbe found at `docs/mp02.html` in the student's repository and served at\nthe URL:[^sub]\n\n> `https://<GITHUB_ID>.github.io/{{< var course.repo >}}/mp{{< meta mp_num >}}.html`\n\nOnce you confirm this website works (substituting `<GITHUB_ID>` for the actual\nGitHub username provided to the professor in [MP#00](./mini00.html) of course),\nopen a new issue at\n\n> `https://github.com/<GITHUB_USERNAME>/{{< var course.repo >}}/issues/new` .\n\nTitle the issue `{{< var course.short >}} <GITHUB_USERNAME> MiniProject #{{< meta mp_num >}}` \nand fill in the following text for the issue:\n\n::: {#submission-text}\n\n```         \nHi @michaelweylandt!\n\nI've uploaded my work for MiniProject #**{{< meta mp_num >}}** - check it out!\n\nhttps://<GITHUB_ID>.github.io/{{< var course.repo >}}/mp{{< meta mp_num >}}.html\n```\n\n:::\n\n\n\nOnce the submission deadline passes, the instructor will tag classmates for peer feedback in this issue thread.\n\n*Additionally*, a PDF export of this report should be submitted on Brightspace. To create a PDF from the uploaded report, simply use your browser's 'Print to PDF' functionality.\n\n**NB**: The analysis outline below specifies key *tasks* you need to perform within your write up. Your peer evaluators will check that you complete these. You are encouraged to do extra analysis, but the bolded **Tasks** are *mandatory*.\n\n**NB**: Your final submission should look like a *report*, not simply a list of facts answering questions. Add introductions, conclusions, and your own commentary. You should be practicing both raw *coding* skills and written *communication* in all mini-projects. There is little value in data points stated without context or motivation.\n\n\n::: {#submission-text}\n\n```         \nHi @michaelweylandt!\n\nI've uploaded my work for MiniProject #{{< meta mp_num >}} - check it out!\n\nhttps://<GITHUB_ID>.github.io/{{< var course.repo >}}/mp{{< meta mp_num >}}.html\n```\n\n:::\n\n[^sub]: Throughout this section, replace `<GITHUB_ID>` with your GitHub ID from\n[Mini-Project #00](./mini00.html), making sure to remove the angle brackets. Note\nthat the automated course infrastructure will be looking for precise formatting,\nso follow these instructions closely. \n\n## Mini-Project #{{< meta mp_num >}}: {{< meta mp_title >}}\n\nAmong the commonly cited benefits of robust public transit is a reduction in \nenvironmental impact. In this mini-project, we will explore US Public Transit\nsystems to assess their environmental efficiency. Our analysis will use a \nvariety of data sources to i) determine how many riders are served by different\ntransit systems; ii) determine how far each public transit system transports\nan average rider; and iii) investigate the effective emissions associated with\neach form of transit. \n\n### Data Acquisition\n\nWe begin by downloading and importing relevant data sets. For this mini-project,\nwe will download the following details: \n\n- EIA [State Electricity Profiles](https://www.eia.gov/electricity/state/), \n  which we will use to estimate the environmental impact of the electricity\n  used to run certain transit systems. \n  \n  \n\n::: {.callout-tip title=\"Task 1: Data Import\"}\n\nIncorporate the instructor provided code below into your report. As you\ndo so, make sure to look for possible \"keys\" on which you will be able to join\ndatasets together. \n\n:::\n\n#### State Electricity Profiles\n\nFor purposes of this analysis, we will assume that all electricity generation\nin a state is fungible. That is, we will assign the average generation emissions\nto all electric transit in a state, even if the transit authority officially\nhas a \"green supply\" agreement in place. \n\nThe following code will parse the EIA SEP summary pages and create a \"tidy\"\ntable for your use: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nensure_package <- function(pkg){\n    pkg <- as.character(substitute(pkg))\n    options(repos = c(CRAN = \"https://cloud.r-project.org\"))\n    if(!require(pkg, character.only=TRUE)) install.packages(pkg)\n    stopifnot(require(pkg, character.only=TRUE))\n}\n\nensure_package(httr2)\nensure_package(rvest)\nensure_package(datasets)\nensure_package(purrr)\nensure_package(DT)\n\nget_eia_sep <- function(state, abbr){\n    state_formatted <- str_to_lower(state) |> str_replace_all(\"\\\\s\", \"\")\n    \n    dir_name <- file.path(\"data\", \"mp02\")\n    file_name <- file.path(dir_name, state_formatted)\n    \n    dir.create(dir_name, showWarnings=FALSE, recursive=TRUE)\n    \n    if(!file.exists(file_name)){\n        BASE_URL <- \"https://www.eia.gov\"\n        REQUEST <- request(BASE_URL) |> \n            req_url_path(\"electricity\", \"state\", state_formatted)\n    \n        RESPONSE <- req_perform(REQUEST)\n    \n        resp_check_status(RESPONSE)\n        \n        writeLines(resp_body_string(RESPONSE), file_name)\n    }\n    \n    TABLE <- read_html(file_name) |> \n        html_element(\"table\") |> \n        html_table() |>\n        mutate(Item = str_to_lower(Item))\n    \n    if(\"U.S. rank\" %in% colnames(TABLE)){\n        TABLE <- TABLE |> rename(Rank = `U.S. rank`)\n    }\n    \n    CO2_MWh <- TABLE |> \n        filter(Item == \"carbon dioxide (lbs/mwh)\") |>\n        pull(Value) |> \n        str_replace_all(\",\", \"\") |>\n        as.numeric()\n    \n    PRIMARY <- TABLE |> \n        filter(Item == \"primary energy source\") |> \n        pull(Rank)\n    \n    RATE <- TABLE |>\n        filter(Item == \"average retail price (cents/kwh)\") |>\n        pull(Value) |>\n        as.numeric()\n    \n    GENERATION_MWh <- TABLE |>\n        filter(Item == \"net generation (megawatthours)\") |>\n        pull(Value) |>\n        str_replace_all(\",\", \"\") |>\n        as.numeric()\n    \n    data.frame(CO2_MWh               = CO2_MWh, \n               primary_source        = PRIMARY,\n               electricity_price_MWh = RATE * 10, # / 100 cents to dollars &\n               # * 1000 kWh to MWH \n               generation_MWh        = GENERATION_MWh, \n               state                 = state, \n               abbreviation          = abbr\n    )\n}\n\nEIA_SEP_REPORT <- map2(state.name, state.abb, get_eia_sep) |> list_rbind()\n```\n:::\n\n\n\nThis produces the following table: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nensure_package(scales)\nensure_package(DT)\n\nEIA_SEP_REPORT |> \n    select(-abbreviation) |>\n    arrange(desc(CO2_MWh)) |>\n    mutate(CO2_MWh = number(CO2_MWh, big.mark=\",\"), \n           electricity_price_MWh = dollar(electricity_price_MWh), \n           generation_MWh = number(generation_MWh, big.mark=\",\")) |>\n    rename(`Pounds of CO2 Emitted per MWh of Electricity Produced`=CO2_MWh, \n           `Primary Source of Electricity Generation`=primary_source, \n           `Average Retail Price for 1000 kWh`=electricity_price_MWh, \n           `Total Generation Capacity (MWh)`= generation_MWh, \n           State=state) |>\n    datatable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-36bcf647a1e85ecc7b2d\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-36bcf647a1e85ecc7b2d\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\"],[\"1,925\",\"1,864\",\"1,741\",\"1,514\",\"1,497\",\"1,444\",\"1,414\",\"1,354\",\"1,180\",\"1,148\",\"1,127\",\"1,103\",\"1,095\",\"1,054\",\"1,044\",\"987\",\"966\",\"923\",\"912\",\"855\",\"847\",\"817\",\"801\",\"794\",\"775\",\"763\",\"759\",\"733\",\"727\",\"715\",\"684\",\"655\",\"654\",\"648\",\"639\",\"594\",\"576\",\"558\",\"558\",\"522\",\"522\",\"518\",\"440\",\"428\",\"370\",\"369\",\"344\",\"292\",\"269\",\"8\"],[\"Coal\",\"Coal\",\"Coal\",\"Coal\",\"Coal\",\"Petroleum\",\"Coal\",\"Coal\",\"Natural gas\",\"Natural gas\",\"Coal\",\"Coal\",\"Natural gas\",\"Coal\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Wind\",\"Natural gas\",\"Wind\",\"Wind\",\"Wind\",\"Natural gas\",\"Natural gas\",\"Nuclear\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Nuclear\",\"Nuclear\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Natural gas\",\"Hydroelectric\",\"Wind\",\"Hydroelectric\",\"Hydroelectric\",\"Nuclear\",\"Hydroelectric\"],[\"$102.60\",\"$83.90\",\"$99.60\",\"$108.70\",\"$114.90\",\"$386.00\",\"$80.30\",\"$90.30\",\"$214.10\",\"$127.20\",\"$109.70\",\"$91.40\",\"$128.50\",\"$117.60\",\"$110.40\",\"$97.30\",\"$89.10\",\"$232.10\",\"$136.80\",\"$100.40\",\"$216.20\",\"$109.50\",\"$122.10\",\"$135.30\",\"$94.20\",\"$108.00\",\"$94.70\",\"$110.60\",\"$114.70\",\"$106.90\",\"$121.90\",\"$125.70\",\"$130.90\",\"$93.00\",\"$106.10\",\"$106.80\",\"$242.40\",\"$143.40\",\"$105.00\",\"$117.50\",\"$182.80\",\"$152.70\",\"$248.70\",\"$208.40\",\"$90.80\",\"$104.90\",\"$103.20\",\"$95.80\",\"$229.60\",\"$175.30\"],[\"52,286,784\",\"43,181,420\",\"63,217,080\",\"66,703,285\",\"90,046,880\",\"9,194,164\",\"42,068,807\",\"33,496,554\",\"6,717,825\",\"62,548,705\",\"26,895,758\",\"39,445,955\",\"4,772,059\",\"57,541,720\",\"133,223,464\",\"63,195,647\",\"97,784,565\",\"19,695,884\",\"120,656,625\",\"547,294,552\",\"10,430,846\",\"72,933,440\",\"57,276,862\",\"259,798,479\",\"69,836,973\",\"58,456,598\",\"39,269,073\",\"129,221,513\",\"139,435,010\",\"77,791,204\",\"111,838,736\",\"235,924,937\",\"42,164,375\",\"89,236,024\",\"126,553,394\",\"91,059,344\",\"40,666,418\",\"36,000,650\",\"100,853,387\",\"177,737,641\",\"124,039,988\",\"64,228,924\",\"216,628,794\",\"12,512,181\",\"17,842,446\",\"17,436,158\",\"61,691,869\",\"102,960,605\",\"16,824,999\",\"2,480,199\"],[\"West Virginia\",\"Wyoming\",\"Kentucky\",\"Missouri\",\"Indiana\",\"Hawaii\",\"North Dakota\",\"Utah\",\"Alaska\",\"Wisconsin\",\"Montana\",\"Nebraska\",\"Delaware\",\"Colorado\",\"Ohio\",\"Arkansas\",\"Louisiana\",\"Massachusetts\",\"Michigan\",\"Texas\",\"Rhode Island\",\"Mississippi\",\"Minnesota\",\"Florida\",\"Iowa\",\"Kansas\",\"New Mexico\",\"Georgia\",\"Alabama\",\"Tennessee\",\"Arizona\",\"Pennsylvania\",\"Nevada\",\"Oklahoma\",\"North Carolina\",\"Virginia\",\"Connecticut\",\"Maryland\",\"South Carolina\",\"Illinois\",\"New York\",\"New Jersey\",\"California\",\"Maine\",\"Idaho\",\"South Dakota\",\"Oregon\",\"Washington\",\"New Hampshire\",\"Vermont\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Pounds of CO2 Emitted per MWh of Electricity Produced<\\/th>\\n      <th>Primary Source of Electricity Generation<\\/th>\\n      <th>Average Retail Price for 1000 kWh<\\/th>\\n      <th>Total Generation Capacity (MWh)<\\/th>\\n      <th>State<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"Pounds of CO2 Emitted per MWh of Electricity Produced\",\"targets\":1},{\"name\":\"Primary Source of Electricity Generation\",\"targets\":2},{\"name\":\"Average Retail Price for 1000 kWh\",\"targets\":3},{\"name\":\"Total Generation Capacity (MWh)\",\"targets\":4},{\"name\":\"State\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n&nbsp;\n\nHere, we have collected the effective emissions per MWh[^mwh] as well as price\nand total state-wide generation capacity. We will use this data to compare the\nemissions of different transit modalities. We next turn to the National Transit\nDatabase to get information on various public transit authorities. Before we\ndo so, however, let's explore the SEP data a bit first. \n\n::: {.callout-tip title=\"Task 2: Initial Analysis of SEP Data\"}\n\nAnswer the following questions using the `EIA_SEP_REPORT` data: \n\n1. Which state has the most expensive retail electricity? \n2. Which state has the 'dirtiest' electricity mix? \n3. On average, how many pounds of CO2 are emitted per MWh of electricity\n   produced in the US? (Note that you will need to use a suitably _weighted_\n   average here.) \n4. What is the rarest primary energy source in the US? What is the associated\n   cost of electricity and where is it used? \n5. My home state, Texas, has a reputation as being the home of \"dirty fossil\n   fuels\" while NY has a reputation as a leader in clean energy. How many times\n   cleaner is NY's energy mix than that of Texas? \n\n:::\n\n#### 2023 Annual Database Energy Consumption\n\nWe first download the [2023 Annual Database Energy\nConsumption](https://www.transit.dot.gov/ntd/data-product/2023-annual-database-energy-consumption)\nreport. This report is shared as a Excel spreadsheet (`.xlsx` filetype), so we\nuse the `readxl` package to import it to `R`. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nensure_package(readxl)\n# Create 'data/mp02' directory if not already present\nDATA_DIR <- file.path(\"data\", \"mp02\")\ndir.create(DATA_DIR, showWarnings=FALSE, recursive=TRUE)\n\nNTD_ENERGY_FILE <- file.path(DATA_DIR, \"2023_ntd_energy.xlsx\")\n\nif(!file.exists(NTD_ENERGY_FILE)){\n    DS <- download.file(\"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx\", \n                  destfile=NTD_ENERGY_FILE, \n                  method=\"curl\")\n    \n    if(DS | (file.info(NTD_ENERGY_FILE)$size == 0)){\n        cat(\"I was unable to download the NTD Energy File. Please try again.\\n\")\n        stop(\"Download failed\")\n    }\n}\n\nNTD_ENERGY_RAW <- read_xlsx(NTD_ENERGY_FILE)\n```\n:::\n\n\n\n::: {.callout-warning title=\"Selection of Download Methods\"}\n\n`R` provides several different internal tools to download data files from\nthe internet. These can be accessed more-or-less seamlessly by changing\nthe `method` argument of the `download.file` function. \n\nDepending on your operating system, different methods may work better than\nothers. Above, I used the `\"curl\"` method as that seemed to be the most robust\non my computer. If this doesn't work, for you, I would recommend trying the\nfollowing: \n\n- `method = \"internal\"`\n- `method = \"wget\"`\n- `method = \"libcurl\"`\n- `method = \"wininet\"`\n\nIf none of these work, download the file by hand and save it as\n`data/mp02/2023_ntd_energy.xlsx`. It is worth making sure that you are able\nto download data files through `R` as this will be important in your course\nproject (and in life generally).\n\n:::\n\n\nNext, we do some basic clean-up:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nensure_package(tidyr)\nto_numeric_fill_0 <- function(x){\n    replace_na(as.numeric(x), 0)\n}\n\nNTD_ENERGY <- NTD_ENERGY_RAW |> \n    select(-c(`Reporter Type`, \n              `Reporting Module`, \n              `Other Fuel`, \n              `Other Fuel Description`)) |>\n    mutate(across(-c(`Agency Name`, \n                     `Mode`,\n                     `TOS`), \n                  to_numeric_fill_0)) |>\n    group_by(`NTD ID`, `Mode`, `Agency Name`) |>\n    summarize(across(where(is.numeric), sum), \n              .groups = \"keep\") |>\n    mutate(ENERGY = sum(c_across(c(where(is.numeric))))) |>\n    filter(ENERGY > 0) |>\n    select(-ENERGY) |>\n    ungroup()\n```\n:::\n\n\n\nThe resulting table is almost ready for us to work with: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display 10 random rows\nslice_sample(NTD_ENERGY , n=10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 16\n   `NTD ID` Mode  `Agency Name`       `Bio-Diesel` `Bunker Fuel` `C Natural Gas`\n      <dbl> <chr> <chr>                      <dbl>         <dbl>           <dbl>\n 1    80007 DR    City of Pueblo                 0             0               0\n 2       34 DR    Rogue Valley Trans…            0             0               0\n 3    90201 MB    City of Turlock                0             0           76020\n 4    99423 DR    City of Glendale               0             0               0\n 5    90015 LR    City and County of…            0             0               0\n 6    20230 FB    Barnegat Bay Decoy…            0             0               0\n 7    10048 MB    Connecticut Depart…            0             0               0\n 8    90148 DR    Victor Valley Tran…            0             0          113630\n 9    10128 DR    Connecticut Depart…            0             0               0\n10    30054 MB    Centre Area Transp…            0             0          506163\n# ℹ 10 more variables: `Diesel Fuel` <dbl>, `Electric Battery` <dbl>,\n#   `Electric Propulsion` <dbl>, Ethanol <dbl>, Methonal <dbl>, Gasoline <dbl>,\n#   Hydrogen <dbl>, Kerosene <dbl>, `Liquified Nat Gas` <dbl>,\n#   `Liquified Petroleum Gas` <dbl>\n```\n\n\n:::\n:::\n\n\n\nHere, the first 3 columns (`NTD ID`, `Mode`, and `Agency Name`) identify the\noperating agency and the relevant mode of transportation while the remaining\ncolumns denote how much of each type of fuel that agency used during 2023. \nThe non-electric sources are all quoted in gallons, while `Electric Battery`\nand `Electric Propulsion` are quoted in kWh used. \n    \nThe `Mode` column is important: it is used to distinguish multiple transport\ntypes operated the same agency, *e.g.* MTA subways and buses in NYC. The\ntwo letter codes used by the NTD, however, are not immediately interpretable. \n\n::: {.callout-tip title=\"Task 3: Recoding the `Mode` column\"}\n\nFirst, find the unique `Mode` codes in our data using the `distinct` function. Next, examine the NTD website and find the interpretations of these codes. Complete the following snippet to recode the `Mode` column.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## This code needs to be modified\nNTD_ENERGY <- NTD_ENERGY |>\n    mutate(Mode=case_when(\n        Mode == \"HR\" ~ \"Heavy Rail\", \n        ...\n        ...\n        TRUE ~ \"Unknown\"))\n```\n:::\n\n\n:::\n\n#### 2023 Annual Database Service by Agency\n\nNext, we download the [2023 Service by\nAgency](https://data.transportation.gov/resource/6y83-7vuw.csv) report, from\nwhich we will extract characteristics of typical passenger trips on each \ntransit service. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNTD_SERVICE_FILE <- file.path(DATA_DIR, \"2023_service.csv\")\nif(!file.exists(NTD_SERVICE_FILE)){\n    DS <- download.file(\"https://data.transportation.gov/resource/6y83-7vuw.csv\", \n                  destfile=NTD_SERVICE_FILE, \n                  method=\"curl\")\n    \n    if(DS | (file.info(NTD_SERVICE_FILE)$size == 0)){\n        cat(\"I was unable to download the NTD Service File. Please try again.\\n\")\n        stop(\"Download failed\")\n    }\n}\n\nNTD_SERVICE_RAW <- read_csv(NTD_SERVICE_FILE)\n```\n:::\n\n\n\nAs before, we need to clean up the data a bit before we can use it: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nNTD_SERVICE <- NTD_SERVICE_RAW |>\n    mutate(`NTD ID` = as.numeric(`_5_digit_ntd_id`)) |> \n    rename(Agency = agency, \n           City   = max_city, \n           State  = max_state,\n           UPT    = sum_unlinked_passenger_trips_upt, \n           MILES  = sum_passenger_miles) |>\n    select(matches(\"^[A-Z]\", ignore.case=FALSE)) |>\n    filter(MILES > 0)\n```\n:::\n\n\n\nHere `UPT` is the number of total _Unlinked Passenger Trips_ during 2023; that\nis, the number of distinct (non-transfer) trips taken. *E.g.*, if you transfer\nfrom the `7` to the `6` to get to Baruch. You ride two segments, but only take\n1 UPT to get to Baruch (2 total UPT if you go home the same way). \n\nLet's explore this data a bit to get familiar with it. \n\n::: {.callout-tip title=\"Task 4: Explore NTD Service Data\"}\n\nAnswer the following questions using the `NTD_SERVICE` data. \n\n1. Which transit service has the most UPT annually? \n2. What is the average trip length of a trip on MTA NYC? \n3. Which transit service in NYC has the _longest_ average trip length? \n\n   (NB: You need to be careful with the `City` column here. Certain MTA services\n   are officially located in \"New York City\" while others are located in\n   Brooklyn.)\n4. Which state has the _fewest_ total miles travelled by public transit?\n5. Are all states represented in this data? If no, which ones are missing?\n   The `state.name` and `state.abb` objects we used above may be useful here. \n\n:::\n\nWe're now ready to start putting these datasets together and using them to \nidentify America's greenest transit agencies. \n\n### Analysis\n\n#### Calculate Total Emissions\n\nCompute the total emissions associated with each Agency + Mode pair. \n\n::: {.callout-tip title=\"Task 5: Calculate Emissions\"}\n\nYou will need to join the three tables (`NTD_SERVICE`, `NTD_ENERGY`, and \n`EIA_SEP_REPORT`) together. You should create a table with the following format:\n\n- Each row should be an Agency + Mode Pair\n- Each row should include the state in which the Agency is located (per\n  the `NTD_SERVICE` table)\n- Each row should include all fuel sources from the `NTD_ENERGY` table\n- Each row should include the EIA estimated CO2 emissions per MWh from the\n  `EIA_SEP_REPORT` table. \n\nOnce this table is created, use a (long-ish) arithmetic formula within a \n`mutate` to compute the total emissions for that row. Note that you will need\nadditional data to convert combustion fuels to CO2 emissions; these conversions\ncan be found on [the EIA\nwebsite](https://www.eia.gov/environment/emissions/co2_vol_mass.php). (You may\nhard code these values in your submission. Note that the fuel names used by\nthe EIA do not exactly match those reported by the NTD; you will need to align\nthese manually to best effort.)\n\n:::\n\n#### Relate Total Emissions and Passenger Service\n\nNow that you have computed the total emissions for each Agency + Mode pair, it\nis time to normalize these by the actual size of the transit agency. *E.g.*, \nthe NYC Subway almost certainly has higher total emissions than local bus service\nin Ithaca, NY, but it also serves **many** more riders, so the *per capita* \nor *per transit* emissions may be lower. \n\n::: {.callout-tip title=\"Task 6: Normalize Emissions to Transit Usage\"}\n\nUsing the total emissions calculated above, compute the emissions: \n\n1) Per UPT; and \n2) Per passenger mile\n\nWhich agencies are most efficient on these bases? You may want to filter out\nextremely small agencies and to create \"small\", \"medium\", and \"large\" agencies\nso that you can give multiple awards. \n\nNote that transit usage is reported at the Agency level, so you may need to \nsum emissions across multiple modes. \n\n:::\n\n\n#### Idenitify 'Greenest' Transit Agencies\n\nWith the above analysis, determine the winners of (at least) three GTA IV\nawards: \n\n1) Greenest Transit Agency\n2) Most Emissions Avoided\n3) A third award of your creation\n4) A \"Worst Of\" award of your creation\n\nThe Greenest Transit Agency award can be determined using your analysis above.\n\nFor the \"Most Emissions Avoided\" award, you should first compute the total \nemissions if all transit usage were replaced with driving individual vehicles. \nThen use US [CAFE standards](https://www.nhtsa.gov/press-releases/usdot-announces-new-vehicle-fuel-economy-standards-model-year-2024-2026)\nto convert miles to gallons of motor fuel used and convert motor fuel to total\nemissions as per above. Compare this to the actual emissions associated\nwith that agency to determine emissions avoided. \n\nFor the third award, determine an additional metric on which a transit agency\ncan be considered to be highly green (*e.g.*, highest percentage of\nelectrification) and then determine the appropriate winner. \n\nFinally, for the fourth award, \"name and shame\" an agency which does not have\nparticularly 'green' operations. As with the third award, you can determine\na metric you think is best. \n\nPer discussion above, you may choose to break these down into multiple\ncategories (or honorable mention awards) to recognize smaller agencies. \n\n::: {.callout-tip title=\"Task 7: Determine Award Winners\"}\n\nDesign and implement metrics for the four GTA IV Green Transit Awards and\ndetermine winners. \n\n:::\n\n## Deliverable: Transit Award \"Press Release\"\n\nAfter completing your analysis, prepare a \"press release\" announcing the\nwinners in each category. For each award given, your press release should\ninclude at a minimum: \n\ni)  A short description of the way in which the relevant metric was calculated. \nii) The winning agency and/or transit mode and the *value* of their metric. \niii) A 'reference' value that makes the winner look particularly impressive, \n     *e.g.* how did the _median_ agency do on that same metric? \n     \n::: {.callout-tip title=\"Task 8: Visualization\"}\n\nFor at least two of the four awards, create a suitable visualization demonstrating\nthe 'green-ness' of the award winners, both in absolute terms and relative to \nother agencies and/or private modes of transporation. \n\nThese should be included in your press release as media supplements that can\nbe used by, *e.g.*, a local news report in their nightly broadcast. As such, \nthese graphics should: \n\ni)  Have professional-quality (\"publication ready\") formatting;[^font]\nii) Have low-clutter / high-information density; \niii) Be self-contained and accessible to a general reader without significant\n     additional description retired. \niv)  Include citations to original data sources used\n\n:::\n\n\n[^font]: Make sure to set fonts and figure dimensions large enough to be legible\non a large screen.\n\nAs with [Mini-Project #01](./mini01.html), you are required to present your \nfindings in this format. Because the code implementing this analysis does\nnot fit naturally in the press release format, you may find it easier to \nstyle it as an Appendix and to include the press release writing as an\nExecutive Summary at the top of your submission. \n\n## Extra Credit Opportunities\n\n\nPeer evaluators are authorized to give up to 4 points of extra credit (total\nacross all categories) for \n\n1) Press release writing that is particularly funny, punny, or otherwise\n   enjoyable to read; and \n2) Award criteria that are particularly creative and insight-generating. When\n   awarding extra credit, peer evaluators should be sure to assess the quality\n   of the insight generated by these additional awards: finding that, *e.g.*,\n   the NYC subway is highly efficient on two different but highly correlated\n   metrics is not a remarkable insight. \n   \n*Additionally*, up to 4 points of extra credit may be given for code that \nautomatically reads the [EIA Fuel Type\nEmissions](https://www.eia.gov/environment/emissions/co2_vol_mass.php) estimates\nautomatically instead of hard-coding values. Note that full credit may be given\nfor analysis which hard-codes these EPA estimates: reading and manipulating\nweb data like this is not required until the end of this course. \nhard-coding )\n   \n\n[^mwh]: 1 Megawatt-hour (MWh) is 1,000 kilowatt-hours (kWh) or roughly enough\nto power 3 NYC appartments for one month. Electricity bills are typically cited\nin kWh; to convert the per MWh price reported here to a per kWh price divide by\n1000.\n\n------------------------------------------------------------------------\n\nThis work ©2025 by [Michael Weylandt](https://michael-weylandt.com) is licensed\nunder a [Creative Commons BY-NC-SA \n4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en) license.\n![](http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png){width=\"10%\"}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}